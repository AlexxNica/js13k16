<meta charset=utf-8><title>Super Chrono Portal Maker</title><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:crosshair"id=a><img src="data:;base64,iVBORw0KGgoAAAANSUhEUgAAA1QAAAAQCAMAAAAmns6IAAAAWlBMVEUAAADFycoAAADjnSWAgID///+xNCVHSUECRYe6YRHJu5wAqADITAz8vLBIAP//slkCa9Mpzv+A0BDEUU9qawSKjsBCQv+wtOb3ORD/AABhY1rIzP4BIkP/2bLDllwqAAAAAnRSTlMAOrCfFIoAAAY2SURBVHhe1duJkqQ2DAZg5Qf6mPveI8n7v2Yk2SCQxjbQM53kT6eNQHZtde1XZpheWhdwUnF3bwG/+mGR/m8XiqFf8/F5EaLzIkTvi5AGGjsGHY80nUtjruDy6IJGCC+c29sXHfiV86KB+/O0czo9Sf5Kw+lEKdXZ5xS6OF1HBIBovhxyxoJmB4C/muOKbcvEMxRmxjntdWINxAabbUfhRLXffQC+KOSksRq3nNR9f2fB/R2Ghaoe5zOyh3REkkcJIio1NZ///HF+XATvfy4iqkYZCc0N53j8/ft4lCPRJLiR3imZsOCnC16qWYMKSKeA70F1HlNCVr9sDROqsXRQahpQQYUty2jgz4SZkcO6dSy16wGVo13tb30aBVPQnMyUBp+imqvq8SmqEcho6ddsZFPPU4aBUQkZnqgzBJWw+vHjh5ISVEpqGLJTKCmJsoKaAjBoQBAJ2YKimrymI8yI3MasQKWkhkG7C47G7EfVcQIyX4fSNxyYUQek5fSdYEFVAyqosGkZq+2Mnxk7aOU6ltqEIirtq/a39m2g+ZegjWrop6CECktUQxp7RfU8i6CSyGTbqRRVOnhXU4pKAkalpDKrhEpdFVCpJTWVjmBkzIypaaPKpkxVNIWc0+mPXagUATqHLNShDA2Hg6A6nM/g9dhYRkWcogaKV+PN0MZlDIoTSlTsoPY6oUPjUaahjAomPPRbUfo0iqiecr4IlZoyVYxJUYFHh2pYhWqIqI4cQ6UpoVJL6f3n16Aa1JSqQsGUqdqFqkuJyGJtZVR5yKgOnUbGhROnoVjG1q3L6OC5glPuoNXraIqoYrMF83zaH7X64ut3qpiIilBCNaxApaYUlQZImDh6AAyLwMc8yfvFqNQUh0lpEEy57EBF+W4tIPN1KH2DoIKgOnO4cn8xL9up6IJlbBMo6129TpRYs24xNfANbjvduVOd9C0+qCAA9Z1KAturIiowqkFt8ThHNexBRWzp+Pp6c/P6KkekqKAv26r4lSCA7M5Pj/4XqKjTRGRwtSv9hENCRbxDAUzM/dSw4UEFuWsRlcW11jA0UbXXsdA+VPYW+81U9dNoo3L+5En6hArYg4obGRVkVFRm6nkNKomh0v3pVaOHc1QooMqm9OhyVJwaqqdFdqE6HB705ZEBEV0srWFcgdfi4iFV2PpIPaKi9aioiopWo6ImKnfBzS+iKhDdgIraqIYU7c23f0kVAAG2H1U/ojJTK1FpqqjALxkjqp8uqGcdqkHzXagOI6qDnZEagDVM5rqDlmO7qVRFGqmsXPUsnOgKOxVnJSpqo8J3ocIX7FQR1Z2gElEyXI7KTBmqR8BQKaZ3QxVv/27E1I3d/mk+RxXSMNVGNaoq7VSnWTaiMkGqxNxIAHRmquNX3pPAdSf9+bJGVRG9Ef/P13TOm2NQv0H69p+pNC1UZGnh/C5U+IKfqSKqe3D4gLP9QQWSJh50ZFRmar5TPbqdioeAapgeVLApPcBGVE00m27/BkG1NOkRtVHBgsQEGrlno3RCUQCdqVt2i0Ft1+6ESpJRsSo1xYVlNypaj4quhor2PqhoUa9tlJp1qCigkq8qlVC5J+pxp8qYdFBUZmrP7V/lkbqaugoqizuB7ajwOAvy3qOoOlWiKDSUw0JSi5m06zqd8lbGjnS+Fv8mKutGu6OGyrquhMpUXYaKHCrNalSmClRApabWovKJv/y13/5eA1UjW1HBRVQASdGI6iGFTJW2jNWDTuMGRYMOkEKTUVnhfhVj5TZUxXmxtC47WtERUcWua6AyVReioiqqHlP6Aqpw99fLoGFQM1OMKgMEpq8p2c9UXGBYBPFrSuk0hiuhGhaBqz0ql4jKzyeiBCYrUhNakoUZkRDJ5hJRRaMQZIb1S6fWCZWFYhlR5QRUFmqjIrj+ZkdEFbv2oMrZgooAP30XKiqhAsSUpY+oJGaKsiX0OSLJ8tH4Qm1EZV+ohX2hdgzov4fqaf7fKlTJy6RGBqum4k27xtFakinyiVB8uQWVm1dFFXm2O6KPyPxqqGgXqilcFG5P7saxxyKujGp7F/pYhODy7gKXwj/9SKEroKpnOyoXY2JaQvXGCVcc15YqX25C5ea1UZET0+qIqHzXFVFRA9U/0X8GNpca52UAAAAASUVORK5CYII"hidden id=tileset><script>var draw_tile=function(id,tile_x,tile_y){c.drawImage(tileset,id*16,0,16,16,tile_x*32,40+tile_y*32,32,32)};var draw_sprite=function(id,x,y){c.drawImage(tileset,id*16,0,16,16,x,y,32,32)};var tile_at=function(x,y){if(!level_data.tiles[~~(y/32)])return 0;return level_data.tiles[~~(y/32)][~~(x/32)]||0};var set_tile=function(x,y,value){if(!level_data.tiles[~~(y/32)])return;level_data.tiles[~~(y/32)][~~(x/32)]=value};var is_solid=function(id,spikes){if(id==13)document.title=heros.length+" "+hero+" "+frame;return id==13&&hero!=0||spikes&&id==7||solid[id]||0};var is_writable=function(tile_x,tile_y){if(!level_data.tiles[tile_y])return 0;return!level_data.tiles[tile_y][tile_x]||level_data.tiles[tile_y][tile_x]<14||level_data.tiles[tile_y][tile_x]>21};var reset_hero=function(){return{x:level_data&&level_data.start?level_data.start[0]*32:640,y:level_data&&level_data.start?level_data.start[1]*32:0,vx:0,vy:0,grounded:0,keyleft:false,left:[],keyup:false,up:[],keyright:false,right:[],space:[],shift:[],leftclick:[],rightclick:[],angle:0,direction:1,state:0,cube_held:null,cube_below:null,position_on_cube:null,pick_cube_animation_frame:0,can_jump:true}};var reset_current_level=function(timetravel){win=false;coins_left=0;win_frame=0;lose_frame=0;paradox_frame=0;frame=0;current_hero=reset_hero();solid=[0,0,0,1,1,1,0,0,1,1,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0];level_data.cubes=[];yellow_toggle_last_frame=false;yellow_toggle_on=true;yellow_toggle_delay=0;pipes_state=[];balances_state=[];blue_portal={tile_x:-1,tile_y:-1};orange_portal={tile_x:-2,tile_y:-2};if(!timetravel)heros=[]};var reset_maker_level=function(){level_data={tiles:[],pipes:[],balances:[],cubes:[],tested:false};for(j=0;j<20;j++)level_data.tiles[j]=[];pipe_click=0;current_pipe=0;balance_click=0;current_balance=0;current_editor_tile=0;shared=true;chose_a_tile=false};var first_frame=function(){reset_current_level(1);level_data.tiles=[];for(var j=0;j<20;j++){level_data.tiles[j]=[];for(var i=0;i<40;i++){level_data.tiles[j][i]=level_data.hash.charCodeAt(j*40+i)-48;if(level_data.tiles[j][i]==15)level_data.tiles[j][i]=0}}for(var i in level_data.pipes)pipes_state[i]={pressed:false,y:level_data.pipes[i][1]*32};for(var i in level_data.balances)balances_state[i]={y1:level_data.balances[i][1]*32,y2:level_data.balances[i][3]*32,weight1:0,weight2:0}};var move_draw_pipes=function(){for(var i in level_data.pipes){if(pipes_state[i].pressed)target=level_data.pipes[i][2]*32;else target=level_data.pipes[i][1]*32;if(pipes_state[i].y>target)pipes_state[i].y=Math.max(pipes_state[i].y-4,target);else if(pipes_state[i].y<target)pipes_state[i].y=Math.min(pipes_state[i].y+4,target);end_pipe=false;for(var k=~~(pipes_state[i].y/32)+1;k<21;k++)if(k<20&&!is_solid(tile_at(level_data.pipes[i][0]*32,k*32))&&!is_solid(tile_at(level_data.pipes[i][0]*32+1*32,k*32))&&!end_pipe){draw_tile(18,level_data.pipes[i][0],k);draw_tile(19,level_data.pipes[i][0]+1,k)}else{end_pipe=true;pipes_state[i].y_base=k*32;break}draw_sprite(16,level_data.pipes[i][0]*32,pipes_state[i].y+40);draw_sprite(17,level_data.pipes[i][0]*32+32,pipes_state[i].y+40);if(level_data.pipes[i][4])if(pipes_state[i].pressed)draw_tile(21,level_data.pipes[i][3],level_data.pipes[i][4]);else draw_tile(20,level_data.pipes[i][3],level_data.pipes[i][4])}};var parse_draw_map=function(){for(j=0;j<20;j++)for(i=0;i<40;i++){drawn_tile=level_data.tiles[j][i];if(drawn_tile==12){drawn_tile=0;if(frame==0)level_data.cubes.push({x:i*32,y:j*32,vy:0,hero:null})}if(drawn_tile==13&&heros.length==0){c.save();c.globalAlpha=.5;draw_tile(drawn_tile,i,j);c.restore()}else draw_tile(drawn_tile,i,j);if(drawn_tile==2&&frame==0){end_pole=false;if(j<20)for(k=j+1;k<20;k++)if(!level_data.tiles[k][i]&&!end_pole){draw_tile(24,i,k);level_data.tiles[k][i]=24}else end_pole=true}if(drawn_tile==23&&frame==0){level_data.start=[i,j];current_hero.x=level_data.start[0]*32;current_hero.y=level_data.start[1]*32}}if(frame==0){for(hero in heros){heros[hero].x=level_data.start[0]*32;heros[hero].y=level_data.start[1]*32;heros[hero].vx=0;heros[hero].vy=0;heros[hero].keyleft=false;heros[hero].keyup=false;heros[hero].keyright=false;heros[hero].safe=false;heros[hero].direction=1;heros[hero].pickdrop=0;heros[hero].cube_held=null}for(i in level_data.cubes)level_data.cubes[i].mario=null}};var reset_mechanisms=function(){yellow_toggle=false;for(j=0;j<20;j++)for(i=0;i<40;i++)if(level_data.tiles[j][i]==25)level_data.tiles[j][i]=11;for(i in level_data.pipes)pipes_state[i].pressed=false;for(hero in heros);current_hero.weight=1;for(i in level_data.cubes)level_data.cubes[i].weight=1;for(i in level_data.balances){balances_state[i].weight1=0;balances_state[i].weight2=0}};var gravity_and_collisions=function(obj,obj_width,type){if(typeof obj.cube_held!="undefined"&&obj.cube_held!==null)obj.weight=1+level_data.cubes[obj.cube_held].weight;if(obj.cube_below!==null&&obj.cube_below!=obj.cube_held){obj.x=level_data.cubes[obj.cube_below].x+obj.position_on_cube;obj.y=level_data.cubes[obj.cube_below].y-32;obj.cube_below=null}if(obj.vx>0){obj.portal_target=null;if(tile_at(obj.x+obj_width+obj.vx,obj.y+16)==4&&orange_portal.tile_x>=0&&blue_portal.tile_x==~~((obj.x+obj_width+obj.vx)/32)&&blue_portal.tile_y==~~((obj.y+16)/32)&&blue_portal.side==3)obj.portal_target=orange_portal;if(tile_at(obj.x+obj_width+obj.vx,obj.y+16)==4&&blue_portal.tile_x>=0&&orange_portal.tile_x==~~((obj.x+obj_width+obj.vx)/32)&&orange_portal.tile_y==~~((obj.y+16)/32)&&orange_portal.side==3)obj.portal_target=blue_portal;if(obj.portal_target){obj.y=~~((obj.y+16)/32)*32;obj.vy=0;obj.in_portal=true;if(tile_at(obj.x+obj.vx,obj.y+16)==4){obj.teleport=true;obj.momentum=Math.max(obj.vx,walk_speed);obj.vx=0;obj.teleport_idle=8}}else if(is_solid(tile_at(obj.x+obj_width+obj.vx,obj.y))||is_solid(tile_at(obj.x+obj_width+obj.vx,obj.y+31))){obj.x=~~((obj.x+obj.vx)/32)*32+32-obj_width-1;obj.vx=0}if(obj.x>1280-obj_width){obj.x=1280-obj_width;obj.vx=0}for(var j in level_data.pipes)if(!obj.in_portal&&obj.x+obj_width+obj.vx>=level_data.pipes[j][0]*32&&obj.x+obj_width+obj.vx<=level_data.pipes[j][0]*32+16&&obj.y+31>=pipes_state[j].y&&obj.y<=pipes_state[j].y_base){obj.x=level_data.pipes[j][0]*32-obj_width-1;obj.vx=0}}if(obj.vx<0){obj.portal_target=null;if(tile_at(obj.x+obj.vx,obj.y+16)==4&&orange_portal.tile_x>=0&&blue_portal.tile_x==~~((obj.x+obj.vx)/32)&&blue_portal.tile_y==~~((obj.y+16)/32)&&blue_portal.side==1)obj.portal_target=orange_portal;if(tile_at(obj.x+obj.vx,obj.y+16)==4&&blue_portal.tile_x>=0&&orange_portal.tile_x==~~((obj.x+obj.vx)/32)&&orange_portal.tile_y==~~((obj.y+16)/32)&&orange_portal.side==1)obj.portal_target=blue_portal;if(obj.portal_target){obj.y=~~((obj.y+16)/32)*32;obj.vy=0;obj.in_portal=true;if(tile_at(obj.x+obj.vx+obj_width,obj.y+16)==4){obj.teleport=true;obj.momentum=Math.max(-obj.vx,walk_speed);obj.vx=0;obj.teleport_idle=8}}else if(is_solid(tile_at(obj.x+obj.vx,obj.y))||is_solid(tile_at(obj.x+obj.vx,obj.y+31))){obj.x=~~((obj.x+obj.vx)/32)*32+32;obj.vx=0}if(obj.x<0){obj.x=0;obj.vx=0}for(j in level_data.pipes)if(obj.x+obj.vx>=level_data.pipes[j][0]*32+64-16&&obj.x+obj.vx<=level_data.pipes[j][0]*32+64&&obj.y+31>=pipes_state[j].y&&obj.y<=pipes_state[j].y_base){obj.x=level_data.pipes[j][0]*32+64;obj.vx=0}}obj.x+=obj.vx;if(!obj.in_portal){obj.grounded=false;obj.vy+=gravity;if(obj.vy>max_fall_speed)obj.vy=max_fall_speed}if(obj.vy>0){obj.portal_target=null;if(tile_at(obj.x+obj_width/2,obj.y+32+obj.vy)==4&&orange_portal.tile_x>=0&&blue_portal.tile_x==~~((obj.x+obj_width/2)/32)&&blue_portal.tile_y==~~((obj.y+32+obj.vy)/32)&&blue_portal.side==0)obj.portal_target=orange_portal;if(tile_at(obj.x+obj.vx/2,obj.y+32+obj.vy)==4&&blue_portal.tile_x>=0&&orange_portal.tile_x==~~((obj.x+obj_width/2)/32)&&orange_portal.tile_y==~~((obj.y+32+obj.vy)/32)&&orange_portal.side==0)obj.portal_target=blue_portal;if(obj.portal_target){obj.x=~~((obj.x+obj_width/2)/32)*32+(32-obj_width)/2;obj.vx=0;obj.in_portal=true;if(obj.vy<10&&tile_at(obj.x+obj_width/2,obj.y+32+obj.vy-16)==4||obj.vy>10&&tile_at(obj.x+obj_width/2,obj.y+32+obj.vy)==4){obj.teleport=true;obj.momentum=Math.max(obj.vy,6);obj.vy=0;obj.teleport_idle=8}}else if(is_solid(tile_at(obj.x,obj.y+32+obj.vy))||is_solid(tile_at(obj.x+obj_width-1,obj.y+32+obj.vy))||type==1&&tile_at(obj.x,obj.y+32+obj.vy)==7||type==1&&tile_at(obj.x+obj_width-1,obj.y+32+obj.vy)==7){obj.y=~~((obj.y+obj.vy)/32)*32;obj.vy=0;obj.grounded=true}for(i in level_data.cubes)if(!level_data.cubes[i].in_portal&&!obj.in_portal&&obj.x+obj_width>level_data.cubes[i].x&&obj.x<level_data.cubes[i].x+32&&obj.y+31+obj.vy>level_data.cubes[i].y-8&&obj.y+31+obj.vy<level_data.cubes[i].y+20){obj.y=level_data.cubes[i].y-32;obj.vy=0;obj.grounded=true;obj.cube_below=i;obj.position_on_cube=obj.x-level_data.cubes[i].x;level_data.cubes[i].weight+=obj.weight}for(j in level_data.pipes)if(obj.x+obj_width-1>=level_data.pipes[j][0]*32&&obj.x<level_data.pipes[j][0]*32+64&&obj.y+31+obj.vy>=pipes_state[j].y&&obj.y+31+obj.vy<=pipes_state[j].y+32){obj.y=pipes_state[j].y-32;obj.vy=0;obj.grounded=true;obj.on_moving_object=true}for(j in level_data.balances)if(obj.x+obj_width>=level_data.balances[j][0]*32-32&&obj.x<level_data.balances[j][0]*32+64&&obj.y+31+obj.vy>=balances_state[j].y1-8&&obj.y+31+obj.vy<=balances_state[j].y1+32){obj.y=balances_state[j].y1-32;obj.vy=0;obj.grounded=true;obj.on_moving_object=true;balances_state[j].weight1+=obj.weight}for(j in level_data.balances)if(obj.x+obj_width>=level_data.balances[j][2]*32-32&&obj.x<level_data.balances[j][2]*32+64&&obj.y+31+obj.vy>=balances_state[j].y2-8&&obj.y+31+obj.vy<=balances_state[j].y2+32){obj.y=balances_state[j].y2-32;obj.vy=0;obj.grounded=true;obj.on_moving_object=true;balances_state[j].weight2+=obj.weight}}if(obj.vy<0){obj.portal_target=null;if(tile_at(obj.x+obj_width/2,obj.y+obj.vy)==4&&orange_portal.tile_x>=0&&blue_portal.tile_x==~~((obj.x+obj_width/2)/32)&&blue_portal.tile_y==~~((obj.y+obj.vy)/32)&&blue_portal.side==2)obj.portal_target=orange_portal;if(tile_at(obj.x+obj.vx/2,obj.y+obj.vy)==4&&blue_portal.tile_x>=0&&orange_portal.tile_x==~~((obj.x+obj_width/2)/32)&&orange_portal.tile_y==~~((obj.y+obj.vy)/32)&&orange_portal.side==2)obj.portal_target=blue_portal;if(obj.portal_target){obj.x=~~((obj.x+obj_width/2)/32)*32+(32-obj_width)/2;obj.vx=0;obj.in_portal=true;if(tile_at(obj.x+obj_width/2,obj.y+obj.vy+10)==4){obj.teleport=true;obj.momentum=6;obj.vy=0;obj.teleport_idle=8}}else if(is_solid(tile_at(obj.x,obj.y+obj.vy))||is_solid(tile_at(obj.x+obj_width,obj.y+obj.vy))){if(tile_at(obj.x,obj.y+obj.vy)==5)set_tile(obj.x,obj.y+obj.vy,0);if(tile_at(obj.x+hero_width,obj.y+obj.vy)==5)set_tile(obj.x+hero_width,obj.y+obj.vy,0);obj.y=~~((obj.y+obj.vy)/32)*32+32;obj.vy=0}}obj.y+=obj.vy;if(obj.teleport){obj.teleport=false;obj.grounded=false;obj.x=obj.portal_target.tile_x*32+(32-obj_width)/2;obj.y=obj.portal_target.tile_y*32;if(obj.portal_target.side==0){obj.vy=-obj.momentum;obj.vx=0}if(obj.portal_target.side==1){obj.vx=obj.momentum;obj.vy=0;obj.x+=8}if(obj.portal_target.side==2){obj.vy=obj.momentum;obj.vx=0;obj.y+=8;obj.teleport_idle=2}if(obj.portal_target.side==3){obj.vx=-obj.momentum;obj.vy=0;obj.x-=8}}if(tile_at(obj.x,obj.y+20)==11){set_tile(obj.x,obj.y+20,25);yellow_toggle=true}else if(tile_at(obj.x+obj_width,obj.y+20)==11){set_tile(obj.x+obj_width,obj.y+20,25);yellow_toggle=true}for(var i in level_data.pipes)if(obj.x+obj_width>=level_data.pipes[i][3]*32&&obj.x<=level_data.pipes[i][3]*32+32&&obj.y+32>=level_data.pipes[i][4]*32&&obj.y+20<=level_data.pipes[i][4]*32+32)pipes_state[i].pressed=true};var play_hero=function(this_hero,past){if(this_hero.state!=3&&!win&&!paradox_frame){this_hero.state=0;this_hero.on_moving_object=false;if(!this_hero.teleport_idle){if(this_hero.grounded&&tile_at(this_hero.x,this_hero.y+33)!=8&&tile_at(this_hero.x+hero_width,this_hero.y+33)!=8||!this_hero.grounded&&Math.abs(this_hero.vx)<10)this_hero.vx=0;if(this_hero.right[frame]&&!((tile_at(this_hero.x,this_hero.y+33)==8||tile_at(this_hero.x+hero_width,this_hero.y+33)==8)&&this_hero.vx!=0)){if(this_hero.direction==1)this_hero.vx=Math.max(this_hero.vx,walk_speed);else this_hero.vx=0;this_hero.direction=1;if(this_hero.grounded)this_hero.state=1}if(this_hero.left[frame]&&!((tile_at(this_hero.x,this_hero.y+33)==8||tile_at(this_hero.x+hero_width,this_hero.y+33)==8)&&this_hero.vx!=0)){if(this_hero.direction==0)this_hero.vx=Math.min(this_hero.vx,-walk_speed);else this_hero.vx=0;this_hero.direction=0;if(this_hero.grounded)this_hero.state=1}}if(!this_hero.in_portal&&this_hero.up[frame]&&this_hero.grounded&&!((tile_at(this_hero.x,this_hero.y+33)==8||tile_at(this_hero.x+hero_width,this_hero.y+33)==8)&&this_hero.vx!=0)){this_hero.vy-=jump_speed;this_hero.grounded=false;this_hero.keyup=false;this_hero.can_jump=false;this_hero.cube_below=null}if(this_hero.vy<0&&!this_hero.grounded)this_hero.state=2;gravity_and_collisions(this_hero,hero_width,0);if(tile_at(this_hero.x+hero_width/2-8,this_hero.y+16-8)==6)set_tile(this_hero.x+hero_width/2-8,this_hero.y+16-8,0);if(tile_at(this_hero.x+hero_width/2+8,this_hero.y+16-8)==6)set_tile(this_hero.x+hero_width/2+8,this_hero.y+16-8,0);if(tile_at(this_hero.x+hero_width/2-8,this_hero.y+16+8)==6)set_tile(this_hero.x+hero_width/2-8,this_hero.y+16+8,0);if(tile_at(this_hero.x+hero_width/2+8,this_hero.y+16+8)==6)set_tile(this_hero.x+hero_width/2+8,this_hero.y+16+8,0);if(this_hero.shift[frame])if(tile_at(this_hero.x,this_hero.y)==23||tile_at(this_hero.x+hero_width,this_hero.y)==23||tile_at(this_hero.x,this_hero.y+31)==23||tile_at(this_hero.x+hero_width,this_hero.y+31)==23)if(!past){this_hero.last_frame=frame;heros.push(this_hero);frame=-1;current_hero=reset_hero()}else this_hero.safe=true;if(tile_at(this_hero.x+3,this_hero.y)==7||tile_at(this_hero.x+hero_width-3,this_hero.y)==7||tile_at(this_hero.x+3,this_hero.y+5)==7||tile_at(this_hero.x+hero_width-3,this_hero.y+5)==7){this_hero.state=3;this_hero.vy=-1*jump_speed}if(this_hero.y>648){this_hero.state=3;this_hero.vy=-1.5*jump_speed}if(tile_at(this_hero.x+1,this_hero.y+1)==9||tile_at(this_hero.x+hero_width-1,this_hero.y+1)==9||tile_at(this_hero.x+1,this_hero.y+31)==9||tile_at(this_hero.x+hero_width-1,this_hero.y+31)==9){this_hero.state=3;this_hero.vy=-1.5*jump_speed}if(this_hero.on_moving_object&&(is_solid(tile_at(this_hero.x,this_hero.y+1))||is_solid(tile_at(this_hero.x+hero_width,this_hero.y+1)))){this_hero.state=3;this_hero.vy=-1*jump_speed}if(this_hero.space[frame])this_hero.pickdrop^=1;if(this_hero.pickdrop){if(this_hero.cube_held===null)for(i in level_data.cubes)if(this_hero.x+hero_width>=level_data.cubes[i].x&&this_hero.x<=level_data.cubes[i].x+31&&this_hero.y+31+4>=level_data.cubes[i].y&&this_hero.y<=level_data.cubes[i].y+31){this_hero.cube_held=i;level_data.cubes[i].hero=this_hero;this_hero.pick_cube_animation_frame=5;break}}else if(current_cube=level_data.cubes[this_hero.cube_held]){current_cube.x=this_hero.x;current_cube.cube_below=null;if(!this_hero.grounded)if(this_hero.direction==0)current_cube.vx=-14;else current_cube.vx=14;if(is_solid(tile_at(current_cube.x,current_cube.y)))current_cube.x=~~(current_cube.x/32)*32+32;else if(is_solid(tile_at(current_cube.x,current_cube.y+31)))current_cube.x=~~(current_cube.x/32)*32+32;else if(is_solid(tile_at(current_cube.x+32,current_cube.y)))current_cube.x=~~(current_cube.x/32)*32-1;else if(is_solid(tile_at(current_cube.x+32,current_cube.y+31)))current_cube.x=~~(current_cube.x/32)*32-1;current_cube.hero=null;level_data.cubes[this_hero.cube_held]=current_cube;this_hero.cube_held=null;this_hero.weight=1}if(this_hero.cube_held!==null){if(this_hero.direction==0)level_data.cubes[this_hero.cube_held].x=this_hero.x-6;if(this_hero.direction==1)level_data.cubes[this_hero.cube_held].x=this_hero.x-4;if(this_hero.pick_cube_animation_frame)this_hero.pick_cube_animation_frame--;if(this_hero.in_portal)level_data.cubes[this_hero.cube_held].y=this_hero.y;else if(is_solid(tile_at(this_hero.x,this_hero.y-28))||is_solid(tile_at(this_hero.x+hero_width,this_hero.y-28)))level_data.cubes[this_hero.cube_held].y=~~((this_hero.y+4)/32)*32;else level_data.cubes[this_hero.cube_held].y=this_hero.y-32+this_hero.pick_cube_animation_frame*4}else this_hero.pickdrop=0;if(tile_at(this_hero.x+hero_width/2,this_hero.y+16)==2||tile_at(this_hero.x+hero_width/2,this_hero.y+16)==24){coins_left=0;for(j=0;j<20;j++)for(i=0;i<40;i++)if(level_data.tiles[j][i]==6)coins_left++;if(coins_left==0){win=true;this_hero.state=0}}if(!this_hero.in_portal&&(this_hero.leftclick[frame]||this_hero.rightclick[frame])){this_hero.shoot_blue=0;this_hero.shoot_orange=0;if(this_hero.leftclick[frame]){this_hero.shoot_blue=1;this_hero.angle=Math.atan2(this_hero.leftclick[frame][0]-(this_hero.x+hero_width/2),this_hero.leftclick[frame][1]-(this_hero.y+40+16))}if(this_hero.rightclick[frame]){this_hero.shoot_orange=1;this_hero.angle=Math.atan2(this_hero.rightclick[frame][0]-(this_hero.x+hero_width/2),this_hero.rightclick[frame][1]-(this_hero.y+40+16))}this_hero.portal_shoot_x=this_hero.x+hero_width/2;this_hero.portal_shoot_y=this_hero.y+16;this_hero.portal_shoot_vx=Math.sin(this_hero.angle);this_hero.portal_shoot_vy=Math.cos(this_hero.angle)}for(current_portal in portals=[["shoot_blue",blue_portal,"blue"],["shoot_orange",orange_portal,"orange"]])if(this_hero[portals[current_portal][0]])for(i=0;i<40;i++){this_hero[portals[current_portal][0]]+=.001;this_hero.portal_shoot_x+=this_hero[portals[current_portal][0]]*this_hero.portal_shoot_vx;this_hero.portal_shoot_y+=this_hero[portals[current_portal][0]]*this_hero.portal_shoot_vy;if(is_solid(tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y))||tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y)==7){this_hero[portals[current_portal][0]]=0;if(this_hero.portal_shoot_x%32<4&&!is_solid(tile_at(this_hero.portal_shoot_x-32,this_hero.portal_shoot_y))&&this_hero.portal_shoot_vx>0)temp_side=3;if(this_hero.portal_shoot_x%32>28&&!is_solid(tile_at(this_hero.portal_shoot_x+32,this_hero.portal_shoot_y))&&this_hero.portal_shoot_vx<0)temp_side=1;if(this_hero.portal_shoot_y%32<4&&!is_solid(tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y-32))&&this_hero.portal_shoot_vy>0)temp_side=0;if(this_hero.portal_shoot_y%32>28&&!is_solid(tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y+32))&&this_hero.portal_shoot_vy<0)temp_side=2;if(tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y)==8){this_hero[portals[current_portal][0]]=1;if(temp_side==0){this_hero.portal_shoot_vy=-this_hero.portal_shoot_vy;this_hero.portal_shoot_y=~~(this_hero.portal_shoot_y/32)*32-1}else if(temp_side==2){this_hero.portal_shoot_vy=-this_hero.portal_shoot_vy;this_hero.portal_shoot_y=~~(this_hero.portal_shoot_y/32)*32+32+1}else if(temp_side==1){this_hero.portal_shoot_vx=-this_hero.portal_shoot_vx;this_hero.portal_shoot_x=~~(this_hero.portal_shoot_x/32)*32+32+1}else{this_hero.portal_shoot_vx=-this_hero.portal_shoot_vx;this_hero.portal_shoot_x=~~(this_hero.portal_shoot_x/32)*32-1}}if(tile_at(this_hero.portal_shoot_x,this_hero.portal_shoot_y)==4&&(~~(this_hero.portal_shoot_x/32)!=portals[1-current_portal][1].tile_x||~~(this_hero.portal_shoot_y/32)!=portals[1-current_portal][1].tile_y||portals[1-current_portal][1].side!=temp_side)){portals[current_portal][1].tile_x=~~(this_hero.portal_shoot_x/32);portals[current_portal][1].tile_y=~~(this_hero.portal_shoot_y/32);portals[current_portal][1].side=temp_side}break}else{c.fillStyle=portals[current_portal][2];c.fillRect(this_hero.portal_shoot_x,this_hero.portal_shoot_y+40,6,6)}}if(tile_at(this_hero.x+1,this_hero.y+1)!=4&&tile_at(this_hero.x+hero_width-1,this_hero.y+1)!=4&&tile_at(this_hero.x+1,this_hero.y+31)!=4&&tile_at(this_hero.x+ +hero_width-1,this_hero.y+31)!=4)this_hero.in_portal=false;if(this_hero.teleport_idle)this_hero.teleport_idle--}if(this_hero.state==3){this_hero.vy+=gravity;if(this_hero.vy>max_fall_speed)this_hero.vy=max_fall_speed;this_hero.y+=this_hero.vy}};var draw_hero=function(hero,past){c.save();c.translate(hero.x+hero_width/2-2,hero.y);if(hero.direction==0)c.scale(-1,1);if(past)c.globalAlpha=.75;else if(heros.length){c.fillStyle="#fff";c.fillText("\u25bc",0,10)}if(!(past&&frame>hero.last_frame))c.drawImage(tileset,[26,[27,28,29][~~(frame/2)%3],30,31][hero.state]*16,0,16,16,-hero_width/2,40,32,32);c.restore()};var draw_portals=function(){for(i in j={"blue":blue_portal,"orange":orange_portal})draw_tile(4,j[i].tile_x,j[i].tile_y);for(i in j={"blue":blue_portal,"orange":orange_portal}){c.fillStyle=i;if(j[i].side==0)c.fillRect(j[i].tile_x*32,j[i].tile_y*32+40-8,32,8);if(j[i].side==1)c.fillRect(j[i].tile_x*32+28,j[i].tile_y*32+40,8,32);if(j[i].side==2)c.fillRect(j[i].tile_x*32,j[i].tile_y*32+40+28,32,8);if(j[i].side==3)c.fillRect(j[i].tile_x*32-4,j[i].tile_y*32+40,8,32)}};var update_mechanisms=function(){if(yellow_toggle!=yellow_toggle_last_frame)for(j=0;j<20;j++)for(i=0;i<40;i++)if(level_data.tiles[j][i]==9)level_data.tiles[j][i]=10;else if(level_data.tiles[j][i]==10)level_data.tiles[j][i]=9;yellow_toggle_last_frame=yellow_toggle;for(i in level_data.balances){if(balances_state[i].weight1>balances_state[i].weight2&&!is_solid(tile_at(level_data.balances[i][0]*32-32,balances_state[i].y1+20))&&!is_solid(tile_at(level_data.balances[i][0]*32,balances_state[i].y1+20))&&!is_solid(tile_at(level_data.balances[i][0]*32+32,balances_state[i].y1+20))&&!is_solid(tile_at(level_data.balances[i][2]*32-32,balances_state[i].y2-4))&&!is_solid(tile_at(level_data.balances[i][2]*32,balances_state[i].y2-4))&&!is_solid(tile_at(level_data.balances[i][2]*32+32,balances_state[i].y2-4))){balances_state[i].y1+=4;balances_state[i].y2-=4}else if(balances_state[i].weight2>balances_state[i].weight1&&!is_solid(tile_at(level_data.balances[i][2]*32-32,balances_state[i].y2+20))&&!is_solid(tile_at(level_data.balances[i][2]*32,balances_state[i].y2+20))&&!is_solid(tile_at(level_data.balances[i][2]*32+32,balances_state[i].y2+20))&&!is_solid(tile_at(level_data.balances[i][0]*32-32,balances_state[i].y1-4))&&!is_solid(tile_at(level_data.balances[i][0]*32,balances_state[i].y1-4))&&!is_solid(tile_at(level_data.balances[i][0]*32+32,balances_state[i].y1-4))){balances_state[i].y1-=4;balances_state[i].y2+=4}c.beginPath();c.strokeStyle="#fff";c.lineWidth=2;c.moveTo(level_data.balances[i][0]*32+16,balances_state[i].y1+40+8);c.lineTo(level_data.balances[i][2]*32+16,balances_state[i].y2+40+8);c.stroke();c.closePath();draw_sprite(15,level_data.balances[i][0]*32-32,balances_state[i].y1+40);draw_sprite(15,level_data.balances[i][0]*32,balances_state[i].y1+40);draw_sprite(15,level_data.balances[i][0]*32+32,balances_state[i].y1+40);draw_sprite(15,level_data.balances[i][2]*32-32,balances_state[i].y2+40);draw_sprite(15,level_data.balances[i][2]*32,balances_state[i].y2+40);draw_sprite(15,level_data.balances[i][2]*32+32,balances_state[i].y2+40)}};var victory_or_defeat=function(){c.font="bold 100px arial";c.fillStyle="#000";c.textAlign="center";if(win){win_frame++;c.fillText("CLEARED!",640,350)}if(current_hero.state==3){lose_frame++;c.fillText("LOST!",640,350)}for(hero in heros)if(heros[hero].state==3||heros[hero].last_frame<frame&&!heros[hero].safe){paradox_frame++;c.fillText("PARADOX!",640,350)}if(lose_frame>=30){a.width^=0;clearInterval(loop);screen=last_screen;level_data.tested=true;a.width^=0;draw_screen()}if(paradox_frame)for(m=~~(paradox_frame/5);m--;)c.drawImage(a,i=Math.random()*1280,j=Math.random()*648,k=Math.random()*1280,l=Math.random()*648,i+Math.random()*100-50,j+Math.random()*100-50,k,l);if(win_frame>=30||lose_frame>=30||paradox_frame>=80){a.width^=0;clearInterval(loop);screen=last_screen;level_data.tested=true;a.width^=0;draw_screen()}};var move_cubes=function(){for(var i in level_data.cubes){if(tile_at(level_data.cubes[i].x+1,level_data.cubes[i].y+1)!=4&&tile_at(level_data.cubes[i].x+32-1,level_data.cubes[i].y+1)!=4&&tile_at(level_data.cubes[i].x+1,level_data.cubes[i].y+31)!=4&&tile_at(level_data.cubes[i].x+32-1,level_data.cubes[i].y+31)!=4)level_data.cubes[i].in_portal=false;if(level_data.cubes[i].teleport_idle)level_data.cubes[i].teleport_idle--;if(level_data.cubes[i].hero===null){if(!level_data.cubes[i].teleport_idle&&!is_solid(tile_at(level_data.cubes[i].x,level_data.cubes[i].y+31))&&!is_solid(tile_at(level_data.cubes[i].x+31,level_data.cubes[i].y+31)))if(level_data.cubes[i].vx>1)level_data.cubes[i].vx-=1;else if(level_data.cubes[i].vx<-1)level_data.cubes[i].vx+=1;else level_data.cubes[i].vx=0;gravity_and_collisions(level_data.cubes[i],32,1)}c.drawImage(tileset,12*16,0,16,16,level_data.cubes[i].x,40+level_data.cubes[i].y,32,32)}};var c=a.getContext("2d");localStorage["scpm"]=20;var screen=1;var last_screen=0;var mousedown=false;var rightclick=false;var hero_width=24;var gravity=2;var max_fall_speed=24;var jump_speed=20;var walk_speed=6;var tile_x=tile_y=0;var x=y=0;var level=0;var level_data={};var i,j,k,l,m;var pipe_click,current_pipe,balance_click,current_balance,current_editor_tile,mouse_tile_x,mouse_tile_y,pipe_high,pipe_low,end_pipe,end_pole,number,drawn_tile,shared,chose_a_tile;var win,win_frame,lose_frame,paradox_frame,coins_left,loop,frame,current_hero,solid,yellow_toggle,yellow_toggle_last_frame,pipes_state,balances_state,yellow_toggle_delay,yellow_toggle_on,blue_portal,orange_portal,temp_side,heros,hero,target,current_cube,portals,current_portal;var levels=[{},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000006060600000000000000006000000000000000000000000000004004000000000000000000000F000000000000044004400000000000000000000G00000000000044400444000070000700000400333333333333333330033333333333333333333333333333333333333003333333333333333333330000000000000000000000000000000000000000","pipes":[[]],"balances":[]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006006000000000000000000002000000000500500500500004000400000000000000F000000000000000000044000440000000000000G00000000000000000044400044400077000000333333333333333333333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004004004008008000002000000600600600004000000000000000000000000F000000000000044400000000000000000000000G00000000000044444000000000000000000000333888888888888888888888888888888888833333388888888888888888888888888888888883330000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000020000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000600000<0000000000000000000000000000000000000000000000040000000040000000000<00<004000000000000440000000044000000F000000004400000000004440000000044400000G00000000444000000004444000000004444000333333333333333303333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000<00000000000000000000000000000000000000000000000000000000000000000000000000000099990000000000000000000000000000000000000009000000000000000000000000000000000000:::9000000000000000000000000000000000000000900000000000000000000000000000000000099990000000000000000000000000000000000000009000000000000000000000000000000000000:::900000000000000000000000000000000000000090000000000000000000000000000000000006669000000000000000000000000000020000000000900000<00000000000000000000000000000099990000050000000000000000000000400000000009000000000000000000000000000040F000000009000000000000000000000000000040G0;000000900;000000;00000000000;000000433333333333333333999999933333::::::3333333333333333333333999999933333::::::333330000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003333333333300000000000440000000000000000000000000000000000000000000000000060000000000000000000000000000000600000000000000<000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000000000000000000000000000000000000000G00000000000000000000000000000000000000333333333333333333333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000","pipes":[[8,8,16,6,16],[24,16,6,22,16],[35,7,16,30,5]],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<00000000000000000000000000000000000000000000000000000000000000000000000099999999900000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000F000000000000000000000000000000000000000G0000000000000000000000000000000000000333333000000000000000000000000000000000033333300000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000;0000600000000000000400000000000000000333330060000000000000040000000000000000033333006000000003333333300000000000000000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[[8,9,13,17],[28,6,23,14]]},{"hash":"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444000000000000000000000000000300000000000000000000000000000000000040030606060600000000000000000000000000604003000000000<0000000000000000000000000040030000000000000000000000000000000000004003000004444444000000000000000000000000400300000300000000000000000000000000000040030000030000000000000000000000000000004003000003000000000000000000000000000000400300000300000000000000000000000000000040030000030000000000000000002000000000004003000003000000000000000000000000000000400400F004000000000000000000000000000000400400G0040000000000000000000000000000;040044444440000000000000000003::::::::3333000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000004444000000000000000000000000000000000000400000000000000000000000000000000000000040000000000000000000000000000000000000004000000000000000000000000000000000000000400000000000000000000000000000000000000040000000000000000000000000000000000000004000000000000000000000000000000000000000400000000000000000000000000000000000000040000000000000000000000000000000000000004000000000000000000000000000000000000000400000000006000000000000000000000000000040000000000000000000000000000000000000004000000000000000000000000000000000002000400000000000000000000000000000000000000040000F000000000000000000000000000000000040000G000000000000000000000000000000000044444444444400000000000088888888888888000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888888888888888888880000000000000000000030000000000000000008000000000000000000003000000000000000000800000000000000000000300200000000000000080000000000000000000030000000000000000008000000000000000000003000000000006000000800000000000000000000300000000000000000080000000000000000000044444444444440600008000000000000000000003000000000000000000800000000000000000000300000000000600000080000000000000000000030000000000000000008000000000000000000003000000000000000000800000000000000000000300F000000000000000800000000000000000000300G000000000000000800000000000000000000444444444444400000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000008888888888888888888888888888888888888800800000000000000000000000000000000000080080000000000000000000000000000000000008008998000000000000000000000000000008:::8008998000000000000000000000000000008:::8008998000000000000000000000000000008:::8008008000000000000000000000000000008000800800800000000000000000000000000000800080080080000000000000000000000000000080008008008000000043333333333300000000008000800800800000044300000300000006666660800080080080000044430000030000000000000080008008008333333333000003002000333333338000800800800000000000000400000000000000000080080000000000000F000400000000000000000080080000000000000G0;0400000000000000000080080000000000003333333333000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"00000000000000000044000000000000000000000000000000000000000000000000000000000000000000000000000002F000000000000000000000000000000000000000G0000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000000000000000060000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[[],[19,7,24,4],[19,9,24,15],[19,11,14,15],[19,13,14,4]]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020300000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000333333333300000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000306000000000000300000000000000000000000030000000F000000300000000000000000000000030000000G00000030000000000000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[[21,16,8,10,16]],"balances":[]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000333009990000000000000000000000000600::0000000000000000000000000000000000000:::000000000000000000000000000000000600::::00000000000000000000000000000000000:::::0000000000000000000000000000000600::::::000000000000000000000000000000000:::::::00000000000000000000000000000600::::::::0000000000000000000000000000000:::::::::0000000000000000000000F0000600::::::::::0000000000000000000000G00;000:::::::::::00000000000000000333333333333333333333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000030","pipes":[],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000333300000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000000000000000000030000000000000000000000000030F000000000030000000000000000000000000030G00000<000030000000000000000000000000033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000030000000000000000003000000606060606060603000000000000000000300000000000000000000300000000000000000030999::::::::::::::::3000000000000000000300000000000000000000300000000000000000030000000000000000000030000000000000000003000000000000000000003000000000000000000300000000000000000020300000000000000000030000000000000000000030000000000000000003000000000000000000003000000000000000000300000000000000000000300000000000000000030000000000000000F00030000000000000000003000000;000000000G00030000000000000000003333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[[11,15,6,21,15]],"balances":[]},{"hash":"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000060000000000000000000000000000000000000006000000000000000000000000000000000;;;;;;;000000000000000000000000000000000333333300000000000020000000000000000000030000000000000000000000000000000000000003000000000000000003000000000000000000000300000000000000000300F000000000000000000300000000000000000300G00000000000000000030000000000000000033333399999999999933333000000000000000000000030000000000003000000000000000000000000003000000000000300000000000000000000000000300000000000030000000000000000000000000033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[[25,12,7,17,12]],"balances":[]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000020300000000000000000000000000000000000000030000000000000000000000000000000000033333000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000000000000000000030000000000000000000000000000000000000003000000000000000000000000000000000000000300000000000000000000000030F000000000000300000000000000000000000030G000<00<00<0030000000000000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[],"balances":[]},{"hash":"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034443000003444300000000090000000000000003000300000300030000000009000000000000000000030000000000000000000900000000000000000003000000000000000000090000000000000000000300;00000000000000009000000000003330000033333000000000000000900000000000000000000000000000000000000090000000000000000000000000000000000000009000000000000000000000000000000000000000900000000000000000000000000000000000000090000000000000000000000000000000000000009020000000000000000000000000000000000000900000000000F000000000000000000000000000900000000000G0000000000000000000000000009000000000044444444444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[[24,3,16,3,7]],"balances":[[8,12,18,12]]},{"hash":"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000=000000000000000000000000000006060606060=000000000000000000000000000000000000000=00000000000000000000000000000003333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000444000000F000000000000000000000000300004444400000G000000003000000000000000333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","pipes":[[24,16,6,19,16]],"balances":[[]]}];a.onclick=a.oncontextmenu=function(e){handle_clicks(e);return false};a.onmousedown=function(e){mousedown=true;if(e.which==3)rightclick=true;else rightclick=false};a.onmouseup=function(){mousedown=false};a.onmousemove=function(e){x=e.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=e.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;tile_x=Math.floor(x/32);tile_y=Math.floor((y-40)/32);if(screen==3){if(mousedown&&current_editor_tile!=14&&current_editor_tile!=15)handle_clicks(e);draw_screen(1)}};var handle_clicks=function(e){if(screen==0){c.beginPath();c.rect(500,400,100,80);if(c.isPointInPath(x,y)){screen=1;draw_screen()}c.closePath();c.beginPath();c.rect(650,400,100,80);if(c.isPointInPath(x,y)){screen=3;reset_maker_level();draw_screen()}c.closePath()}if(screen==1){c.beginPath();c.rect(30,30,50,50);if(c.isPointInPath(x,y)){screen=0;draw_screen()}c.closePath();c.beginPath();c.rect(590,520,100,80);if(c.isPointInPath(x,y))location="todo";c.closePath();for(i=0;i<10;i++)for(j=0;j<3;j++){number=j*10+i+1;if(+localStorage["scpm"]>=number){c.beginPath();c.rect(i*120+50,j*100+120,100,80);if(c.isPointInPath(x,y)){last_screen=1;screen=2;level=number;level_data=levels[number];draw_screen()}c.closePath()}}}if(screen==2&&frame>0){if(e.which==1)current_hero.leftclick[frame]=[x,y];if(e.which==3)current_hero.rightclick[frame]=[x,y];c.beginPath();c.rect(1240,0,32,32);if(c.isPointInPath(x,y)){clearInterval(loop);screen=last_screen;draw_screen()}c.closePath()}if(screen==3){level_data.hash="";for(j=0;j<20;j++)for(i=0;i<40;i++){tile=level_data.tiles[j][i]||0;tile=tile<16||tile>21?tile:0;level_data.hash+=String.fromCharCode(tile+48)}c.beginPath();c.rect(750,4,100,32);if(c.isPointInPath(x,y)){last_screen=3;screen=2;draw_screen()}c.closePath();c.beginPath();c.rect(875,4,100,32);if(c.isPointInPath(x,y)){location.hash="";if(level_data.tested==false){alert("You need to test and win your level first.");prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:level_data.hash,pipes:level_data.pipes,balances:level_data.balances})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:level_data.hash,pipes:level_data.pipes,balances:level_data.balances}))}else{prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:level_data.hash,pipes:level_data.pipes,balances:level_data.balances})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:level_data.hash,pipes:level_data.pipes,balances:level_data.balances}));shared=true}}c.closePath();c.beginPath();c.rect(1E3,4,100,32);if(c.isPointInPath(x,y)){reset_maker_level();draw_screen()}c.closePath();c.beginPath();c.rect(1125,4,100,32);if(c.isPointInPath(x,y))if(quit()){screen=0;draw_screen()}c.closePath();for(i=0;i<16;i++){c.beginPath();c.rect(8.5+i*35,3.5,32,32);if(c.isPointInPath(x,y)&&pipe_click==0&&balance_click==0){chose_a_tile=true;current_editor_tile=i;if(current_editor_tile==14)level_data.pipes[current_pipe]=[];if(current_editor_tile==15)level_data.balances[current_balance]=[];draw_screen()}c.closePath()}c.beginPath();c.rect(0,40,1280,608);if(c.isPointInPath(x,y)){if(chose_a_tile)shared=false;level_data.tested=false;if(rightclick==true){if(level_data.tiles[tile_y][tile_x]==22){level_data.tiles[tile_y][tile_x]=0;level_data.tiles[tile_y+1][tile_x]=0}if(level_data.tiles[tile_y][tile_x]==23){level_data.tiles[tile_y][tile_x]=0;level_data.tiles[tile_y-1][tile_x]=0}if(is_writable(tile_x,tile_y))level_data.tiles[tile_y][tile_x]=0;if(pipe_click==0){if(level_data.tiles[tile_y][tile_x]==16)for(i in level_data.pipes)if(level_data.pipes[i][0]==tile_x&&(level_data.pipes[i][1]==tile_y||level_data.pipes[i][2]==tile_y)){for(j=level_data.pipes[i][1];j<20;j++)if(level_data.tiles[j][tile_x]==16||level_data.tiles[j][tile_x]==18){level_data.tiles[j][tile_x]=0;level_data.tiles[j][tile_x+1]=0}else break;for(j=level_data.pipes[i][2];j<20;j++)if(level_data.tiles[j][tile_x]==16||level_data.tiles[j][tile_x]==18){level_data.tiles[j][tile_x]=0;level_data.tiles[j][tile_x+1]=0}else break;level_data.tiles[level_data.pipes[i][4]][level_data.pipes[i][3]]=0;delete level_data.pipes[i]}if(level_data.tiles[tile_y][tile_x]==17)for(i in level_data.pipes)if(level_data.pipes[i][0]==tile_x-1&&(level_data.pipes[i][1]==tile_y||level_data.pipes[i][2]==tile_y)){for(j=level_data.pipes[i][1];j<20;j++)if(level_data.tiles[j][tile_x]==17||level_data.tiles[j][tile_x]==19){level_data.tiles[j][tile_x]=0;level_data.tiles[j][tile_x-1]=0}else break;for(j=level_data.pipes[i][2];j<20;j++)if(level_data.tiles[j][tile_x]==17||level_data.tiles[j][tile_x]==19){level_data.tiles[j][tile_x]=0;level_data.tiles[j][tile_x-1]=0}else break;level_data.tiles[level_data.pipes[i][4]][level_data.pipes[i][3]]=0;delete level_data.pipes[i]}level_data.tmp=level_data.pipes;level_data.pipes=[];for(i in level_data.tmp)if(level_data.tmp[i])level_data.pipes.push(level_data.tmp[i])}if(balance_click==0){if(level_data.tiles[tile_y][tile_x]==15)for(i in level_data.balances)if(level_data.balances[i][1]==tile_y&&(level_data.balances[i][0]==tile_x||level_data.balances[i][0]==tile_x-1||level_data.balances[i][0]==tile_x+1)||level_data.balances[i][3]==tile_y&&(level_data.balances[i][2]==tile_x||level_data.balances[i][2]==tile_x-1||level_data.balances[i][2]==tile_x+1)){level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]]=0;level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]-1]=0;level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]+1]=0;level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]]=0;level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]-1]=0;level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]+1]=0;delete level_data.balances[i]}level_data.tmp=level_data.balances;level_data.balances=[];for(i in level_data.tmp)if(level_data.tmp[i])level_data.balances.push(level_data.tmp[i])}}else if(current_editor_tile==1){if(tile_y>0&&is_writable(tile_x,tile_y)&&is_writable(tile_x,tile_y-1)){for(j in level_data.tiles)for(i in level_data.tiles[j])if(level_data.tiles[j][i]==22||level_data.tiles[j][i]==23)level_data.tiles[j][i]=0;level_data.tiles[tile_y-1][tile_x]=22;level_data.tiles[tile_y][tile_x]=23}}else if(current_editor_tile==2){if(is_writable(tile_x,tile_y)){for(j in level_data.tiles)for(i in level_data.tiles[j])if(level_data.tiles[j][i]==2)level_data.tiles[j][i]=0;level_data.tiles[tile_y][tile_x]=2}}else if(current_editor_tile==14){if(is_writable(tile_x,tile_y)&&is_writable(tile_x+1,tile_y))if(pipe_click==0){level_data.pipes[current_pipe]=[];level_data.pipes[current_pipe][0]=tile_x;level_data.pipes[current_pipe][1]=tile_y;level_data.tiles[tile_y][tile_x]=16;level_data.tiles[tile_y][tile_x+1]=17;pipe_click++}else if(pipe_click==1){if(true){level_data.pipes[current_pipe][2]=tile_y;level_data.tiles[tile_y][level_data.pipes[current_pipe][0]]=16;level_data.tiles[tile_y][level_data.pipes[current_pipe][0]+1]=17;pipe_click++}}else if(pipe_click==2){level_data.pipes[current_pipe][3]=tile_x;level_data.pipes[current_pipe][4]=tile_y;level_data.tiles[tile_y][tile_x]=20;current_pipe++;pipe_click=0}}else if(current_editor_tile==15){if(is_writable(tile_x-1,tile_y)&&is_writable(tile_x,tile_y)&&is_writable(tile_x+1,tile_y)){if(balance_click==0){level_data.balances[current_balance]=[];level_data.balances[current_balance][0]=tile_x;level_data.balances[current_balance][1]=tile_y;balance_click++}else if(balance_click==1){level_data.balances[current_balance][2]=tile_x;level_data.balances[current_balance][3]=tile_y;current_balance++;balance_click=0}level_data.tiles[tile_y][tile_x-1]=15;level_data.tiles[tile_y][tile_x]=15;level_data.tiles[tile_y][tile_x+1]=15}}else if(is_writable(tile_x,tile_y))level_data.tiles[tile_y][tile_x]=current_editor_tile;draw_screen(1)}c.closePath()}};onkeydown=function(e){if(screen==2){if(e.keyCode==38||e.keyCode==90||e.keyCode==87)if(current_hero.can_jump){current_hero.keyup=true;current_hero.can_jump=false}if(e.keyCode==39||e.keyCode==68)current_hero.keyright=true;if(e.keyCode==37||e.keyCode==65||e.keyCode==81)current_hero.keyleft=true}};onkeyup=function(e){if(screen==2){if(e.keyCode==38||e.keyCode==90||e.keyCode==87){current_hero.keyup=false;current_hero.can_jump=true}if(e.keyCode==39||e.keyCode==68)current_hero.keyright=false;if(e.keyCode==37||e.keyCode==65||e.keyCode==81)current_hero.keyleft=false;if(e.keyCode==82)reset_current_level();if(e.keyCode==32)current_hero.space[frame]=true;if(e.keyCode==16)current_hero.shift[frame]=true}};var draw_screen=onload=onhashchange=function(no_reset){a.width^=0;c.font="bold 30px arial";c.textAlign="center";c["mozImageSmoothingEnabled"]=false;c["imageSmoothingEnabled"]=false;if(screen==0){a.style.cursor="pointer";c.drawImage(tileset,512,0,70,16,120,150,280,64);c.drawImage(tileset,583,0,270,16,120,250,1080,64);c.fillStyle="#000";c.beginPath();c.fillRect(500,400,100,80);c.fillRect(650,400,100,80);c.fillStyle="#fff";c.fillText("MAKE",700,450);c.fillText("PLAY",550,450);c.stroke();c.closePath()}if(screen==1){a.style.cursor="pointer";c.beginPath();c.fillStyle="#000";c.fillRect(590,520,100,80);for(i=0;i<10;i++)for(j=0;j<3;j++){number=j*10+i+1;c.fillStyle="#000";c.fillRect(i*120+50,j*100+120,100,80);c.fillStyle="#fff";c.fillText(+localStorage["scpm"]>=number?number:"?",i*120+100,j*100+170)}c.fillText("\u25c0",40,70);c.fillText("LEVELS",640,70);c.fillText("MORE LEVELS ONLINE",640,470);c.fillText("GO",640,570);c.stroke();c.closePath()}if(screen==2){a.style.cursor="crosshair";if(loop)clearInterval(loop);reset_current_level();loop=setInterval(play,33)}if(screen==3){a.style.cursor="pointer";c.strokeStyle="#777";c.lineWidth=1;c.fillStyle="#fff";c.fillRect(0,0,1280,648);c.fillStyle="#5C94FC";c.fillRect(0,40,1280,640);c.beginPath();for(i=0;i<16;i++){c.fillRect(8+i*35,3,32,32);c.rect(8+i*35,3,32,32);draw_sprite(i,8+i*35,3)}c.stroke();c.closePath();if(!no_reset)if(level_data.hash){level_data.tiles=[];for(var j=0;j<20;j++){level_data.tiles[j]=[];for(var i=0;i<40;i++)level_data.tiles[j][i]=level_data.hash.charCodeAt(j*40+i)-48}}for(j=0;j<level_data.tiles.length;j++)for(i=0;i<level_data.tiles[j].length;i++){drawn_tile=level_data.tiles[j][i];draw_tile(drawn_tile,i,j);if(drawn_tile==2){end_pole=false;if(j<20)for(k=j+1;k<20;k++)if(!level_data.tiles[k][i]&&!end_pole)draw_tile(24,i,k);else end_pole=true}}for(i in level_data.pipes){pipe_low=level_data.pipes[i][1];if(level_data.pipes[i][2]){pipe_high=level_data.pipes[i][1]<level_data.pipes[i][2]?level_data.pipes[i][1]:level_data.pipes[i][2];pipe_low=level_data.pipes[i][1]<level_data.pipes[i][2]?level_data.pipes[i][2]:level_data.pipes[i][1];for(k=pipe_high+1;k<pipe_low;k++){draw_tile(18,level_data.pipes[i][0],k);draw_tile(19,level_data.pipes[i][0]+1,k);level_data.tiles[k][level_data.pipes[i][0]]=18;level_data.tiles[k][level_data.pipes[i][0]+1]=19}}if(level_data.pipes[i][1]){end_pipe=false;for(k=pipe_low+1;k<21;k++)if(k<20&&!level_data.tiles[k][level_data.pipes[i][0]]&&!level_data.tiles[k][level_data.pipes[i][0]+1]&&!end_pipe){draw_tile(18,level_data.pipes[i][0],k);draw_tile(19,level_data.pipes[i][0]+1,k)}else end_pipe=true}if(level_data.pipes[i][1]){draw_tile(16,level_data.pipes[i][0],level_data.pipes[i][1]);draw_tile(17,level_data.pipes[i][0]+1,level_data.pipes[i][1]);level_data.tiles[level_data.pipes[i][1]][level_data.pipes[i][0]]=16;level_data.tiles[level_data.pipes[i][1]][level_data.pipes[i][0]+1]=17}if(level_data.pipes[i][2]){draw_tile(16,level_data.pipes[i][0],level_data.pipes[i][2]);draw_tile(17,level_data.pipes[i][0]+1,level_data.pipes[i][2]);level_data.tiles[level_data.pipes[i][2]][level_data.pipes[i][0]]=16;level_data.tiles[level_data.pipes[i][2]][level_data.pipes[i][0]+1]=17}if(level_data.pipes[i][4])draw_tile(20,level_data.pipes[i][3],level_data.pipes[i][4])}for(i in level_data.balances){if(level_data.balances[i][3]){c.beginPath();c.strokeStyle="#fff";c.lineWidth=2;c.moveTo(level_data.balances[i][0]*32+16,level_data.balances[i][1]*32+40+8);c.lineTo(level_data.balances[i][2]*32+16,level_data.balances[i][3]*32+40+8);c.stroke();c.closePath();draw_tile(15,level_data.balances[i][2]-1,level_data.balances[i][3]);draw_tile(15,level_data.balances[i][2],level_data.balances[i][3]);draw_tile(15,level_data.balances[i][2]+1,level_data.balances[i][3]);level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]-1]=15;level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]]=15;level_data.tiles[level_data.balances[i][3]][level_data.balances[i][2]+1]=15}if(level_data.balances[i][1]){draw_tile(15,level_data.balances[i][0]-1,level_data.balances[i][1]);draw_tile(15,level_data.balances[i][0],level_data.balances[i][1]);draw_tile(15,level_data.balances[i][0]+1,level_data.balances[i][1]);level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]-1]=15;level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]]=15;level_data.tiles[level_data.balances[i][1]][level_data.balances[i][0]+1]=15}}if(tile_y>=0&&!rightclick)if(current_editor_tile==1){if(tile_y>0){draw_tile(22,tile_x,tile_y-1);draw_tile(23,tile_x,tile_y)}}else if(current_editor_tile==14){if(pipe_click==0){draw_tile(16,tile_x,tile_y);draw_tile(17,tile_x+1,tile_y)}if(pipe_click==1){draw_tile(16,level_data.pipes[current_pipe][0],tile_y);draw_tile(17,level_data.pipes[current_pipe][0]+1,tile_y)}if(pipe_click==2)draw_tile(20,tile_x,tile_y)}else if(current_editor_tile==15){draw_tile(15,tile_x-1,tile_y);draw_tile(15,tile_x,tile_y);draw_tile(15,tile_x+1,tile_y)}else draw_tile(current_editor_tile,tile_x,tile_y);c.beginPath();c.strokeStyle="#777";c.lineWidth=1;for(i=0;i<40;i++){c.moveTo(i*32,40);c.lineTo(i*32,648)}for(j=0;j<20;j++){c.moveTo(0,40+j*32);c.lineTo(1280,40+j*32)}c.fillStyle="#000";c.fillRect(750,4,100,32);c.fillRect(875,4,100,32);c.fillRect(1E3,4,100,32);c.fillRect(1125,4,100,32);c.fillStyle="#fff";c.font="bold 20px arial";c.fillText("TEST",800,28);c.fillText("SHARE",925,28);c.fillText("CLEAR",1050,28);c.fillText("EXIT",1175,28);c.stroke();c.closePath();c.beginPath();i=current_editor_tile;c.strokeStyle="red";c.lineWidth=3;c.rect(8+i*35,3.5,32,32);c.stroke();c.closePath()}};var play=function(){a.width^=0;c.font="bold 30px arial";c.fillStyle="#000";c.fillText("\u00d7",1255,25);if(last_screen==1){c.font="bold 30px arial";c.fillStyle="black";c.textAlign="center";c.fillText([,"Move with arrow keys or WASD or ZQSD. Collect all coins and reach the flag.","If you're stuck, restart with R.","Ice is slippy if you're not standing still.","Press space to hold and drop cubes. Jump and press space to throw them.",,,,"Aim with mouse, send portals with left click and right click.","Use momentum!",,,,"Need a little help from the past? Go to the time machine and press Shift!",,,"Sometimes you need to make multiple time travels...","If a past self dies or can't reach the time machine, it's a paradox! *wink wink theme*",,"Only two portals can exist at the same time.","Clouds will block all your future selves!"][level]||"",640,80)}if(current_hero.keyleft)current_hero.left[frame]=true;if(current_hero.keyright)current_hero.right[frame]=true;if(current_hero.keyup)current_hero.up[frame]=true;c.mozImageSmoothingEnabled=false;c.imageSmoothingEnabled=false;if(frame==0)first_frame();move_draw_pipes();parse_draw_map();reset_mechanisms();for(hero in heros)play_hero(heros[hero],1);if(heros.length)hero=-1;else hero=0;play_hero(current_hero);move_cubes();for(hero in heros)draw_hero(heros[hero],1);draw_hero(current_hero);draw_portals();update_mechanisms();frame++;victory_or_defeat()};onhashchange=function(){if(location.hash){level_data=JSON.parse(decodeURIComponent(location.hash.slice(1)));screen=2;draw_screen()}};onhashchange();quit=function(){if((screen==3||last_screen==3)&&!shared)return confirm("Quit? This level will be lost!")}</script><script>l=(u)=>console.log(u)</script>