<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:crosshair"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function Y(b,c,e){"undefined"!=typeof b.w&&null!==b.w&&(b.weight=1+d.h[b.w].weight);if(0<b.c){if(4==l(b.x+c+b.c,b.y+16)&&0<=h.m&&u==~~((b.x+c+b.c)/32)&&x==~~((b.y+16)/32)&&3==q)b.y=32*~~((b.y+16)/32),b.a=0,b.s=!0,4==l(b.x+c-c/2,b.y+16)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.o,b.v=5,0==h.l&&(b.a=-b.c,b.c=0),2==h.l&&(b.a=b.c,b.c=0),3==h.l&&(b.c=-b.c));else if(4==l(b.x+c+b.c,b.y+16)&&0<=u&&h.m==~~((b.x+c+b.c)/32)&&h.o==~~((b.y+16)/32)&&3==h.l)b.y=32*~~((b.y+16)/32),b.a=0,b.s=!0,4==l(b.x+c-c/2,b.y+16)&&(b.x=32*u,1==q&&(b.x+=16),b.y=32*x,b.v=5,0==q&&(b.a=-b.c,b.c=0),2==q&&(b.a=b.c,b.c=0),3==q&&(b.c=-b.c));else if(r(l(b.x+c+b.c,b.y))||r(l(b.x+c+b.c,b.y+31)))b.x=32*~~((b.x+b.c)/32)+32-c-1,b.c=0;b.x>1280-c&&(b.x=1280-c,b.c=0);for(var f in d.b)!b.s&&b.x+c+b.c>=32*d.b[f][0]&&b.x+c+b.c<=32*d.b[f][0]+16&&b.y+31>=p[f].y&&b.y<=p[f].R&&(b.x=32*d.b[f][0]-c-1,b.c=0)}if(0>b.c){if(4==l(b.x+b.c,b.y+16)&&0<=h.m&&u==~~((b.x+b.c)/32)&&x==~~((b.y+16)/32)&&1==q)b.y=32*~~((b.y+16)/32),b.a=0,b.s=!0,4==l(b.x-c/2,b.y+16)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.o,b.v=5,0==h.l&&(b.a=b.c,b.c=0),2==h.l&&(b.a=-b.c,b.c=0),3==h.l&&(b.c=b.c));else if(4==l(b.x+b.c,b.y+16)&&0<=u&&h.m==~~((b.x+b.c)/32)&&h.o==~~((b.y+16)/32)&&1==h.l)b.y=32*~~((b.y+16)/32),b.a=0,b.s=!0,4==l(b.x-c/2,b.y+16)&&(b.x=32*u,1==q&&(b.x+=16),b.y=32*x,b.v=5,0==q&&(b.a=-b.c,b.c=0),2==q&&(b.a=b.c,b.c=0),3==q&&(b.c=-b.c));else if(r(l(b.x+b.c,b.y))||r(l(b.x+b.c,b.y+31)))b.x=32*~~((b.x+b.c)/32)+32,b.c=0;0>b.x&&(b.x=0,b.c=0);for(f in d.b)b.x+b.c>=32*d.b[f][0]+64-16&&b.x+b.c<=32*d.b[f][0]+64&&b.y+31>=p[f].y&&b.y<=p[f].R&&(b.x=32*d.b[f][0]+64,b.c=0)}b.x+=b.c;b.s||(b.u=!1,b.a+=2,20<b.a&&(b.a=20));!b.s&&r(l(b.x+c/2,b.y+24))&&(b.y=32*~~(b.y/32)+32);if(0<b.a){if(4==l(b.x+c/2,b.y+32+b.a+8)&&0<=h.m&&u==~~((b.x+c/2)/32)&&x==~~((b.y+32+b.a)/32)&&0==q){if(b.x=32*~~((b.x+c/2)/32),b.c=0,b.s=!0,10<b.a||10>=b.a&&4==l(b.x+c/2,b.y+32+b.a-16))b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.o,b.v=5,0==h.l&&(b.a=-b.a),1==h.l&&(b.c=Math.max(b.a,5),b.a=0),3==h.l&&(b.c=Math.min(-b.a,-5),b.a=0)}else if(4==l(b.x+c/2,b.y+32+b.a+8)&&0<=u&&h.m==~~((b.x+c/2)/32)&&h.o==~~((b.y+32+b.a)/32)&&0==h.l){if(b.x=32*~~((b.x+c/2)/32),b.c=0,b.s=!0,10<b.a||10>=b.a&&4==l(b.x+c/2,b.y+32+b.a-16))b.x=32*u,1==q&&(b.x+=16),b.y=32*x,b.v=5,0==q&&(b.a=-b.a),1==q&&(b.c=Math.max(b.a,5),b.a=0),3==q&&(b.c=Math.min(-b.a,-5),b.a=0)}else if(r(l(b.x,b.y+32+b.a))||r(l(b.x+c,b.y+32+b.a))||1==e&&7==l(b.x,b.y+32+b.a)||1==e&&7==l(b.x+c,b.y+32+b.a))b.y=32*~~((b.y+b.a)/32),b.a=0,b.u=!0;for(g in d.h)b.x+c>d.h[g].x&&b.x<d.h[g].x+32&&b.y+31+b.a>d.h[g].y-8&&b.y+31+b.a<d.h[g].y+20&&(b.y=d.h[g].y-32,b.a=0,b.u=!0,b.S=g,b.X=b.x-d.h[g].x,d.h[g].weight+=b.weight);for(f in d.b)b.x+c>=32*d.b[f][0]&&b.x<32*d.b[f][0]+64&&b.y+31+b.a>=p[f].y&&b.y+31+b.a<=p[f].y+32&&(b.y=p[f].y-32,b.a=0,b.u=!0);for(f in d.g)b.x+c>=32*d.g[f][0]-32&&b.x<32*d.g[f][0]+64&&b.y+31+b.a>=n[f].A-8&&b.y+31+b.a<=n[f].A+32&&(b.y=n[f].A-32,b.a=0,b.u=!0,n[f].H+=b.weight);for(f in d.g)b.x+c>=32*d.g[f][2]-32&&b.x<32*d.g[f][2]+64&&b.y+31+b.a>=n[f].B-8&&b.y+31+b.a<=n[f].B+32&&(b.y=n[f].B-32,b.a=0,b.u=!0,n[f].I+=b.weight)}if(0==e&&0>b.a)if(4==l(b.x+c/2,b.y-8)&&0<=h.m&&u==~~((b.x+c/2)/32)&&x==~~((b.y-8)/32)&&2==q)b.x=32*~~((b.x+c/2)/32),b.c=0,b.s=!0,4==l(b.x+c/2,b.y-8)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.o,b.v=5,1==h.l&&(b.c=-b.a,b.a=0),2==h.l&&(b.a=-b.a),3==h.l&&(b.c=b.a,b.a=0));else if(4==l(b.x+c/2,b.y-8)&&0<=u&&h.m==~~((b.x+c/2)/32)&&h.o==~~((b.y-8)/32)&&2==h.l)b.x=32*~~((b.x+c/2)/32),b.c=0,b.s=!0,4==l(b.x+c/2,b.y-8)&&(b.x=32*u,1==q&&(b.x+=16),b.y=32*x,b.v=5,1==q&&(b.c=-b.a,b.a=0),2==q&&(b.a=-b.a),3==q&&(b.c=b.a,b.a=0));else if(r(l(b.x,b.y+b.a))||r(l(b.x+c,b.y+b.a)))5==l(b.x,b.y+b.a)&&M(b.x,b.y+b.a,0),5==l(b.x+24,b.y+b.a)&&M(b.x+24,b.y+b.a,0),b.y=32*~~((b.y+b.a)/32)+32,b.a=0;b.y+=b.a;11==l(b.x,b.y+20)?(M(b.x,b.y+20,25),N=!0):11==l(b.x+c,b.y+20)&&(M(b.x+c,b.y+20,25),N=!0);for(var g in d.b)b.x+c>=32*d.b[g][3]&&b.x<=32*d.b[g][3]+32&&b.y+32>=32*d.b[g][4]&&b.y+20<=32*d.b[g][4]+32&&(p[g].K=!0)}function da(){a.width^=0;e.font="bold 30px arial";e.fillStyle="#000";e.fillText("\u00d7",1255,25);1==O&&(1==Q&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Move with arrow keys or WASD or ZQSD.",640,80),e.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),e.fillText("Collect all coins and reach the flag.",640,160)),2==Q&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Let's add some mechanisms...",640,80)),3==Q&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center"));e.Z=!1;e.Y=!1;if(0==z){d.f=[];for(var b=0;20>b;b++){d.f[b]=[];for(var g=0;40>g;g++)d.f[b][g]=d.hash.charCodeAt(40*b+g)-48,15==d.f[b][g]&&(d.f[b][g]=0)}for(g in d.b)p[g]={K:!1,y:32*d.b[g][1]};for(g in d.g)n[g]={A:32*d.g[g][1],B:32*d.g[g][3],H:0,I:0}}for(var m in d.b){p[m].K?(p[m].y>32*d.b[m][2]&&(p[m].y=Math.max(p[m].y-4,32*d.b[m][2])),p[m].y<32*d.b[m][2]&&(p[m].y=Math.min(p[m].y+4,32*d.b[m][2]))):(p[m].y>32*d.b[m][1]&&(p[m].y=Math.max(p[m].y-4,32*d.b[m][1])),p[m].y<32*d.b[m][1]&&(p[m].y=Math.min(p[m].y+4,32*d.b[m][1])));J=!1;for(b=~~(p[m].y/32)+1;21>b;b++)if(20>b&&!r(l(d.b[m][0],b))&&!r(l(d.b[m][0]+1,b))&&!J)f(18,d.b[m][0],b),f(19,d.b[m][0]+1,b);else{J=!0;p[m].R=32*b;break}F(16,32*d.b[m][0],p[m].y+40);F(17,32*d.b[m][0]+32,p[m].y+40);d.b[m][4]&&(p[m].K?f(21,d.b[m][3],d.b[m][4]):f(20,d.b[m][3],d.b[m][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){G=d.f[j][i];12==G&&(G=0,0==z&&d.h.push({x:32*i,y:32*j,a:0,M:null}));f(G,i,j);if(2==G&&0==z&&(K=!1,20>j))for(k=j+1;20>k;k++)d.f[k][i]||K?K=!0:(f(24,i,k),d.f[k][i]=24);23==G&&0==z&&(d.start=[i,j],c.x=32*d.start[0],c.y=32*d.start[1])}N=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==d.f[j][i]&&(d.f[j][i]=11);for(i in d.b)p[i].K=!1;c.weight=1;for(i in d.h)d.h[i].weight=1;for(i in d.g)n[i].H=0,n[i].I=0;if(3!=c.state&&!R){c.state=0;if(!c.v&&10>c.c||c.u)c.c=0;c.right&&!c.v&&(c.U[z]=!0,c.c=6,c.direction=1,c.u&&(c.state=1));c.left&&!c.v&&(c.T[z]=!0,c.c=-6,c.direction=0,c.u&&(c.state=1));!c.s&&c.P&&c.u&&c.L&&(c.W[z]=!0,c.a-=20,c.u=!1,c.L=!1);0>c.a&&!c.u&&(c.state=2);Y(c,24,0);6==l(c.x+12,c.y+16)&&M(c.x+12,c.y+16,0);if(7==l(c.x+3,c.y)||7==l(c.x+24-3,c.y)||7==l(c.x+3,c.y+5)||7==l(c.x+24-3,c.y+5))c.state=3,c.a=-30;648<c.y&&(c.state=3,c.a=-30);if(c.N){if(c.V[z]=!0,null===c.w)for(i in d.h)if(c.x+24>=d.h[i].x&&c.x<=d.h[i].x+31&&c.y+31>=d.h[i].y&&c.y<=d.h[i].y+31){c.w=i;d.h[i].M=c;c.J=5;break}}else d.h[c.w]&&(d.h[c.w].M=null,c.w=null,c.weight=1);null!==c.w?(d.h[c.w].x=c.x+-8*c.direction,c.J&&c.J--,d.h[c.w].y=c.y-32+4*c.J):c.N=0;if(2==l(c.x+12,c.y+16)||24==l(c.x+12,c.y+16)){for(j=S=0;20>j;j++)for(i=0;40>i;i++)6==d.f[j][i]&&S++;0==S&&(R=!0,c.state=0)}if(c.F)for(i=0;40>i;i++)c.F+=.001,c.i+=c.F*c.C,c.j+=c.F*c.D,r(l(c.i,c.j))?(c.F=0,4>c.i%32&&!r(l(c.i-32,c.j))&&0<c.C&&(C=3),28<c.i%32&&!r(l(c.i+32,c.j))&&0>c.C&&(C=1),4>c.j%32&&!r(l(c.i,c.j-32))&&0<c.D&&(C=0),28<c.j%32&&!r(l(c.i,c.j+32))&&0>c.D&&(C=2),4!=l(c.i,c.j)||~~(c.i/32)==h.m&&~~(c.j/32)==h.o&&h==C||(u=~~(c.i/32),x=~~(c.j/32),q=C)):(e.fillStyle="blue",e.fillRect(c.i,c.j+40,6,6));if(c.G)for(i=0;40>i;i++)c.G+=.001,c.i+=c.G*c.C,c.j+=c.G*c.D,r(l(c.i,c.j))?(c.G=0,4>c.i%32&&!r(l(c.i-32,c.j))&&0<c.C&&(C=3),28<c.i%32&&!r(l(c.i+32,c.j))&&0>c.C&&(C=1),4>c.j%32&&!r(l(c.i,c.j-32))&&0<c.D&&(C=0),28<c.j%32&&!r(l(c.i,c.j+32))&&0>c.D&&(C=2),4!=l(c.i,c.j)||~~(c.i/32)==h.m&&~~(c.j/32)==h.o&&h==C||(h.m=~~(c.i/32),h.o=~~(c.j/32),h.l=C)):(e.fillStyle="orange",e.fillRect(c.i,c.j+40,6,6));4!=l(c.x+1,c.y+1)&&4!=l(c.x+24-1,c.y+1)&&4!=l(c.x+1,c.y+31)&&4!=l(c.x+24-1,c.y+31)&&(c.s=!1);c.v&&c.v--}3==c.state&&(c.a+=2,20<c.a&&(c.a=20),c.y+=c.a);for(i in d.h)null===d.h[i].M&&(d.h[i].c=0,Y(d.h[i],32,1));for(i in d.h)e.drawImage(tileset,192,0,16,16,d.h[i].x,40+d.h[i].y,32,32);1==c.direction?e.drawImage(tileset,16*[26,[27,28,29][~~(z/2)%3],30,31][c.state],0,16,16,c.x-4,40+c.y,32,32):(e.save(),e.translate(c.x+24+4,c.y),e.scale(-1,1),e.drawImage(tileset,16*[26,[27,28,29][~~(z/2)%3],30,31][c.state],0,16,16,0,40,32,32),e.restore());f(4,u,x);f(4,h.m,h.o);e.fillStyle="blue";0==q&&e.fillRect(32*u,32*x+40-8,32,8);1==q&&e.fillRect(32*u+28,32*x+40,8,32);2==q&&e.fillRect(32*u,32*x+68,32,8);3==q&&e.fillRect(32*u-4,32*x+40,8,32);e.fillStyle="orange";0==h.l&&e.fillRect(32*h.m,32*h.o+40-8,32,8);1==h.l&&e.fillRect(32*h.m+28,32*h.o+40,8,32);2==h.l&&e.fillRect(32*h.m,32*h.o+68,32,8);3==h.l&&e.fillRect(32*h.m-4,32*h.o+40,8,32);if(N!=U)for(j=0;20>j;j++)for(i=0;40>i;i++)9==d.f[j][i]?d.f[j][i]=10:10==d.f[j][i]&&(d.f[j][i]=9);U=N;for(i in d.g)n[i].H>n[i].I?(n[i].A+=4,n[i].B-=4):n[i].I>n[i].H&&(n[i].A-=4,n[i].B+=4),F(15,32*d.g[i][0]-32,n[i].A+40),F(15,32*d.g[i][0],n[i].A+40),F(15,32*d.g[i][0]+32,n[i].A+40),F(15,32*d.g[i][2]-32,n[i].B+40),F(15,32*d.g[i][2],n[i].B+40),F(15,32*d.g[i][2]+32,n[i].B+40);z++;document.title=c.x+" "+c.y;R&&(V++,e.font="bold 100px arial",e.fillStyle="#000",e.textAlign="center",e.fillText("CLEARED!",640,350));30<=V&&(a.width^=0,clearInterval(P),t=O,d.O=!0,a.width^=0,A())}function Z(){d={f:[],b:[],g:[],h:[],O:!1};for(j=0;20>j;j++)d.f[j]=[];w=H=L=B=D=0}function aa(){R=!1;z=V=S=0;c={x:0,y:0,c:0,a:0,u:0,W:[],U:[],T:[],V:[],direction:1,state:0,w:null,L:!0,S:null,X:null,J:0};ba=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];d.h=[];U=!1;p=[];n=[];x=u=-1;q=void 0;h={m:-2,o:-2}}function E(b,c){return d.f[c]?!d.f[c][b]||14>d.f[c][b]||24<d.f[c][b]:0}function r(b){return ba[b]||0}function M(b,c,e){d.f[~~(c/32)]&&(d.f[~~(c/32)][~~(b/32)]=e)}function l(b,c){return d.f[~~(c/32)]?d.f[~~(c/32)][~~(b/32)]||0:0}function F(b,c,d){e.drawImage(tileset,16*b,0,16,16,c,d,32,32)}function f(b,c,d){e.drawImage(tileset,16*b,0,16,16,32*c,40+32*d,32,32)}var u,x,q,e=a.getContext("2d");localStorage.scpm_level=3;var t=1,O=0,W=!1,X=!1,g=tile_y=0,v=y=0,Q=0,d={},D,B,L,H,w,ca,T,J,K,I,G,R,V,S,P,z,c,ba,N,U,p,n,h,C,ea=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600000000000000G0000050505000000000000000000000000400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330<0000004440004440000700<0<0<00400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{b:[[17,16,4,15,16]],g:[[31,8,35,17]],hash:"00000000000000000000000000000000000000000000000000000000000000000000000<000<00000000000000000000000000000000000900090000000000<00000000000000000000000000000000000000000000000000000333333330000000000000000099990000000000000300000000000000000000000009000000006000030000000000000000000000:::9000000000000030000000000000000200000000900000000600003000000000000000000000099990000000000000300000000000000000000000009000000000600030000000000000000000000:::900000000000003000000000000000000000000090000000006000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000090000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"},{hash:"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000344444444444444444440000000000000000400030000000000000000000000000000000000040003000000000000000000000000000000000004000300000000000000000000000008000000000400030000<00777700000000000000800000000040003444444444444444444400000080000000004000400000000000000000000000008000;00000400030000000000000000000000000800333399330003000000000000000000000000080030000003000300040000444444444440000008003020000300030004400040000000000000000800300000030003F004440040000000000000000000300000030003G0000000400000000000000000003000000300034444444440000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],A=onload=onhashchange=function(){a.width^=0;e.font="bold 30px arial";e.textAlign="center";e.mozImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;0==t&&(e.drawImage(tileset,512,0,70,16,120,150,280,64),e.drawImage(tileset,583,0,270,16,120,250,1080,64),e.fillStyle="#000",e.beginPath(),e.fillRect(500,400,100,80),e.fillRect(650,400,100,80),e.fillStyle="#fff",e.fillText("MAKE",700,450),e.fillText("PLAY",550,450),e.stroke(),e.closePath());if(1==t){e.beginPath();e.fillStyle="#000";e.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)I=10*j+i+1,e.fillStyle="#000",e.fillRect(120*i+50,100*j+120,100,80),e.fillStyle="#fff",e.fillText(+localStorage.scpm_level>=I?I:"?",120*i+100,100*j+170);e.fillText("LEVELS",640,70);e.fillText("MORE LEVELS ONLINE",640,470);e.fillText("GO",640,570);e.fillText("\u25c0",40,70);e.stroke();e.closePath()}2==t&&(P&&clearInterval(P),aa(),P=setInterval(da,33));if(3==t){e.strokeStyle="#777";e.lineWidth=1;e.fillStyle="#fff";e.fillRect(0,0,1280,648);e.fillStyle="#5C94FC";e.fillRect(0,40,1280,640);e.beginPath();for(i=0;16>i;i++)e.fillRect(8+35*i,3,32,32),e.rect(8+35*i,3,32,32),F(i,8+35*i,3);for(j=0;j<d.f.length;j++)for(i=0;i<d.f[j].length;i++)if(G=d.f[j][i],f(G,i,j),2==G&&(K=!1,20>j))for(k=j+1;20>k;k++)d.f[k][i]||K?K=!0:f(24,i,k);for(i in d.b){T=d.b[i][1];if(d.b[i][2])for(ca=d.b[i][1]<d.b[i][2]?d.b[i][1]:d.b[i][2],T=d.b[i][1]<d.b[i][2]?d.b[i][2]:d.b[i][1],k=ca+1;k<T;k++)f(18,d.b[i][0],k),f(19,d.b[i][0]+1,k),d.f[k][d.b[i][0]]=18,d.f[k][d.b[i][0]+1]=19;if(d.b[i][1])for(J=!1,k=T+1;21>k;k++)20>k&&!d.f[k][d.b[i][0]]&&!d.f[k][d.b[i][0]+1]&&!J?(f(18,d.b[i][0],k),f(19,d.b[i][0]+1,k)):J=!0;d.b[i][1]&&(f(16,d.b[i][0],d.b[i][1]),f(17,d.b[i][0]+1,d.b[i][1]));d.b[i][2]&&(f(16,d.b[i][0],d.b[i][2]),f(17,d.b[i][0]+1,d.b[i][2]));d.b[i][4]&&f(20,d.b[i][3],d.b[i][4])}for(i in d.g)d.g[i][3]&&(f(15,d.g[i][0]-1,d.g[i][1]),f(15,d.g[i][0],d.g[i][1]),f(15,d.g[i][0]+1,d.g[i][1]),d.f[d.g[i][1]][d.g[i][0]-1]=15,d.f[d.g[i][1]][d.g[i][0]]=15,d.f[d.g[i][1]][d.g[i][0]+1]=15,f(15,d.g[i][2]-1,d.g[i][3]),f(15,d.g[i][2],d.g[i][3]),f(15,d.g[i][2]+1,d.g[i][3]),d.f[d.g[i][3]][d.g[i][2]-1]=15,d.f[d.g[i][3]][d.g[i][2]]=15,d.f[d.g[i][3]][d.g[i][2]+1]=15);0<=tile_y&&!X&&(1==w?0<tile_y&&(f(22,g,tile_y-1),f(23,g,tile_y)):14==w?(0==D&&(f(16,g,tile_y),f(17,g+1,tile_y)),1==D&&(f(16,d.b[B][0],tile_y),f(17,d.b[B][0]+1,tile_y)),2==D&&f(20,g,tile_y)):15==w?(f(15,g-1,tile_y),f(15,g,tile_y),f(15,g+1,tile_y)):f(w,g,tile_y));for(i=0;40>i;i++)e.moveTo(32*i,40),e.lineTo(32*i,648);for(j=0;20>j;j++)e.moveTo(0,40+32*j),e.lineTo(1280,40+32*j);e.fillStyle="#000";e.fillRect(750,4,100,32);e.fillRect(875,4,100,32);e.fillRect(1E3,4,100,32);e.fillRect(1125,4,100,32);e.fillStyle="#fff";e.font="bold 20px arial";e.fillText("TEST",800,28);e.fillText("SHARE",925,28);e.fillText("CLEAR",1050,28);e.fillText("EXIT",1175,28);e.stroke();e.closePath();e.beginPath();i=w;e.strokeStyle="red";e.lineWidth=3;e.rect(8+35*i,3.5,32,32);e.stroke();e.closePath()}};a.onclick=a.oncontextmenu=function(b){v=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==t&&(e.beginPath(),e.rect(500,400,100,80),e.isPointInPath(v,y)&&(t=1,A()),e.closePath(),e.beginPath(),e.rect(650,400,100,80),e.isPointInPath(v,y)&&(t=3,Z(),A()),e.closePath());if(1==t)for(e.beginPath(),e.rect(30,30,50,50),e.isPointInPath(v,y)&&(t=0,A()),e.closePath(),e.beginPath(),e.rect(590,520,100,80),e.isPointInPath(v,y)&&(location="todo"),e.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)I=10*j+i+1,+localStorage.scpm_level>=I&&(e.beginPath(),e.rect(120*i+50,100*j+120,100,80),e.isPointInPath(v,y)&&(O=1,t=2,Q=I,d=ea[I],A()),e.closePath());2==t&&0<z&&(c.s||(1==b.which&&(c.F=1),3==b.which&&(c.G=1),b=Math.atan2(v-(c.x+12),y-(c.y+40+16)),c.i=c.x+12,c.j=c.y+16,c.C=Math.sin(b),c.D=Math.cos(b)),e.beginPath(),e.rect(1240,0,32,32),e.isPointInPath(v,y)&&(clearInterval(P),t=O,A()),e.closePath());if(3==t){e.beginPath();e.rect(750,4,100,32);if(e.isPointInPath(v,y)){d.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=d.f[j][i]||0,tile=16>tile||21<tile?tile:0,d.hash+=String.fromCharCode(tile+48);O=3;t=2;A()}e.closePath();e.beginPath();e.rect(875,4,100,32);if(e.isPointInPath(v,y)){d.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=d.f[j][i]||0,tile=16>tile||21<tile?tile:0,d.hash+=String.fromCharCode(tile+48);location.hash="";0==d.O&&alert("You need to test and win your level first.");prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,b:d.b,g:d.g})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,b:d.b,g:d.g}))}e.closePath();e.beginPath();e.rect(1E3,4,100,32);e.isPointInPath(v,y)&&(Z(),A());e.closePath();e.beginPath();e.rect(1125,4,100,32);e.isPointInPath(v,y)&&(t=0,A());e.closePath();for(i=0;16>i;i++)e.beginPath(),e.rect(8.5+35*i,3.5,32,32),e.isPointInPath(v,y)&&0==D&&0==L&&(w=i,14==w&&(d.b[B]=[]),15==w&&(d.g[H]=[]),A()),e.closePath();e.beginPath();e.rect(8.5,40.5,1264,592);if(e.isPointInPath(v,y)){d.O=!1;g=Math.floor(v/32);tile_y=Math.floor((y-40)/32);if(1==X)E(g,tile_y)&&(d.f[tile_y][g]=0);else if(1==w){if(0<tile_y&&E(g,tile_y)&&E(g,tile_y-1)){for(j in d.f)for(i in d.f[j])if(22==d.f[j][i]||23==d.f[j][i])d.f[j][i]=0;d.f[tile_y-1][g]=22;d.f[tile_y][g]=23}}else if(2==w){if(E(g,tile_y)){for(j in d.f)for(i in d.f[j])2==d.f[j][i]&&(d.f[j][i]=0);d.f[tile_y][g]=2}}else 14==w?E(g,tile_y)&&E(g+1,tile_y)&&(0==D?(d.b[B]=[],d.b[B][0]=g,d.b[B][1]=tile_y,d.f[tile_y][g]=16,d.f[tile_y][g+1]=17,D++):1==D?(d.b[B][2]=tile_y,d.f[tile_y][d.b[B][0]]=16,d.f[tile_y][d.b[B][0]+1]=17,D++):2==D&&(d.b[B][3]=g,d.b[B][4]=tile_y,d.f[tile_y][g]=20,B++,D=0)):15==w?E(g-1,tile_y)&&E(g,tile_y)&&E(g+1,tile_y)&&(0==L?(d.g[H]=[],d.g[H][0]=g,d.g[H][1]=tile_y,L++):1==L&&(d.g[H][2]=g,d.g[H][3]=tile_y,H++,L=0),d.f[tile_y][g-1]=15,d.f[tile_y][g]=15,d.f[tile_y][g+1]=15):E(g,tile_y)&&(d.f[tile_y][g]=w);A()}e.closePath()}return!1};onmousedown=function(b){W=!0;X=3==b.which?!0:!1};onmouseup=function(){W=!1};onmousemove=function(b){3==t&&(W&&14!=w&&15!=w&&onclick(b),v=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,g=Math.floor(v/32),tile_y=Math.floor((y-40)/32),A())};onkeydown=onkeypress=function(b){if(2==t){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.P=!0;if(39==b.keyCode||68==b.keyCode)c.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!0}};onkeyup=function(b){if(2==t){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.P=!1,c.L=!0;if(39==b.keyCode||68==b.keyCode)c.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!1;82==b.keyCode&&aa();32==b.keyCode&&(c.N^=1)}};onhashchange=function(){location.hash&&(console.log(decodeURIComponent(location.hash.slice(1))),d=JSON.parse(decodeURIComponent(location.hash.slice(1))),t=2,A())};onhashchange()</script>