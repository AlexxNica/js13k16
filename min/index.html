<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:crosshair"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function da(b){0==w&&(e.beginPath(),e.rect(500,400,100,80),e.isPointInPath(x,y)&&(w=1,A()),e.closePath(),e.beginPath(),e.rect(650,400,100,80),e.isPointInPath(x,y)&&(w=3,ea(),A()),e.closePath());if(1==w)for(e.beginPath(),e.rect(30,30,50,50),e.isPointInPath(x,y)&&(w=0,A()),e.closePath(),e.beginPath(),e.rect(590,520,100,80),e.isPointInPath(x,y)&&(location="todo"),e.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)L=10*j+i+1,+localStorage.scpm>=L&&(e.beginPath(),e.rect(120*i+50,100*j+120,100,80),e.isPointInPath(x,y)&&(P=1,w=2,Q=L,d=ja[L],A()),e.closePath());2==w&&0<v&&(1==b.which&&(q.T[v]=[x,y]),3==b.which&&(q.V[v]=[x,y]),e.beginPath(),e.rect(1240,0,32,32),e.isPointInPath(x,y)&&(clearInterval(R),w=P,A()),e.closePath());if(3==w){d.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=d.f[j][i]||0,tile=16>tile||21<tile?tile:0,d.hash+=String.fromCharCode(tile+48);e.beginPath();e.rect(750,4,100,32);e.isPointInPath(x,y)&&(P=3,w=2,A());e.closePath();e.beginPath();e.rect(875,4,100,32);e.isPointInPath(x,y)&&(location.hash="",0==d.W&&alert("You need to test and win your level first."),prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,a:d.a,b:d.b}))),prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,a:d.a,b:d.b})));e.closePath();e.beginPath();e.rect(1E3,4,100,32);e.isPointInPath(x,y)&&(ea(),A());e.closePath();e.beginPath();e.rect(1125,4,100,32);e.isPointInPath(x,y)&&(w=0,A());e.closePath();for(i=0;16>i;i++)e.beginPath(),e.rect(8.5+35*i,3.5,32,32),e.isPointInPath(x,y)&&0==E&&0==M&&(z=i,14==z&&(d.a[B]=[]),15==z&&(d.b[J]=[]),A()),e.closePath();e.beginPath();e.rect(8.5,40.5,1264,592);if(e.isPointInPath(x,y)){d.W=!1;if(1==Y)F(g,tile_y)&&(d.f[tile_y][g]=0);else if(1==z){if(0<tile_y&&F(g,tile_y)&&F(g,tile_y-1)){for(j in d.f)for(i in d.f[j])if(22==d.f[j][i]||23==d.f[j][i])d.f[j][i]=0;d.f[tile_y-1][g]=22;d.f[tile_y][g]=23}}else if(2==z){if(F(g,tile_y)){for(j in d.f)for(i in d.f[j])2==d.f[j][i]&&(d.f[j][i]=0);d.f[tile_y][g]=2}}else 14==z?F(g,tile_y)&&F(g+1,tile_y)&&(0==E?(d.a[B]=[],d.a[B][0]=g,d.a[B][1]=tile_y,d.f[tile_y][g]=16,d.f[tile_y][g+1]=17,E++):1==E?(d.a[B][2]=tile_y,d.f[tile_y][d.a[B][0]]=16,d.f[tile_y][d.a[B][0]+1]=17,E++):2==E&&(d.a[B][3]=g,d.a[B][4]=tile_y,d.f[tile_y][g]=20,B++,E=0)):15==z?F(g-1,tile_y)&&F(g,tile_y)&&F(g+1,tile_y)&&(0==M?(d.b[J]=[],d.b[J][0]=g,d.b[J][1]=tile_y,M++):1==M&&(d.b[J][2]=g,d.b[J][3]=tile_y,J++,M=0),d.f[tile_y][g-1]=15,d.f[tile_y][g]=15,d.f[tile_y][g+1]=15):F(g,tile_y)&&(d.f[tile_y][g]=z);A(1)}e.closePath()}}function fa(b,e,c){"undefined"!=typeof b.B&&null!==b.B&&(b.weight=1+d.h[b.B].weight);if(0<b.g){b.j=null;4==f(b.x+e+b.g,b.y+16)&&0<=p.i&&r.i==~~((b.x+e+b.g)/32)&&r.s==~~((b.y+16)/32)&&3==r.o&&(b.j=p);4==f(b.x+e+b.g,b.y+16)&&0<=r.i&&p.i==~~((b.x+e+b.g)/32)&&p.s==~~((b.y+16)/32)&&3==p.o&&(b.j=r);if(b.j)b.y=32*~~((b.y+16)/32),b.c=0,b.A=!0,4==f(b.x+b.g,b.y+16)&&(b.H=!0,b.D=Math.max(b.g,6),b.g=0,b.C=8);else if(n(f(b.x+e+b.g,b.y))||n(f(b.x+e+b.g,b.y+31)))b.x=32*~~((b.x+b.g)/32)+32-e-1,b.g=0;b.x>1280-e&&(b.x=1280-e,b.g=0);for(var g in d.a)!b.A&&b.x+e+b.g>=32*d.a[g][0]&&b.x+e+b.g<=32*d.a[g][0]+16&&b.y+31>=t[g].y&&b.y<=t[g].Z&&(b.x=32*d.a[g][0]-e-1,b.g=0)}if(0>b.g){b.j=null;4==f(b.x+b.g,b.y+16)&&0<=p.i&&r.i==~~((b.x+b.g)/32)&&r.s==~~((b.y+16)/32)&&1==r.o&&(b.j=p);4==f(b.x+b.g,b.y+16)&&0<=r.i&&p.i==~~((b.x+b.g)/32)&&p.s==~~((b.y+16)/32)&&1==p.o&&(b.j=r);if(b.j)b.y=32*~~((b.y+16)/32),b.c=0,b.A=!0,4==f(b.x+b.g+e,b.y+16)&&(b.H=!0,b.D=Math.max(-b.g,6),b.g=0,b.C=8);else if(n(f(b.x+b.g,b.y))||n(f(b.x+b.g,b.y+31)))b.x=32*~~((b.x+b.g)/32)+32,b.g=0;0>b.x&&(b.x=0,b.g=0);for(g in d.a)b.x+b.g>=32*d.a[g][0]+64-16&&b.x+b.g<=32*d.a[g][0]+64&&b.y+31>=t[g].y&&b.y<=t[g].Z&&(b.x=32*d.a[g][0]+64,b.g=0)}b.x+=b.g;b.A?!b.A&&n(f(b.x+e/2,b.y+24))&&(b.y=32*~~(b.y/32)+32):(b.w=!1,b.c+=2,24<b.c&&(b.c=24));if(0<b.c){b.j=null;4==f(b.x+e/2,b.y+32+b.c)&&0<=p.i&&r.i==~~((b.x+e/2)/32)&&r.s==~~((b.y+32+b.c)/32)&&0==r.o&&(b.j=p);4==f(b.x+b.g/2,b.y+32+b.c)&&0<=r.i&&p.i==~~((b.x+e/2)/32)&&p.s==~~((b.y+32+b.c)/32)&&0==p.o&&(b.j=r);if(b.j){if(b.x=32*~~((b.x+e/2)/32)+(32-e)/2,b.g=0,b.A=!0,10>b.c&&4==f(b.x+e/2,b.y+32+b.c-16)||10<b.c&&4==f(b.x+e/2,b.y+32+b.c))b.H=!0,b.D=Math.max(b.c,6),b.c=0,b.C=8}else if(n(f(b.x,b.y+32+b.c))||n(f(b.x+e-1,b.y+32+b.c))||1==c&&7==f(b.x,b.y+32+b.c)||1==c&&7==f(b.x+e,b.y+32+b.c))b.y=32*~~((b.y+b.c)/32),b.c=0,b.w=!0;for(h in d.h)!d.h[h].A&&!b.A&&b.x+e>d.h[h].x&&b.x<d.h[h].x+32&&b.y+31+b.c>d.h[h].y-8&&b.y+31+b.c<d.h[h].y+20&&(b.y=d.h[h].y-32,b.c=0,b.w=!0,b.X=h,b.$=b.x-d.h[h].x,d.h[h].weight+=b.weight);for(g in d.a)b.x+e>=32*d.a[g][0]&&b.x<32*d.a[g][0]+64&&b.y+31+b.c>=t[g].y&&b.y+31+b.c<=t[g].y+32&&(b.y=t[g].y-32,b.c=0,b.w=!0,b.M=!0);for(g in d.b)b.x+e>=32*d.b[g][0]-32&&b.x<32*d.b[g][0]+64&&b.y+31+b.c>=m[g].u-8&&b.y+31+b.c<=m[g].u+32&&(b.y=m[g].u-32,b.c=0,b.w=!0,b.M=!0,m[g].I+=b.weight);for(g in d.b)b.x+e>=32*d.b[g][2]-32&&b.x<32*d.b[g][2]+64&&b.y+31+b.c>=m[g].v-8&&b.y+31+b.c<=m[g].v+32&&(b.y=m[g].v-32,b.c=0,b.w=!0,b.M=!0,m[g].J+=b.weight)}if(0>b.c)if(b.j=null,4==f(b.x+e/2,b.y+b.c)&&0<=p.i&&r.i==~~((b.x+e/2)/32)&&r.s==~~((b.y+b.c)/32)&&2==r.o&&(b.j=p),4==f(b.x+b.g/2,b.y+b.c)&&0<=r.i&&p.i==~~((b.x+e/2)/32)&&p.s==~~((b.y+b.c)/32)&&2==p.o&&(b.j=r),b.j)b.x=32*~~((b.x+e/2)/32)+(32-e)/2,b.g=0,b.A=!0,4==f(b.x+e/2,b.y+b.c+10)&&(b.H=!0,b.D=6,b.c=0,b.C=8);else if(n(f(b.x,b.y+b.c))||n(f(b.x+e,b.y+b.c)))5==f(b.x,b.y+b.c)&&K(b.x,b.y+b.c,0),5==f(b.x+24,b.y+b.c)&&K(b.x+24,b.y+b.c,0),b.y=32*~~((b.y+b.c)/32)+32,b.c=0;b.y+=b.c;b.H&&(b.H=!1,b.w=!1,b.x=32*b.j.i+(32-e)/2,b.y=32*b.j.s,0==b.j.o&&(b.c=-b.D,b.g=0),1==b.j.o&&(b.g=b.D,b.c=0),2==b.j.o&&(b.c=b.D,b.g=0,b.y+=8,b.C=2),3==b.j.o&&(b.g=-b.D,b.c=0));11==f(b.x,b.y+20)?(K(b.x,b.y+20,25),S=!0):11==f(b.x+e,b.y+20)&&(K(b.x+e,b.y+20,25),S=!0);for(var h in d.a)b.x+e>=32*d.a[h][3]&&b.x<=32*d.a[h][3]+32&&b.y+32>=32*d.a[h][4]&&b.y+20<=32*d.a[h][4]+32&&(t[h].O=!0)}function ka(){a.width^=0;e.font="bold 30px arial";e.fillStyle="#000";e.fillText("\u00d7",1255,25);1==P&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",1==Q&&(e.fillText("Move with arrow keys or WASD or ZQSD.",640,80),e.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),e.fillText("Collect all coins and reach the flag.",640,160)),2==Q&&e.fillText("Let's add some mechanisms...",640,80),3==Q&&(e.fillText("And now, you're thinking with portals!",640,80),e.fillText("Use mouse to aim and [left click] / [right click] to shoot.",640,120)),4==Q&&(e.fillText("Don't forget the momentum!",640,80),e.fillText("(And be careful, ice is slippy if you're not standing still)",640,120)));q.R&&(q.left[v]=!0);q.S&&(q.right[v]=!0);q.L&&(q.Y[v]=!0);e.fa=!1;e.da=!1;if(0==v){d.f=[];for(var b=0;20>b;b++){d.f[b]=[];for(var g=0;40>g;g++)d.f[b][g]=d.hash.charCodeAt(40*b+g)-48,15==d.f[b][g]&&(d.f[b][g]=0)}for(g in d.a)t[g]={O:!1,y:32*d.a[g][1]};for(g in d.b)m[g]={u:32*d.b[g][1],v:32*d.b[g][3],I:0,J:0}}for(var c in d.a){T=t[c].O?32*d.a[c][2]:32*d.a[c][1];t[c].y>T?t[c].y=Math.max(t[c].y-4,T):t[c].y<T&&(t[c].y=Math.min(t[c].y+4,T));N=!1;for(b=~~(t[c].y/32)+1;21>b;b++)if(20>b&&!n(f(d.a[c][0],b))&&!n(f(d.a[c][0]+1,b))&&!N)h(18,d.a[c][0],b),h(19,d.a[c][0]+1,b);else{N=!0;t[c].Z=32*b;break}G(16,32*d.a[c][0],t[c].y+40);G(17,32*d.a[c][0]+32,t[c].y+40);d.a[c][4]&&(t[c].O?h(21,d.a[c][3],d.a[c][4]):h(20,d.a[c][3],d.a[c][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){H=d.f[j][i];12==H&&(H=0,0==v&&d.h.push({x:32*i,y:32*j,c:0,P:null}));h(H,i,j);if(2==H&&0==v&&(O=!1,20>j))for(k=j+1;20>k;k++)d.f[k][i]||O?O=!0:(h(24,i,k),d.f[k][i]=24);23==H&&0==v&&(d.start=[i,j],q.x=32*d.start[0],q.y=32*d.start[1])}S=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==d.f[j][i]&&(d.f[j][i]=11);for(i in d.a)t[i].O=!1;for(Z in U);q.weight=1;for(i in d.h)d.h[i].weight=1;for(i in d.b)m[i].I=0,m[i].J=0;for(Z in U);c=q;if(3!=c.state&&!V){c.state=0;c.M=!1;if(!c.C){if(c.w&&8!=f(c.x,c.y+33)&&8!=f(c.x+24,c.y+33)||!c.w&&10>Math.abs(c.g))c.g=0;c.right[v]&&(8!=f(c.x,c.y+33)&&8!=f(c.x+24,c.y+33)||0==c.g)&&(c.g=Math.max(c.g,6),c.direction=1,c.w&&(c.state=1));c.left[v]&&(8!=f(c.x,c.y+33)&&8!=f(c.x+24,c.y+33)||0==c.g)&&(c.g=Math.min(c.g,-6),c.direction=0,c.w&&(c.state=1))}!c.A&&c.Y[v]&&c.w&&(8!=f(c.x,c.y+33)&&8!=f(c.x+24,c.y+33)||0==c.g)&&(c.c-=20,c.w=!1,c.L=!1,c.K=!1,c.X=null);0>c.c&&!c.w&&(c.state=2);fa(c,24,0);6==f(c.x+12-8,c.y+16-8)&&K(c.x+12-8,c.y+16-8,0);6==f(c.x+12+8,c.y+16-8)&&K(c.x+12+8,c.y+16-8,0);6==f(c.x+12-8,c.y+16+8)&&K(c.x+12-8,c.y+16+8,0);6==f(c.x+12+8,c.y+16+8)&&K(c.x+12+8,c.y+16+8,0);if(7==f(c.x+3,c.y)||7==f(c.x+24-3,c.y)||7==f(c.x+3,c.y+5)||7==f(c.x+24-3,c.y+5))c.state=3,c.c=-20;648<c.y&&(c.state=3,c.c=-30);c.M&&(n(f(c.x,c.y+1))||n(f(c.x+24,c.y+1)))&&(c.state=3,c.c=-20);if(c.U){if(null===c.B)for(i in d.h)if(c.x+24>=d.h[i].x&&c.x<=d.h[i].x+31&&c.y+31+4>=d.h[i].y&&c.y<=d.h[i].y+31){c.B=i;d.h[i].P=c;c.N=5;break}}else if(u=d.h[c.B])c.w?0==c.direction?u.x=c.x-20:1==c.direction&&(u.x=c.x+20):0==c.direction?u.x=c.x-6:1==c.direction&&(u.x=c.x),n(f(u.x,u.y))?u.x=32*~~(u.x/32)+32:n(f(u.x,u.y+31))?u.x=32*~~(u.x/32)+32:n(f(u.x+32,u.y))?u.x=32*~~(u.x/32)-1:n(f(u.x+32,u.y+31))&&(u.x=32*~~(u.x/32)-1),u.P=null,d.h[c.B]=u,c.B=null,c.weight=1;null!==c.B?(0==c.direction&&(d.h[c.B].x=c.x-6),1==c.direction&&(d.h[c.B].x=c.x-4),c.N&&c.N--,d.h[c.B].y=c.A?c.y:n(f(c.x,c.y-28))||n(f(c.x+24,c.y-28))?32*~~((c.y+4)/32):c.y-32+4*c.N):c.U=0;if(2==f(c.x+12,c.y+16)||24==f(c.x+12,c.y+16)){for(j=W=0;20>j;j++)for(i=0;40>i;i++)6==d.f[j][i]&&W++;0==W&&(V=!0,c.state=0)}c.A||!c.T[v]&&!c.V[v]||(c.aa=0,c.ba=0,c.T[v]&&(c.aa=1),c.V[v]&&(c.ba=1),c.angle=Math.atan2(x-(c.x+12),y-(c.y+40+16)),c.l=c.x+12,c.m=c.y+16,c.F=Math.sin(c.angle),c.G=Math.cos(c.angle));for(C in D=[["shoot_blue",r,"blue"],["shoot_orange",p,"orange"]])if(c[D[C][0]])for(i=0;40>i;i++)if(c[D[C][0]]+=.001,c.l+=c[D[C][0]]*c.F,c.m+=c[D[C][0]]*c.G,n(f(c.l,c.m))){c[D[C][0]]=0;4>c.l%32&&!n(f(c.l-32,c.m))&&0<c.F&&(I=3,l(3));28<c.l%32&&!n(f(c.l+32,c.m))&&0>c.F&&(I=1,l(1));4>c.m%32&&!n(f(c.l,c.m-32))&&0<c.G&&(I=0);28<c.m%32&&!n(f(c.l,c.m+32))&&0>c.G&&(I=2);8==f(c.l,c.m)&&(c[D[C][0]]=1,0==I?(c.G=-c.G,c.m=32*~~(c.m/32)-1):2==I?(c.G=-c.G,c.m=32*~~(c.m/32)+33):1==I?(c.F=-c.F,c.l=32*~~(c.l/32)+33):(c.F=-c.F,c.l=32*~~(c.l/32)-1));4!=f(c.l,c.m)||~~(c.l/32)==p.i&&~~(c.m/32)==p.s&&p.o==I||(D[C][1].i=~~(c.l/32),D[C][1].s=~~(c.m/32),D[C][1].o=I);break}else e.fillStyle=D[C][2],e.fillRect(c.l,c.m+40,6,6);4!=f(c.x+1,c.y+1)&&4!=f(c.x+24-1,c.y+1)&&4!=f(c.x+1,c.y+31)&&4!=f(c.x+24-1,c.y+31)&&(c.A=!1);c.C&&c.C--}3==c.state&&(c.c+=2,24<c.c&&(c.c=24),c.y+=c.c);for(i in d.h)4!=f(d.h[i].x+1,d.h[i].y+1)&&4!=f(d.h[i].x+32-1,d.h[i].y+1)&&4!=f(d.h[i].x+1,d.h[i].y+31)&&4!=f(d.h[i].x+32-1,d.h[i].y+31)&&(d.h[i].A=!1),d.h[i].C&&d.h[i].C--,null===d.h[i].P&&(d.h[i].g=0,fa(d.h[i],32,1)),e.drawImage(tileset,192,0,16,16,d.h[i].x,40+d.h[i].y,32,32);for(Z in U);c=q;e.save();e.translate(c.x+12-2,c.y);0==c.direction&&e.scale(-1,1);e.drawImage(tileset,16*[26,[27,28,29][~~(v/2)%3],30,31][c.state],0,16,16,-12,40,32,32);e.restore();for(i in j={blue:r,orange:p})h(4,j[i].i,j[i].s);for(i in j={blue:r,orange:p})e.fillStyle=i,0==j[i].o&&e.fillRect(32*j[i].i,32*j[i].s+40-8,32,8),1==j[i].o&&e.fillRect(32*j[i].i+28,32*j[i].s+40,8,32),2==j[i].o&&e.fillRect(32*j[i].i,32*j[i].s+68,32,8),3==j[i].o&&e.fillRect(32*j[i].i-4,32*j[i].s+40,8,32);if(S!=aa)for(j=0;20>j;j++)for(i=0;40>i;i++)9==d.f[j][i]?d.f[j][i]=10:10==d.f[j][i]&&(d.f[j][i]=9);aa=S;for(i in d.b)!(m[i].I>m[i].J)||n(f(32*d.b[i][0]-32,m[i].u+20))||n(f(32*d.b[i][0],m[i].u+20))||n(f(32*d.b[i][0]+32,m[i].u+20))||n(f(32*d.b[i][2]-32,m[i].v-4))||n(f(32*d.b[i][2],m[i].v-4))||n(f(32*d.b[i][2]+32,m[i].v-4))?!(m[i].J>m[i].I)||n(f(32*d.b[i][2]-32,m[i].v+20))||n(f(32*d.b[i][2],m[i].v+20))||n(f(32*d.b[i][2]+32,m[i].v+20))||n(f(32*d.b[i][0]-32,m[i].u-4))||n(f(32*d.b[i][0],m[i].u-4))||n(f(32*d.b[i][0]+32,m[i].u-4))||(m[i].u-=4,m[i].v+=4):(m[i].u+=4,m[i].v-=4),G(15,32*d.b[i][0]-32,m[i].u+40),G(15,32*d.b[i][0],m[i].u+40),G(15,32*d.b[i][0]+32,m[i].u+40),G(15,32*d.b[i][2]-32,m[i].v+40),G(15,32*d.b[i][2],m[i].v+40),G(15,32*d.b[i][2]+32,m[i].v+40);v++;V&&(ba++,e.font="bold 100px arial",e.fillStyle="#000",e.textAlign="center",e.fillText("CLEARED!",640,350));30<=ba&&(a.width^=0,clearInterval(R),w=P,d.W=!0,a.width^=0,A())}function ea(){d={f:[],a:[],b:[],h:[],W:!1};for(j=0;20>j;j++)d.f[j]=[];z=J=M=B=E=0}function ga(){V=!1;v=ba=W=0;q={x:640,y:0,g:0,c:0,w:0,R:!1,left:[],L:!1,Y:[],S:!1,right:[],ea:!1,ca:[],T:[],V:[],angle:0,direction:1,state:0,B:null,X:null,$:null,N:0,K:!0};ha=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];d.h=[];aa=!1;t=[];m=[];r={i:-1,s:-1};p={i:-2,s:-2};U=[]}function F(b,e){return d.f[e]?!d.f[e][b]||14>d.f[e][b]||24<d.f[e][b]:0}function n(b){return ha[b]||0}function K(b,e,c){d.f[~~(e/32)]&&(d.f[~~(e/32)][~~(b/32)]=c)}function f(b,e){return d.f[~~(e/32)]?d.f[~~(e/32)][~~(b/32)]||0:0}function G(b,d,c){e.drawImage(tileset,16*b,0,16,16,d,c,32,32)}function h(b,d,c){e.drawImage(tileset,16*b,0,16,16,32*d,40+32*c,32,32)}var e=a.getContext("2d");localStorage.scpm=4;var w=1,P=0,ca=!1,Y=!1,g=tile_y=0,x=y=0,Q=0,d={},E,B,M,J,z,ia,X,N,O,L,H,V,ba,W,R,v,q,ha,S,aa,t,m,r,p,I,U,Z,T,u,D,C,ja=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600<0<0<0000000G0000050505000000000000000005050500400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330000000044400044400007000000000400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{a:[[11,13,17,9,16],[20,17,6,18,16]],b:[[31,8,35,17]],hash:"00000000000000000000000000000000000000000000000000000000000000000000000<000<000000000000000000000000000000000009000900000000<000000000000000000000000000000000000000000000000000000000000000000000000000000099900000000000003333333300000000000000000090000000004000000003000000000000000000::90000000004400600003000000000000020000009000000000444000000300000000000000000099900000000000006000030000000000000000000090000000000000060003000000000000000000::90000000000000000003000000000000000000009000000000000006000300000000000000000099900000000000000000030000000000000300000090000000000000000<03000000000000030F000090000000000000000003000000000000030G0;009000000000000000000300000000000003333333333330033333330033330000000000000333333333333333333333333333000000000000030000000000000000000000000000000000000000"},{hash:"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000344444444444444444400000000000000000000030000000000000000000000000000000000040003000000000000000000000000000000000004000300000000000000000000000008000000000400030000<00000777000000000000800000000040003444444444444444444400000080000000004000300000000000000000000000008000;000004000306660000000000000000000008003333993300030000000000000000000000000000300000030003000004444444444444000000000030200003000300000400000000000000000000003000000300030F000400000000000000000000003000000300030G000400000000000000000000003000000300034444440000000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"},{hash:"0000000000000000000000000000000000000000044440000000000000000000000000000008888004000000000000000000000000000000000000800400000000000000000000000000000000000080040000000000000000000000000000000000008004000000000000000000000000000000000000800400000000000000000000000000000000000080040000000000000000000000000000000000008004000000000000000000000000000000000000800400000000000000000000000000000000000080040000000000000000000000000000000000008004000000000000060000000000000000060000800400000000000006000000000000000006000080040000F000000006000000000000000006200080040000G0000000060000000000000000000000800400088800000000000000000000000008880080040000000000000000000000000000000000008004444444444444440000000008888888888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",pipes:[],balances:[]}],A=onload=onhashchange=function(b){a.width^=0;e.font="bold 30px arial";e.textAlign="center";e.mozImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;0==w&&(a.style.cursor="pointer",e.drawImage(tileset,512,0,70,16,120,150,280,64),e.drawImage(tileset,583,0,270,16,120,250,1080,64),e.fillStyle="#000",e.beginPath(),e.fillRect(500,400,100,80),e.fillRect(650,400,100,80),e.fillStyle="#fff",e.fillText("MAKE",700,450),e.fillText("PLAY",550,450),e.stroke(),e.closePath());if(1==w){a.style.cursor="pointer";e.beginPath();e.fillStyle="#000";e.fillRect(590,520,100,80);for(c=0;10>c;c++)for(f=0;3>f;f++)L=10*f+c+1,e.fillStyle="#000",e.fillRect(120*c+50,100*f+120,100,80),e.fillStyle="#fff",e.fillText(+localStorage.scpm>=L?L:"?",120*c+100,100*f+170);e.fillText("LEVELS",640,70);e.fillText("MORE LEVELS ONLINE",640,470);e.fillText("GO",640,570);e.fillText("\u25c0",40,70);e.stroke();e.closePath()}2==w&&(a.style.cursor="crosshair",R&&clearInterval(R),ga(),R=setInterval(ka,33));if(3==w){a.style.cursor="pointer";e.strokeStyle="#777";e.lineWidth=1;e.fillStyle="#fff";e.fillRect(0,0,1280,648);e.fillStyle="#5C94FC";e.fillRect(0,40,1280,640);e.beginPath();for(c=0;16>c;c++)e.fillRect(8+35*c,3,32,32),e.rect(8+35*c,3,32,32),G(c,8+35*c,3);if(!b&&d.hash){d.f=[];for(var f=0;20>f;f++){d.f[f]=[];for(var c=0;40>c;c++)d.f[f][c]=d.hash.charCodeAt(40*f+c)-48}}for(f=0;f<d.f.length;f++)for(c=0;c<d.f[f].length;c++)if(H=d.f[f][c],h(H,c,f),2==H&&(O=!1,20>f))for(k=f+1;20>k;k++)d.f[k][c]||O?O=!0:h(24,c,k);for(c in d.a){X=d.a[c][1];if(d.a[c][2])for(ia=d.a[c][1]<d.a[c][2]?d.a[c][1]:d.a[c][2],X=d.a[c][1]<d.a[c][2]?d.a[c][2]:d.a[c][1],k=ia+1;k<X;k++)h(18,d.a[c][0],k),h(19,d.a[c][0]+1,k),d.f[k][d.a[c][0]]=18,d.f[k][d.a[c][0]+1]=19;if(d.a[c][1])for(N=!1,k=X+1;21>k;k++)20>k&&!d.f[k][d.a[c][0]]&&!d.f[k][d.a[c][0]+1]&&!N?(h(18,d.a[c][0],k),h(19,d.a[c][0]+1,k)):N=!0;d.a[c][1]&&(h(16,d.a[c][0],d.a[c][1]),h(17,d.a[c][0]+1,d.a[c][1]));d.a[c][2]&&(h(16,d.a[c][0],d.a[c][2]),h(17,d.a[c][0]+1,d.a[c][2]));d.a[c][4]&&h(20,d.a[c][3],d.a[c][4])}for(c in d.b)d.b[c][1]&&(h(15,d.b[c][0]-1,d.b[c][1]),h(15,d.b[c][0],d.b[c][1]),h(15,d.b[c][0]+1,d.b[c][1]),d.f[d.b[c][1]][d.b[c][0]-1]=15,d.f[d.b[c][1]][d.b[c][0]]=15,d.f[d.b[c][1]][d.b[c][0]+1]=15),d.b[c][3]&&(h(15,d.b[c][2]-1,d.b[c][3]),h(15,d.b[c][2],d.b[c][3]),h(15,d.b[c][2]+1,d.b[c][3]),d.f[d.b[c][3]][d.b[c][2]-1]=15,d.f[d.b[c][3]][d.b[c][2]]=15,d.f[d.b[c][3]][d.b[c][2]+1]=15);0<=tile_y&&!Y&&(1==z?0<tile_y&&(h(22,g,tile_y-1),h(23,g,tile_y)):14==z?(0==E&&(h(16,g,tile_y),h(17,g+1,tile_y)),1==E&&(h(16,d.a[B][0],tile_y),h(17,d.a[B][0]+1,tile_y)),2==E&&h(20,g,tile_y)):15==z?(h(15,g-1,tile_y),h(15,g,tile_y),h(15,g+1,tile_y)):h(z,g,tile_y));for(c=0;40>c;c++)e.moveTo(32*c,40),e.lineTo(32*c,648);for(f=0;20>f;f++)e.moveTo(0,40+32*f),e.lineTo(1280,40+32*f);e.fillStyle="#000";e.fillRect(750,4,100,32);e.fillRect(875,4,100,32);e.fillRect(1E3,4,100,32);e.fillRect(1125,4,100,32);e.fillStyle="#fff";e.font="bold 20px arial";e.fillText("TEST",800,28);e.fillText("SHARE",925,28);e.fillText("CLEAR",1050,28);e.fillText("EXIT",1175,28);e.stroke();e.closePath();e.beginPath();c=z;e.strokeStyle="red";e.lineWidth=3;e.rect(8+35*c,3.5,32,32);e.stroke();e.closePath()}};a.onclick=a.oncontextmenu=function(b){da(b);return!1};a.onmousedown=function(b){ca=!0;Y=3==b.which?!0:!1};a.onmouseup=function(){ca=!1};a.onmousemove=function(b){x=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;g=Math.floor(x/32);tile_y=Math.floor((y-40)/32);3==w&&(ca&&14!=z&&15!=z&&da(b),A(1))};onkeydown=function(b){if(2==w){38!=b.keyCode&&90!=b.keyCode&&87!=b.keyCode||!q.K||(q.L=!0,q.K=!1);if(39==b.keyCode||68==b.keyCode)q.S=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)q.R=!0}};onkeyup=function(b){if(2==w){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)q.L=!1,q.K=!0;if(39==b.keyCode||68==b.keyCode)q.S=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)q.R=!1;82==b.keyCode&&ga();32==b.keyCode&&(q.ca[v]=!0,q.U^=1)}};onhashchange=function(){location.hash&&(d=JSON.parse(decodeURIComponent(location.hash.slice(1))),w=2,A())};onhashchange()</script>