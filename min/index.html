<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:pointer"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function X(d,c,e){"undefined"!=typeof d.l&&null!==d.l&&(d.weight=1+b.g[d.l].weight);if(0<d.j){if(q(l(d.x+c+d.j,d.y))||q(l(d.x+c+d.j,d.y+31)))d.x=32*~~((d.x+d.j)/32)+32-c-1,d.j=0;d.x>1280-c&&(d.x=1280-c,d.j=0);for(var f in b.a)d.x+c+d.j>=32*b.a[f][0]&&d.x+c+d.j<=32*b.a[f][0]+16&&d.y+31>=n[f].y&&d.y<=n[f].O&&(d.x=32*b.a[f][0]-c-1,d.j=0)}if(0>d.j){if(q(l(d.x+d.j,d.y))||q(l(d.x+d.j,d.y+31)))d.x=32*~~((d.x+d.j)/32)+32,d.j=0;0>d.x&&(d.x=0,d.j=0);for(f in b.a)d.x+d.j>=32*b.a[f][0]+64-16&&d.x+d.j<=32*b.a[f][0]+64&&d.y+31>=n[f].y&&d.y<=n[f].O&&(d.x=32*b.a[f][0]+64,d.j=0)}d.x+=d.j;d.m=!1;d.f+=2;20<d.f&&(d.f=20);q(l(d.x+c/2,d.y+24))&&(d.y=32*~~(d.y/32)+32);if(0<d.f){if(q(l(d.x,d.y+32+d.f))||q(l(d.x+c,d.y+32+d.f))||1==e&&7==l(d.x,d.y+32+d.f)||1==e&&7==l(d.x+c,d.y+32+d.f))d.y=32*~~((d.y+d.f)/32),d.f=0,d.m=!0;for(g in b.g)d.x+c>b.g[g].x&&d.x<b.g[g].x+32&&d.y+31+d.f>b.g[g].y-8&&d.y+31+d.f<b.g[g].y+20&&(d.y=b.g[g].y-32,d.f=0,d.m=!0,d.P=g,d.V=d.x-b.g[g].x,b.g[g].weight+=d.weight);for(f in b.a)d.x+c>=32*b.a[f][0]&&d.x<32*b.a[f][0]+64&&d.y+31+d.f>=n[f].y&&d.y+31+d.f<=n[f].y+32&&(d.y=n[f].y-32,d.f=0,d.m=!0);for(f in b.c)d.x+c>=32*b.c[f][0]-32&&d.x<32*b.c[f][0]+64&&d.y+31+d.f>=m[f].o-8&&d.y+31+d.f<=m[f].o+32&&(d.y=m[f].o-32,d.f=0,d.m=!0,m[f].D+=d.weight);for(f in b.c)d.x+c>=32*b.c[f][2]-32&&d.x<32*b.c[f][2]+64&&d.y+31+d.f>=m[f].s-8&&d.y+31+d.f<=m[f].s+32&&(d.y=m[f].s-32,d.f=0,d.m=!0,m[f].F+=d.weight)}0==e&&0>d.f&&(q(l(d.x,d.y))||q(l(d.x+c,d.y)))&&(5==l(d.x,d.y)&&L(d.x,d.y,0),5==l(d.x+24,d.y)&&L(d.x+24,d.y,0),d.y=32*~~(d.y/32)+32,d.f=0);d.y+=d.f;11==l(d.x,d.y+20)?(L(d.x,d.y+20,25),M=!0):11==l(d.x+c,d.y+20)&&(L(d.x+c,d.y+20,25),M=!0);for(var g in b.a)d.x+c>=32*b.a[g][3]&&d.x<=32*b.a[g][3]+32&&d.y+32>=32*b.a[g][4]&&d.y+20<=32*b.a[g][4]+32&&(n[g].H=!0)}function ca(){a.width^=0;e.font="bold 30px arial";e.fillStyle="#000";e.fillText("\u00d7",1255,25);1==N&&(1==P&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Move with arrow keys or WASD or ZQSD.",640,80),e.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),e.fillText("Collect all coins and reach the flag.",640,160)),2==P&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Let's add some mechanisms...",640,80)),3==P&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center"));e.X=!1;e.W=!1;if(0==v){b.b=[];for(var d=0;20>d;d++){b.b[d]=[];for(var f=0;40>f;f++)b.b[d][f]=b.hash.charCodeAt(40*d+f)-48,15==b.b[d][f]&&(b.b[d][f]=0)}for(f in b.a)n[f]={H:!1,y:32*b.a[f][1]};for(f in b.c)m[f]={o:32*b.c[f][1],s:32*b.c[f][3],D:0,F:0}}for(var h in b.a){n[h].H?(n[h].y>32*b.a[h][2]&&(n[h].y=Math.max(n[h].y-4,32*b.a[h][2])),n[h].y<32*b.a[h][2]&&(n[h].y=Math.min(n[h].y+4,32*b.a[h][2]))):(n[h].y>32*b.a[h][1]&&(n[h].y=Math.max(n[h].y-4,32*b.a[h][1])),n[h].y<32*b.a[h][1]&&(n[h].y=Math.min(n[h].y+4,32*b.a[h][1])));G=!1;for(d=~~(n[h].y/32)+1;21>d;d++)if(20>d&&!q(l(b.a[h][0],d))&&!q(l(b.a[h][0]+1,d))&&!G)g(18,b.a[h][0],d),g(19,b.a[h][0]+1,d);else{G=!0;n[h].O=32*d;break}B(16,32*b.a[h][0],n[h].y+40);B(17,32*b.a[h][0]+32,n[h].y+40);b.a[h][4]&&(n[h].H?g(21,b.a[h][3],b.a[h][4]):g(20,b.a[h][3],b.a[h][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){C=b.b[j][i];12==C&&(C=0,0==v&&b.g.push({x:32*i,y:32*j,f:0,K:null}));g(C,i,j);if(2==C&&0==v&&(H=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||H?H=!0:(g(24,i,k),b.b[k][i]=24);23==C&&0==v&&(b.start=[i,j],c.x=32*b.start[0],c.y=32*b.start[1])}M=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==b.b[j][i]&&(b.b[j][i]=11);for(i in b.a)n[i].H=!1;c.weight=1;for(i in b.g)b.g[i].weight=1;for(i in b.c)m[i].D=0,m[i].F=0;if(3!=c.state&&!Q){c.state=0;c.j=0;c.right&&(c.S[v]=!0,c.j=6,c.direction=1,c.m&&(c.state=1));c.left&&(c.R[v]=!0,c.j=-6,c.direction=0,c.m&&(c.state=1));c.N&&c.m&&c.J&&(c.U[v]=!0,c.f-=20,c.m=!1,c.J=!1);0>c.f&&!c.m&&(c.state=2);X(c,24,0);6==l(c.x+12,c.y+16)&&L(c.x+12,c.y+16,0);if(7==l(c.x+3,c.y)||7==l(c.x+24-3,c.y)||7==l(c.x+3,c.y+5)||7==l(c.x+24-3,c.y+5))c.state=3,c.f=-30;648<c.y&&(c.state=3,c.f=-30);if(c.L){if(c.T[v]=!0,null===c.l)for(i in b.g)if(c.x+24>=b.g[i].x&&c.x<=b.g[i].x+31&&c.y+31>=b.g[i].y&&c.y<=b.g[i].y+31){c.l=i;b.g[i].K=c;c.G=5;break}}else b.g[c.l]&&(b.g[c.l].K=null,c.l=null,c.weight=1);null!==c.l?(b.g[c.l].x=c.x+-8*c.direction,c.G&&c.G--,b.g[c.l].y=c.y-32+4*c.G):c.L=0;if(2==l(c.x+12,c.y+16)||24==l(c.x+12,c.y+16)){for(j=R=0;20>j;j++)for(i=0;40>i;i++)6==b.b[j][i]&&R++;0==R&&(Q=!0,c.state=0)}if(c.B)for(i=0;40>i;i++)c.B+=.001,c.h+=c.B*c.w,c.i+=c.B*c.A,q(l(c.h,c.i))?(c.B=0,4>c.h%32&&!q(l(c.h-32,c.i))&&0<c.w&&(temp_side=3),28<c.h%32&&!q(l(c.h+32,c.i))&&0>c.w&&(temp_side=1),4>c.i%32&&!q(l(c.h,c.i-32))&&0<c.A&&(temp_side=0),28<c.i%32&&!q(l(c.h,c.i+32))&&0>c.A&&(temp_side=2),4!=l(c.h,c.i)||~~(c.h/32)==p.u&&~~(c.i/32)==p.v&&p==temp_side||(E=~~(c.h/32),I=~~(c.i/32),J=temp_side)):(e.fillStyle="blue",e.fillRect(c.h,c.i+40,6,6));if(c.C)for(i=0;40>i;i++)c.C+=.001,c.h+=c.C*c.w,c.i+=c.C*c.A,q(l(c.h,c.i))?(c.C=0,4>c.h%32&&!q(l(c.h-32,c.i))&&0<c.w&&(temp_side=3),28<c.h%32&&!q(l(c.h+32,c.i))&&0>c.w&&(temp_side=1),4>c.i%32&&!q(l(c.h,c.i-32))&&0<c.A&&(temp_side=0),28<c.i%32&&!q(l(c.h,c.i+32))&&0>c.A&&(temp_side=2),4!=l(c.h,c.i)||~~(c.h/32)==p.u&&~~(c.i/32)==p.v&&p==temp_side||(p.u=~~(c.h/32),p.v=~~(c.i/32),p.I=temp_side)):(e.fillStyle="orange",e.fillRect(c.h,c.i+40,6,6));E&&(e.fillStyle="blue",0==J&&e.fillRect(32*E,32*I+40-8,32,8),1==J&&e.fillRect(32*E+28,32*I+40,8,32),2==J&&e.fillRect(32*E,32*I+68,32,8),3==J&&e.fillRect(32*E-4,32*I+40,8,32));p.u&&(e.fillStyle="orange",0==p.I&&e.fillRect(32*p.u,32*p.v+40-8,32,8),1==p.I&&e.fillRect(32*p.u+28,32*p.v+40,8,32),2==p.I&&e.fillRect(32*p.u,32*p.v+68,32,8),3==p.I&&e.fillRect(32*p.u-4,32*p.v+40,8,32))}3==c.state&&(c.f+=2,20<c.f&&(c.f=20),c.y+=c.f);for(i in b.g)null===b.g[i].K&&(b.g[i].j=0,X(b.g[i],32,1));for(i in b.g)e.drawImage(tileset,192,0,16,16,b.g[i].x,40+b.g[i].y,32,32);1==c.direction?e.drawImage(tileset,16*[26,[27,28,29][~~(v/2)%3],30,31][c.state],0,16,16,c.x-4,40+c.y,32,32):(e.save(),e.translate(c.x+24+4,c.y),e.scale(-1,1),e.drawImage(tileset,16*[26,[27,28,29][~~(v/2)%3],30,31][c.state],0,16,16,0,40,32,32),e.restore());if(M!=T)for(j=0;20>j;j++)for(i=0;40>i;i++)9==b.b[j][i]?b.b[j][i]=10:10==b.b[j][i]&&(b.b[j][i]=9);T=M;for(i in b.c)m[i].D>m[i].F?(m[i].o+=4,m[i].s-=4):m[i].F>m[i].D&&(m[i].o-=4,m[i].s+=4),B(15,32*b.c[i][0]-32,m[i].o+40),B(15,32*b.c[i][0],m[i].o+40),B(15,32*b.c[i][0]+32,m[i].o+40),B(15,32*b.c[i][2]-32,m[i].s+40),B(15,32*b.c[i][2],m[i].s+40),B(15,32*b.c[i][2]+32,m[i].s+40);v++;document.title=c.x+" "+c.y;Q&&(U++,e.font="bold 100px arial",e.fillStyle="#000",e.textAlign="center",e.fillText("CLEARED!",640,350));30<=U&&(a.width^=0,clearInterval(O),r=N,b.M=!0,a.width^=0,w())}function Y(){b={b:[],a:[],c:[],g:[],M:!1};for(j=0;20>j;j++)b.b[j]=[];u=D=K=x=z=0}function Z(){Q=!1;v=U=R=0;c={x:0,y:0,j:0,f:0,m:0,U:[],S:[],R:[],T:[],direction:1,state:0,l:null,J:!0,P:null,V:null,G:0};aa=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];b.g=[];T=!1;n=[];m=[];I=E=-1;J=void 0;p={u:-2,v:-2}}function A(d,c){return b.b[c]?!b.b[c][d]||14>b.b[c][d]||24<b.b[c][d]:0}function q(b){return aa[b]||0}function L(c,e,f){b.b[~~(e/32)]&&(b.b[~~(e/32)][~~(c/32)]=f)}function l(c,e){return b.b[~~(e/32)]?b.b[~~(e/32)][~~(c/32)]||0:0}function B(b,c,f){e.drawImage(tileset,16*b,0,16,16,c,f,32,32)}function g(b,c,f){e.drawImage(tileset,16*b,0,16,16,32*c,40+32*f,32,32)}var E,I,J,e=a.getContext("2d");localStorage.scpm_level=3;var r=1,N=0,V=!1,W=!1,f=tile_y=0,t=y=0,P=0,b={},z,x,K,D,u,ba,S,G,H,F,C,Q,U,R,O,v,c,aa,M,T,n,m,p,da=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600000000000000G0000050505000000000000000000000000400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330<0000004440004440000700<0<0<00400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{a:[[17,16,4,15,16]],c:[[31,8,35,17]],hash:"00000000000000000000000000000000000000000000000000000000000000000000000<000<00000000000000000000000000000000000900090000000000<00000000000000000000000000000000000000000000000000000333333330000000000000000099990000000000000300000000000000000000000009000000006000030000000000000000000000:::9000000000000030000000000000000200000000900000000600003000000000000000000000099990000000000000300000000000000000000000009000000000600030000000000000000000000:::900000000000003000000000000000000000000090000000006000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000090000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"},{hash:"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000344444444444444444440000000000000000400030000000000000000000000000000000000040003000000000000000000000000000000000004000300000000000000000000000008000000000400030000<00777700000000000000800000000040003444444444444444444400000080000000004000300000000000000000000000008000;000004000300000000000000000000000008003333993300030000000000000000000000000800300000030003000000004444444444400000080030200003000300000000400000000000000008003000000300030F000400400000000000000000003000000300030G000000400000000000000000003000000300034444444440000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],w=onload=onhashchange=function(){a.width^=0;e.font="bold 30px arial";e.textAlign="center";e.mozImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;0==r&&(e.drawImage(tileset,512,0,70,16,120,150,280,64),e.drawImage(tileset,583,0,270,16,120,250,1080,64),e.fillStyle="#000",e.beginPath(),e.fillRect(500,400,100,80),e.fillRect(650,400,100,80),e.fillStyle="#fff",e.fillText("MAKE",700,450),e.fillText("PLAY",550,450),e.stroke(),e.closePath());if(1==r){e.beginPath();e.fillStyle="#000";e.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)F=10*j+i+1,e.fillStyle="#000",e.fillRect(120*i+50,100*j+120,100,80),e.fillStyle="#fff",e.fillText(+localStorage.scpm_level>=F?F:"?",120*i+100,100*j+170);e.fillText("LEVELS",640,70);e.fillText("MORE LEVELS ONLINE",640,470);e.fillText("GO",640,570);e.fillText("\u25c0",40,70);e.stroke();e.closePath()}2==r&&(O&&clearInterval(O),Z(),O=setInterval(ca,33));if(3==r){e.strokeStyle="#777";e.lineWidth=1;e.fillStyle="#fff";e.fillRect(0,0,1280,648);e.fillStyle="#5C94FC";e.fillRect(0,40,1280,640);e.beginPath();for(i=0;16>i;i++)e.fillRect(8+35*i,3,32,32),e.rect(8+35*i,3,32,32),B(i,8+35*i,3);for(j=0;j<b.b.length;j++)for(i=0;i<b.b[j].length;i++)if(C=b.b[j][i],g(C,i,j),2==C&&(H=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||H?H=!0:g(24,i,k);for(i in b.a){S=b.a[i][1];if(b.a[i][2])for(ba=b.a[i][1]<b.a[i][2]?b.a[i][1]:b.a[i][2],S=b.a[i][1]<b.a[i][2]?b.a[i][2]:b.a[i][1],k=ba+1;k<S;k++)g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k),b.b[k][b.a[i][0]]=18,b.b[k][b.a[i][0]+1]=19;if(b.a[i][1])for(G=!1,k=S+1;21>k;k++)20>k&&!b.b[k][b.a[i][0]]&&!b.b[k][b.a[i][0]+1]&&!G?(g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k)):G=!0;b.a[i][1]&&(g(16,b.a[i][0],b.a[i][1]),g(17,b.a[i][0]+1,b.a[i][1]));b.a[i][2]&&(g(16,b.a[i][0],b.a[i][2]),g(17,b.a[i][0]+1,b.a[i][2]));b.a[i][4]&&g(20,b.a[i][3],b.a[i][4])}for(i in b.c)b.c[i][3]&&(g(15,b.c[i][0]-1,b.c[i][1]),g(15,b.c[i][0],b.c[i][1]),g(15,b.c[i][0]+1,b.c[i][1]),b.b[b.c[i][1]][b.c[i][0]-1]=15,b.b[b.c[i][1]][b.c[i][0]]=15,b.b[b.c[i][1]][b.c[i][0]+1]=15,g(15,b.c[i][2]-1,b.c[i][3]),g(15,b.c[i][2],b.c[i][3]),g(15,b.c[i][2]+1,b.c[i][3]),b.b[b.c[i][3]][b.c[i][2]-1]=15,b.b[b.c[i][3]][b.c[i][2]]=15,b.b[b.c[i][3]][b.c[i][2]+1]=15);0<=tile_y&&!W&&(1==u?0<tile_y&&(g(22,f,tile_y-1),g(23,f,tile_y)):14==u?(0==z&&(g(16,f,tile_y),g(17,f+1,tile_y)),1==z&&(g(16,b.a[x][0],tile_y),g(17,b.a[x][0]+1,tile_y)),2==z&&g(20,f,tile_y)):15==u?(g(15,f-1,tile_y),g(15,f,tile_y),g(15,f+1,tile_y)):g(u,f,tile_y));for(i=0;40>i;i++)e.moveTo(32*i,40),e.lineTo(32*i,648);for(j=0;20>j;j++)e.moveTo(0,40+32*j),e.lineTo(1280,40+32*j);e.fillStyle="#000";e.fillRect(750,4,100,32);e.fillRect(875,4,100,32);e.fillRect(1E3,4,100,32);e.fillRect(1125,4,100,32);e.fillStyle="#fff";e.font="bold 20px arial";e.fillText("TEST",800,28);e.fillText("SHARE",925,28);e.fillText("CLEAR",1050,28);e.fillText("EXIT",1175,28);e.stroke();e.closePath();e.beginPath();i=u;e.strokeStyle="red";e.lineWidth=3;e.rect(8+35*i,3.5,32,32);e.stroke();e.closePath()}};a.onclick=a.oncontextmenu=function(d){t=d.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=d.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==r&&(e.beginPath(),e.rect(500,400,100,80),e.isPointInPath(t,y)&&(r=1,w()),e.closePath(),e.beginPath(),e.rect(650,400,100,80),e.isPointInPath(t,y)&&(r=3,Y(),w()),e.closePath());if(1==r)for(e.beginPath(),e.rect(30,30,50,50),e.isPointInPath(t,y)&&(r=0,w()),e.closePath(),e.beginPath(),e.rect(590,520,100,80),e.isPointInPath(t,y)&&(location="todo"),e.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)F=10*j+i+1,+localStorage.scpm_level>=F&&(e.beginPath(),e.rect(120*i+50,100*j+120,100,80),e.isPointInPath(t,y)&&(N=1,r=2,P=F,b=da[F],w()),e.closePath());2==r&&0<v&&(1==d.which&&(c.B=1),3==d.which&&(c.C=1),e.beginPath(),d=Math.atan2(t-(c.x+12),y-(c.y+40+16)),c.h=c.x+12,c.i=c.y+16,c.w=Math.sin(d),c.A=Math.cos(d),e.stroke(),e.closePath(),e.beginPath(),e.rect(1240,0,32,32),e.isPointInPath(t,y)&&(clearInterval(O),r=N,w()),e.closePath());if(3==r){e.beginPath();e.rect(750,4,100,32);if(e.isPointInPath(t,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);N=3;r=2;w()}e.closePath();e.beginPath();e.rect(875,4,100,32);if(e.isPointInPath(t,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);location.hash="";0==b.M&&alert("You need to test and win your level first.");prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:b.hash,a:b.a,c:b.c})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:b.hash,a:b.a,c:b.c}))}e.closePath();e.beginPath();e.rect(1E3,4,100,32);e.isPointInPath(t,y)&&(Y(),w());e.closePath();e.beginPath();e.rect(1125,4,100,32);e.isPointInPath(t,y)&&(r=0,w());e.closePath();for(i=0;16>i;i++)e.beginPath(),e.rect(8.5+35*i,3.5,32,32),e.isPointInPath(t,y)&&0==z&&0==K&&(u=i,14==u&&(b.a[x]=[]),15==u&&(b.c[D]=[]),w()),e.closePath();e.beginPath();e.rect(8.5,40.5,1264,592);if(e.isPointInPath(t,y)){b.M=!1;f=Math.floor(t/32);tile_y=Math.floor((y-40)/32);if(1==W)A(f,tile_y)&&(b.b[tile_y][f]=0);else if(1==u){if(0<tile_y&&A(f,tile_y)&&A(f,tile_y-1)){for(j in b.b)for(i in b.b[j])if(22==b.b[j][i]||23==b.b[j][i])b.b[j][i]=0;b.b[tile_y-1][f]=22;b.b[tile_y][f]=23}}else if(2==u){if(A(f,tile_y)){for(j in b.b)for(i in b.b[j])2==b.b[j][i]&&(b.b[j][i]=0);b.b[tile_y][f]=2}}else 14==u?A(f,tile_y)&&A(f+1,tile_y)&&(0==z?(b.a[x]=[],b.a[x][0]=f,b.a[x][1]=tile_y,b.b[tile_y][f]=16,b.b[tile_y][f+1]=17,z++):1==z?(b.a[x][2]=tile_y,b.b[tile_y][b.a[x][0]]=16,b.b[tile_y][b.a[x][0]+1]=17,z++):2==z&&(b.a[x][3]=f,b.a[x][4]=tile_y,b.b[tile_y][f]=20,x++,z=0)):15==u?A(f-1,tile_y)&&A(f,tile_y)&&A(f+1,tile_y)&&(0==K?(b.c[D]=[],b.c[D][0]=f,b.c[D][1]=tile_y,K++):1==K&&(b.c[D][2]=f,b.c[D][3]=tile_y,D++,K=0),b.b[tile_y][f-1]=15,b.b[tile_y][f]=15,b.b[tile_y][f+1]=15):A(f,tile_y)&&(b.b[tile_y][f]=u);w()}e.closePath()}return!1};onmousedown=function(b){V=!0;W=3==b.which?!0:!1};onmouseup=function(){V=!1};onmousemove=function(b){3==r&&(V&&14!=u&&15!=u&&onclick(b),t=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,f=Math.floor(t/32),tile_y=Math.floor((y-40)/32),w())};onkeydown=onkeypress=function(b){if(2==r){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.N=!0;if(39==b.keyCode||68==b.keyCode)c.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!0}};onkeyup=function(b){if(2==r){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.N=!1,c.J=!0;if(39==b.keyCode||68==b.keyCode)c.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!1;82==b.keyCode&&Z();32==b.keyCode&&(c.L^=1)}};onhashchange=function(){location.hash&&(console.log(decodeURIComponent(location.hash.slice(1))),b=JSON.parse(decodeURIComponent(location.hash.slice(1))),r=2,w())};onhashchange()</script>