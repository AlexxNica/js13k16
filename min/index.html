<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:pointer"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function ba(){a.width^=0;c.font="bold 30px arial";c.fillStyle="#000";c.fillText("\u00d7",1255,25);1==J&&(1==R&&(c.font="bold 30px arial",c.fillStyle="black",c.textAlign="center",c.fillText("Move with arrow keys or WASD or ZQSD.",640,80),c.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),c.fillText("Collect all coins and reach the flag.",640,160)),2==R&&(c.font="bold 30px arial",c.fillStyle="black",c.textAlign="center",c.fillText("Mechanisms...",640,80)));c.M=!1;c.L=!1;if(0==w){b.b=[];for(var e=0;20>e;e++){b.b[e]=[];for(var t=0;40>t;t++)b.b[e][t]=b.hash.charCodeAt(40*e+t)-48,15==b.b[e][t]&&(b.b[e][t]=0)}for(t in b.a)m[t]={u:!1,y:32*b.a[t][1]};for(t in b.f)l[t]={j:32*b.f[t][1],l:32*b.f[t][3],m:0,o:0}}for(var h in b.a){m[h].u?(m[h].y>32*b.a[h][2]&&(m[h].y=Math.max(m[h].y-4,32*b.a[h][2])),m[h].y<32*b.a[h][2]&&(m[h].y=Math.min(m[h].y+4,32*b.a[h][2]))):(m[h].y>32*b.a[h][1]&&(m[h].y=Math.max(m[h].y-4,32*b.a[h][1])),m[h].y<32*b.a[h][1]&&(m[h].y=Math.min(m[h].y+4,32*b.a[h][1])));G=!1;for(e=~~(m[h].y/32)+1;21>e;e++)if(20>e&&!b.b[e][b.a[h][0]]&&!b.b[e][b.a[h][0]+1]&&!G)g(18,b.a[h][0],e),g(19,b.a[h][0]+1,e);else{G=!0;m[h].D=32*e;break}B(16,32*b.a[h][0],m[h].y+40);B(17,32*b.a[h][0]+32,m[h].y+40);b.a[h][4]&&(m[h].u?g(21,b.a[h][3],b.a[h][4]):g(20,b.a[h][3],b.a[h][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){C=b.b[j][i];12==C&&0==w&&(b.c.push({x:32*i,y:32*j,g:0,w:null}),C=0,b.b[j][i]=0);g(C,i,j);if(2==C&&0==w&&(H=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||H?H=!0:(g(24,i,k),b.b[k][i]=24);23==C&&0==w&&(b.start=[i,j],d.x=32*b.start[0],d.y=32*b.start[1])}K=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==b.b[j][i]&&(b.b[j][i]=11);for(i in b.a)m[i].u=!1;d.weight=1;for(i in b.c)b.c[i].weight=1;for(i in b.f)l[i].m=0,l[i].o=0;if(3!=d.state&&!N){d.state=0;d.right&&(d.H[w]=!0,d.x+=6,d.direction=1,d.i&&(d.state=1));d.left&&(d.G[w]=!0,d.x-=6,d.direction=0,d.i&&(d.state=1));d.C&&d.i&&d.v&&(d.J[w]=!0,d.g-=20,d.i=!1,d.v=!1);0>d.g&&!d.i&&(d.state=2);W(d,x,0);6==n(d.x+x/2,d.y+16)&&L(d.x+x/2,d.y+16,0);if(7==n(d.x+3,d.y)||7==n(d.x+x-3,d.y)||7==n(d.x+3,d.y+5)||7==n(d.x+x-3,d.y+5))d.state=3,d.g=-30;648<d.y&&(d.state=3,d.g=-30);if(d.A){if(d.I[w]=!0,null===d.h)for(i in b.c)if(d.x+x>=b.c[i].x&&d.x<=b.c[i].x+31&&d.y+31>=b.c[i].y&&d.y<=b.c[i].y+31){d.h=i;b.c[i].w=d;d.s=5;break}}else b.c[d.h]&&(b.c[d.h].w=null,d.h=null,d.weight=1);null!==d.h?(b.c[d.h].x=d.x+-8*d.direction,d.s&&d.s--,b.c[d.h].y=d.y-32+4*d.s):d.A=0;if(2==n(d.x+x/2,d.y+16)||24==n(d.x+x/2,d.y+16)){for(j=O=0;20>j;j++)for(i=0;40>i;i++)6==b.b[j][i]&&O++;0==O&&(N=!0)}}3==d.state&&(d.g+=X,d.g>P&&(d.g=P),d.y+=d.g);for(i in b.c)null===b.c[i].w&&W(b.c[i],32,1);for(i in b.c)c.drawImage(tileset,192,0,16,16,b.c[i].x,40+b.c[i].y,32,32);1==d.direction?c.drawImage(tileset,16*[26,[27,28,29][~~(w/2)%3],30,31][d.state],0,16,16,d.x-4,40+d.y,32,32):(c.save(),c.translate(d.x+x+4,d.y),c.scale(-1,1),c.drawImage(tileset,16*[26,[27,28,29][~~(w/2)%3],30,31][d.state],0,16,16,0,40,32,32),c.restore());if(K!=S)for(j=0;20>j;j++)for(i=0;40>i;i++)9==b.b[j][i]?b.b[j][i]=10:10==b.b[j][i]&&(b.b[j][i]=9);S=K;for(i in b.f)l[i].m>l[i].o?(l[i].j+=4,l[i].l-=4):l[i].o>l[i].m&&(l[i].j-=4,l[i].l+=4),B(15,32*b.f[i][0]-32,l[i].j+40),B(15,32*b.f[i][0],l[i].j+40),B(15,32*b.f[i][0]+32,l[i].j+40),B(15,32*b.f[i][2]-32,l[i].l+40),B(15,32*b.f[i][2],l[i].l+40),B(15,32*b.f[i][2]+32,l[i].l+40);w++;N&&(T++,c.font="bold 100px arial",c.fillStyle="#000",c.textAlign="center",c.fillText("CLEARED!",640,350));30<=T&&(a.width^=0,clearInterval(M),p=J,b.B=!0,a.width^=0,u())}function W(e,c,h){if(D[n(e.x+c,e.y)]||D[n(e.x+c,e.y+31)])e.x=32*~~(e.x/32)+32-c-1;e.x>1280-c&&(e.x=1280-c,e.state=0);for(var f in b.a)e.x+c>=32*b.a[f][0]&&e.x+c<=32*b.a[f][0]+16&&e.y+31>=m[f].y&&e.y<=m[f].D&&(e.x=32*b.a[f][0]-c-1);if(D[n(e.x,e.y)]||D[n(e.x,e.y+31)])e.x=32*~~(e.x/32)+32;0>e.x&&(e.x=0,e.state=0);for(f in b.a)e.x>=32*b.a[f][0]+64-16&&e.x<=32*b.a[f][0]+64&&e.y+31>=m[f].y&&e.y<=m[f].D&&(e.x=32*b.a[f][0]+64);e.i=!1;e.g+=X;e.g>P&&(e.g=P);e.y+=e.g;11==n(e.x,e.y+20)?(L(e.x,e.y+20,25),K=!0):11==n(e.x+c,e.y+20)&&(L(e.x+c,e.y+20,25),K=!0);for(var g in b.a)e.x+c>=32*b.a[g][3]&&e.x<=32*b.a[g][3]+32&&e.y+32>=32*b.a[g][4]&&e.y+20<=32*b.a[g][4]+32&&(m[g].u=!0);"undefined"!=typeof e.h&&null!==e.h&&(e.weight=1+b.c[e.h].weight);if(0<e.g){if(D[n(e.x,e.y+32)]||D[n(e.x+c,e.y+32)]||1==h&&7==n(e.x,e.y+32)||1==h&&7==n(e.x+c,e.y+32))e.y=32*~~(e.y/32),e.g=0,e.i=!0;for(g in b.c)e.x+c>b.c[g].x+8&&e.x<b.c[g].x+24&&e.y+31>b.c[g].y-8&&e.y+31<b.c[g].y+20&&(e.y=b.c[g].y-32,e.g=0,e.i=!0,e.F=g,e.K=e.x-b.c[g].x,b.c[g].weight+=e.weight);for(f in b.a)e.x+c>=32*b.a[f][0]&&e.x<32*b.a[f][0]+64&&e.y+31>=m[f].y&&e.y+31<=m[f].y+32&&(e.y=m[f].y-32,e.g=0,e.i=!0);for(f in b.f)e.x+c>=32*b.f[f][0]-32&&e.x<32*b.f[f][0]+64&&e.y+31>=l[f].j-8&&e.y+31<=l[f].j+32&&(e.y=l[f].j-32,e.g=0,e.i=!0,l[f].m+=e.weight);for(f in b.f)e.x+c>=32*b.f[f][2]-32&&e.x<32*b.f[f][2]+64&&e.y+31>=l[f].l-8&&e.y+31<=l[f].l+32&&(e.y=l[f].l-32,e.g=0,e.i=!0,l[f].o+=e.weight)}0==h&&(D[n(d.x,d.y)]||D[n(d.x+x,d.y)])&&(5==n(d.x,d.y)&&L(d.x,d.y,0),5==n(d.x+x,d.y)&&L(d.x+x,d.y,0),d.y=32*~~(d.y/32)+32,d.g=0)}function Y(){b={b:[],a:[],f:[],c:[],B:!1};for(j=0;20>j;j++)b.b[j]=[];q=E=I=v=z=0}function Z(){N=!1;w=T=O=0;d={x:0,y:0,N:0,g:0,i:0,J:[],H:[],G:[],I:[],direction:1,state:0,h:null,v:!0,F:null,K:null,s:0};D=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];b.c=[];S=!1;m=[];l=[]}function A(e,c){return b.b[c]?!b.b[c][e]||14>b.b[c][e]||24<b.b[c][e]:0}function L(c,d,f){b.b[~~(d/32)]&&(b.b[~~(d/32)][~~(c/32)]=f)}function n(c,d){return b.b[~~(d/32)]?b.b[~~(d/32)][~~(c/32)]:0}function B(b,d,f){c.drawImage(tileset,16*b,0,16,16,d,f,32,32)}function g(b,d,f){c.drawImage(tileset,16*b,0,16,16,32*d,40+32*f,32,32)}var c=a.getContext("2d");localStorage.scpm_level|=2;var p=0,J=0,U=!1,V=!1,x=24,X=2,P=20,f=tile_y=0,r=y=0,R=0,b={},z,v,I,E,q,aa,Q,G,H,F,C,N,T,O,M,w,d,D,K,S,m,l,ca=[{},{tiles:[],pipes:[],balances:[],c:[],hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600000000000000G0000050505000000000000000000000000400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330<0000004440004440000700<0<0<00400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{tiles:[],pipes:[[17,16,4,15,16]],balances:[[31,8,35,17]],c:[],hash:"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<00000000000000000000000000000000000000000000000000000333333330000000000000000099990000000000000300000000000000000000000009000000000000030000000000000000000000:::9000000000000030000000000000000200000000900000000000003000000000000000000000099990000000000000300000000000000000000000009000000000000030000000000000000000000:::900000000000003000000000000000000000000090000000000000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000090000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"}];location.hash&&(b=JSON.parse(location.hash.slice(1)),p=2,u());onclick=function(e){r=e.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=e.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==p&&(c.beginPath(),c.rect(500,400,100,80),c.isPointInPath(r,y)&&(p=1,u()),c.closePath(),c.beginPath(),c.rect(650,400,100,80),c.isPointInPath(r,y)&&(p=3,Y(),u()),c.closePath());if(1==p)for(c.beginPath(),c.rect(30,30,50,50),c.isPointInPath(r,y)&&(p=0,u()),c.closePath(),c.beginPath(),c.rect(590,520,100,80),c.isPointInPath(r,y)&&(location="todo"),c.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)F=10*j+i+1,+localStorage.scpm_level>=F&&(c.beginPath(),c.rect(120*i+50,100*j+120,100,80),c.isPointInPath(r,y)&&(J=1,p=2,R=F,b=ca[F],u()),c.closePath());2==p&&(c.rect(1240,0,32,32),c.isPointInPath(r,y)&&(clearInterval(M),p=J,u()),c.closePath());if(3==p){c.beginPath();c.rect(750,4,100,32);if(c.isPointInPath(r,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);J=3;p=2;u()}c.closePath();c.beginPath();c.rect(875,4,100,32);if(c.isPointInPath(r,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);0==b.B&&alert("You need to test and win your level first.");prompt("Here's your level:",b.hash)}c.closePath();c.beginPath();c.rect(1E3,4,100,32);c.isPointInPath(r,y)&&(Y(),u());c.closePath();c.beginPath();c.rect(1125,4,100,32);c.isPointInPath(r,y)&&(p=0,u());c.closePath();for(i=0;16>i;i++)c.beginPath(),c.rect(8.5+35*i,3.5,32,32),c.isPointInPath(r,y)&&0==z&&0==I&&(q=i,14==q&&(b.a[v]=[]),15==q&&(b.f[E]=[]),u()),c.closePath();c.beginPath();c.rect(8.5,40.5,1264,592);if(c.isPointInPath(r,y)){b.B=!1;f=Math.floor(r/32);tile_y=Math.floor((y-40)/32);if(1==V)A(f,tile_y)&&(b.b[tile_y][f]=0);else if(1==q){if(0<tile_y&&A(f,tile_y)&&A(f,tile_y-1)){for(j in b.b)for(i in b.b[j])if(22==b.b[j][i]||23==b.b[j][i])b.b[j][i]=0;b.b[tile_y-1][f]=22;b.b[tile_y][f]=23}}else if(2==q){if(A(f,tile_y)){for(j in b.b)for(i in b.b[j])2==b.b[j][i]&&(b.b[j][i]=0);b.b[tile_y][f]=2}}else 14==q?A(f,tile_y)&&A(f+1,tile_y)&&(0==z?(b.a[v]=[],b.a[v][0]=f,b.a[v][1]=tile_y,b.b[tile_y][f]=16,b.b[tile_y][f+1]=17,z++):1==z?(b.a[v][2]=tile_y,b.b[tile_y][b.a[v][0]]=16,b.b[tile_y][b.a[v][0]+1]=17,z++):2==z&&(b.a[v][3]=f,b.a[v][4]=tile_y,b.b[tile_y][f]=20,v++,z=0)):15==q?A(f-1,tile_y)&&A(f,tile_y)&&A(f+1,tile_y)&&(0==I?(b.f[E]=[],b.f[E][0]=f,b.f[E][1]=tile_y,I++):1==I&&(b.f[E][2]=f,b.f[E][3]=tile_y,E++,I=0),b.b[tile_y][f-1]=15,b.b[tile_y][f]=15,b.b[tile_y][f+1]=15):A(f,tile_y)&&(b.b[tile_y][f]=q);u()}c.closePath()}};onmousedown=function(b){U=!0;V=3==b.which?!0:!1};onmouseup=function(){U=!1};onmousemove=function(b){3==p&&(U&&14!=q&&15!=q&&onclick(b),r=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,f=Math.floor(r/32),tile_y=Math.floor((y-40)/32),u())};onkeydown=onkeypress=function(b){if(2==p){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)d.C=!0;if(39==b.keyCode||68==b.keyCode)d.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)d.left=!0}};onkeyup=function(b){if(2==p){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)d.C=!1,d.v=!0;if(39==b.keyCode||68==b.keyCode)d.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)d.left=!1;82==b.keyCode&&Z();32==b.keyCode&&(d.A^=1)}};var u=onload=onhashchange=function(){a.width^=0;c.font="bold 30px arial";c.textAlign="center";c.mozImageSmoothingEnabled=!1;c.imageSmoothingEnabled=!1;0==p&&(c.drawImage(tileset,512,0,70,16,120,150,280,64),c.drawImage(tileset,583,0,270,16,120,250,1080,64),c.fillStyle="#000",c.beginPath(),c.fillRect(500,400,100,80),c.fillRect(650,400,100,80),c.fillStyle="#fff",c.fillText("MAKE",700,450),c.fillText("PLAY",550,450),c.stroke(),c.closePath());if(1==p){c.beginPath();c.fillStyle="#000";c.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)F=10*j+i+1,c.fillStyle="#000",c.fillRect(120*i+50,100*j+120,100,80),c.fillStyle="#fff",c.fillText(+localStorage.scpm_level>=F?F:"?",120*i+100,100*j+170);c.fillText("LEVELS",640,70);c.fillText("MORE LEVELS ONLINE",640,470);c.fillText("GO",640,570);c.fillText("\u25c0",40,70);c.stroke();c.closePath()}2==p&&(M&&clearInterval(M),Z(),M=setInterval(ba,33));if(3==p){c.strokeStyle="#777";c.lineWidth=1;c.fillStyle="#fff";c.fillRect(0,0,1280,648);c.fillStyle="#5C94FC";c.fillRect(0,40,1280,640);c.beginPath();for(i=0;16>i;i++)c.fillRect(8+35*i,3,32,32),c.rect(8+35*i,3,32,32),B(i,8+35*i,3);for(j=0;j<b.b.length;j++)for(i=0;i<b.b[j].length;i++)if(C=b.b[j][i],g(C,i,j),2==C&&(H=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||H?H=!0:g(24,i,k);for(i in b.a){Q=b.a[i][1];if(b.a[i][2])for(aa=b.a[i][1]<b.a[i][2]?b.a[i][1]:b.a[i][2],Q=b.a[i][1]<b.a[i][2]?b.a[i][2]:b.a[i][1],k=aa+1;k<Q;k++)g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k),b.b[k][b.a[i][0]]=18,b.b[k][b.a[i][0]+1]=19;if(b.a[i][1])for(G=!1,k=Q+1;21>k;k++)20>k&&!b.b[k][b.a[i][0]]&&!b.b[k][b.a[i][0]+1]&&!G?(g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k)):G=!0;b.a[i][1]&&(g(16,b.a[i][0],b.a[i][1]),g(17,b.a[i][0]+1,b.a[i][1]));b.a[i][2]&&(g(16,b.a[i][0],b.a[i][2]),g(17,b.a[i][0]+1,b.a[i][2]));b.a[i][4]&&g(20,b.a[i][3],b.a[i][4])}0<=tile_y&&!V&&(1==q?0<tile_y&&(g(22,f,tile_y-1),g(23,f,tile_y)):14==q?(0==z&&(g(16,f,tile_y),g(17,f+1,tile_y)),1==z&&(g(16,b.a[v][0],tile_y),g(17,b.a[v][0]+1,tile_y)),2==z&&g(20,f,tile_y)):15==q?(g(15,f-1,tile_y),g(15,f,tile_y),g(15,f+1,tile_y)):g(q,f,tile_y));for(i=0;40>i;i++)c.moveTo(32*i,40),c.lineTo(32*i,648);for(j=0;20>j;j++)c.moveTo(0,40+32*j),c.lineTo(1280,40+32*j);c.fillStyle="#000";c.fillRect(750,4,100,32);c.fillRect(875,4,100,32);c.fillRect(1E3,4,100,32);c.fillRect(1125,4,100,32);c.fillStyle="#fff";c.font="bold 20px arial";c.fillText("TEST",800,28);c.fillText("SHARE",925,28);c.fillText("CLEAR",1050,28);c.fillText("EXIT",1175,28);c.stroke();c.closePath();c.beginPath();i=q;c.strokeStyle="red";c.lineWidth=3;c.rect(8+35*i,3.5,32,32);c.stroke();c.closePath()}}</script>