<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:crosshair"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function da(b,c,e){"undefined"!=typeof b.B&&null!==b.B&&(b.weight=1+d.h[b.B].weight);if(0<b.c){if(4==f(b.x+c+b.c,b.y+16)&&0<=h.m&&v==~~((b.x+c+b.c)/32)&&x==~~((b.y+16)/32)&&3==r)b.y=32*~~((b.y+16)/32),b.a=0,b.o=!0,4==f(b.x+c-c/2,b.y+16)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.v,b.w=5,0==h.l&&(b.a=-b.c,b.c=0),2==h.l&&(b.a=b.c,b.c=0),3==h.l&&(b.c=-b.c));else if(4==f(b.x+c+b.c,b.y+16)&&0<=v&&h.m==~~((b.x+c+b.c)/32)&&h.v==~~((b.y+16)/32)&&3==h.l)b.y=32*~~((b.y+16)/32),b.a=0,b.o=!0,4==f(b.x+c-c/2,b.y+16)&&(b.x=32*v,1==r&&(b.x+=16),b.y=32*x,b.w=5,0==r&&(b.a=-b.c,b.c=0),2==r&&(b.a=b.c,b.c=0),3==r&&(b.c=-b.c));else if(p(f(b.x+c+b.c,b.y))||p(f(b.x+c+b.c,b.y+31)))b.x=32*~~((b.x+b.c)/32)+32-c-1,b.c=0;b.x>1280-c&&(b.x=1280-c,b.c=0);for(var g in d.b)!b.o&&b.x+c+b.c>=32*d.b[g][0]&&b.x+c+b.c<=32*d.b[g][0]+16&&b.y+31>=q[g].y&&b.y<=q[g].S&&(b.x=32*d.b[g][0]-c-1,b.c=0)}if(0>b.c){if(4==f(b.x+b.c,b.y+16)&&0<=h.m&&v==~~((b.x+b.c)/32)&&x==~~((b.y+16)/32)&&1==r)b.y=32*~~((b.y+16)/32),b.a=0,b.o=!0,4==f(b.x-c/2+32,b.y+16)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.v,b.w=5,0==h.l&&(b.a=b.c,b.c=0),1==h.l&&(b.c=-b.c),2==h.l&&(b.a=-b.c,b.c=0));else if(4==f(b.x+b.c,b.y+16)&&0<=v&&h.m==~~((b.x+b.c)/32)&&h.v==~~((b.y+16)/32)&&1==h.l)b.y=32*~~((b.y+16)/32),b.a=0,b.o=!0,4==f(b.x-c/2+32,b.y+16)&&(b.x=32*v,1==r&&(b.x+=16),b.y=32*x,b.w=5,0==r&&(b.a=b.c,b.c=0),1==r&&(b.c=-b.c),2==r&&(b.a=-b.c,b.c=0));else if(p(f(b.x+b.c,b.y))||p(f(b.x+b.c,b.y+31)))b.x=32*~~((b.x+b.c)/32)+32,b.c=0;0>b.x&&(b.x=0,b.c=0);for(g in d.b)b.x+b.c>=32*d.b[g][0]+64-16&&b.x+b.c<=32*d.b[g][0]+64&&b.y+31>=q[g].y&&b.y<=q[g].S&&(b.x=32*d.b[g][0]+64,b.c=0)}b.x+=b.c;b.o||(b.A=!1,b.a+=Z,b.a>O&&(b.a=O));!b.o&&p(f(b.x+c/2,b.y+24))&&(b.y=32*~~(b.y/32)+32);if(0<b.a){if(4==f(b.x+c/2,b.y+32+b.a+8)&&0<=h.m&&v==~~((b.x+c/2)/32)&&x==~~((b.y+32+b.a)/32)&&0==r){if(b.x=32*~~((b.x+c/2)/32),b.c=0,b.o=!0,10<b.a||10>=b.a&&4==f(b.x+c/2,b.y+32+b.a-16))b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.v,b.w=2,0==h.l&&(b.a=-b.a),1==h.l&&(b.c=Math.max(b.a,5),b.a=0),3==h.l&&(b.c=Math.min(-b.a,-5),b.a=0)}else if(4==f(b.x+c/2,b.y+32+b.a+8)&&0<=v&&h.m==~~((b.x+c/2)/32)&&h.v==~~((b.y+32+b.a)/32)&&0==h.l){if(b.x=32*~~((b.x+c/2)/32),b.c=0,b.o=!0,10<b.a||10>=b.a&&4==f(b.x+c/2,b.y+32+b.a-16))b.x=32*v,1==r&&(b.x+=16),b.y=32*x,b.w=2,0==r&&(b.a=-b.a),1==r&&(b.c=Math.max(b.a,5),b.a=0),3==r&&(b.c=Math.min(-b.a,-5),b.a=0)}else if(p(f(b.x,b.y+32+b.a))||p(f(b.x+c,b.y+32+b.a))||1==e&&7==f(b.x,b.y+32+b.a)||1==e&&7==f(b.x+c,b.y+32+b.a))b.y=32*~~((b.y+b.a)/32),b.a=0,b.A=!0;for(l in d.h)!d.h[l].o&&!b.o&&b.x+c>d.h[l].x&&b.x<d.h[l].x+32&&b.y+31+b.a>d.h[l].y-8&&b.y+31+b.a<d.h[l].y+20&&(b.y=d.h[l].y-32,b.a=0,b.A=!0,b.T=l,b.Y=b.x-d.h[l].x,d.h[l].weight+=b.weight);for(g in d.b)b.x+c>=32*d.b[g][0]&&b.x<32*d.b[g][0]+64&&b.y+31+b.a>=q[g].y&&b.y+31+b.a<=q[g].y+32&&(b.y=q[g].y-32,b.a=0,b.A=!0,b.N=!0);for(g in d.f)b.x+c>=32*d.f[g][0]-32&&b.x<32*d.f[g][0]+64&&b.y+31+b.a>=m[g].s-8&&b.y+31+b.a<=m[g].s+32&&(b.y=m[g].s-32,b.a=0,b.A=!0,b.N=!0,m[g].H+=b.weight);for(g in d.f)b.x+c>=32*d.f[g][2]-32&&b.x<32*d.f[g][2]+64&&b.y+31+b.a>=m[g].u-8&&b.y+31+b.a<=m[g].u+32&&(b.y=m[g].u-32,b.a=0,b.A=!0,b.N=!0,m[g].I+=b.weight)}if(0==e&&0>b.a)if(4==f(b.x+c/2,b.y-8)&&0<=h.m&&v==~~((b.x+c/2)/32)&&x==~~((b.y-8)/32)&&2==r)b.x=32*~~((b.x+c/2)/32),b.c=0,b.o=!0,4==f(b.x+c/2,b.y-8)&&(b.x=32*h.m,1==h.l&&(b.x+=16),b.y=32*h.v,b.w=5,1==h.l&&(b.c=-b.a,b.a=0),2==h.l&&(b.a=-b.a),3==h.l&&(b.c=b.a,b.a=0));else if(4==f(b.x+c/2,b.y-8)&&0<=v&&h.m==~~((b.x+c/2)/32)&&h.v==~~((b.y-8)/32)&&2==h.l)b.x=32*~~((b.x+c/2)/32),b.c=0,b.o=!0,4==f(b.x+c/2,b.y-8)&&(b.x=32*v,1==r&&(b.x+=16),b.y=32*x,b.w=5,1==r&&(b.c=-b.a,b.a=0),2==r&&(b.a=-b.a),3==r&&(b.c=b.a,b.a=0));else if(p(f(b.x,b.y+b.a))||p(f(b.x+c,b.y+b.a)))5==f(b.x,b.y+b.a)&&P(b.x,b.y+b.a,0),5==f(b.x+t,b.y+b.a)&&P(b.x+t,b.y+b.a,0),b.y=32*~~((b.y+b.a)/32)+32,b.a=0;b.y+=b.a;11==f(b.x,b.y+20)?(P(b.x,b.y+20,25),Q=!0):11==f(b.x+c,b.y+20)&&(P(b.x+c,b.y+20,25),Q=!0);for(var l in d.b)b.x+c>=32*d.b[l][3]&&b.x<=32*d.b[l][3]+32&&b.y+32>=32*d.b[l][4]&&b.y+20<=32*d.b[l][4]+32&&(q[l].K=!0)}function ja(){a.width^=0;e.font="bold 30px arial";e.fillStyle="#000";e.fillText("\u00d7",1255,25);1==K&&(1==R&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Move with arrow keys or WASD or ZQSD.",640,80),e.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),e.fillText("Collect all coins and reach the flag.",640,160)),2==R&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("Let's add some mechanisms...",640,80)),3==R&&(e.font="bold 30px arial",e.fillStyle="black",e.textAlign="center",e.fillText("And now, you're thinking with portals!",640,80),e.fillText("Use mouse to aim and [left click] / [right click] to shoot.",640,120)));e.$=!1;e.Z=!1;if(0==B){d.g=[];for(var b=0;20>b;b++){d.g[b]=[];for(var g=0;40>g;g++)d.g[b][g]=d.hash.charCodeAt(40*b+g)-48,15==d.g[b][g]&&(d.g[b][g]=0)}for(g in d.b)q[g]={K:!1,y:32*d.b[g][1]};for(g in d.f)m[g]={s:32*d.f[g][1],u:32*d.f[g][3],H:0,I:0}}for(var n in d.b){q[n].K?(q[n].y>32*d.b[n][2]&&(q[n].y=Math.max(q[n].y-4,32*d.b[n][2])),q[n].y<32*d.b[n][2]&&(q[n].y=Math.min(q[n].y+4,32*d.b[n][2]))):(q[n].y>32*d.b[n][1]&&(q[n].y=Math.max(q[n].y-4,32*d.b[n][1])),q[n].y<32*d.b[n][1]&&(q[n].y=Math.min(q[n].y+4,32*d.b[n][1])));L=!1;for(b=~~(q[n].y/32)+1;21>b;b++)if(20>b&&!p(f(d.b[n][0],b))&&!p(f(d.b[n][0]+1,b))&&!L)l(18,d.b[n][0],b),l(19,d.b[n][0]+1,b);else{L=!0;q[n].S=32*b;break}G(16,32*d.b[n][0],q[n].y+40);G(17,32*d.b[n][0]+32,q[n].y+40);d.b[n][4]&&(q[n].K?l(21,d.b[n][3],d.b[n][4]):l(20,d.b[n][3],d.b[n][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){H=d.g[j][i];12==H&&(H=0,0==B&&d.h.push({x:32*i,y:32*j,a:0,M:null}));l(H,i,j);if(2==H&&0==B&&(M=!1,20>j))for(k=j+1;20>k;k++)d.g[k][i]||M?M=!0:(l(24,i,k),d.g[k][i]=24);23==H&&0==B&&(d.start=[i,j],c.x=32*d.start[0],c.y=32*d.start[1])}Q=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==d.g[j][i]&&(d.g[j][i]=11);for(i in d.b)q[i].K=!1;c.weight=1;for(i in d.h)d.h[i].weight=1;for(i in d.f)m[i].H=0,m[i].I=0;if(3!=c.state&&!U){c.state=0;c.aa=!1;(!c.w&&10>c.c||c.A)&&8!=f(c.x,c.y+33)&&8!=f(c.x+t,c.y+33)&&(c.c=0);!c.right||c.w||8==f(c.x,c.y+33)&&8==f(c.x+t,c.y+33)&&0>c.c||(c.V[B]=!0,c.c=aa,c.direction=1,c.A&&(c.state=1));!c.left||c.w||8==f(c.x,c.y+33)&&8==f(c.x+t,c.y+33)&&0<c.c||(c.U[B]=!0,c.c=-aa,c.direction=0,c.A&&(c.state=1));!c.o&&c.R&&c.A&&c.L&&(8!=f(c.x,c.y+33)||8!=f(c.x+t,c.y+33)||0==c.c)&&(c.X[B]=!0,c.a-=S,c.A=!1,c.L=!1);0>c.a&&!c.A&&(c.state=2);da(c,t,0);6==f(c.x+t/2,c.y+16)&&P(c.x+t/2,c.y+16,0);if(7==f(c.x+3,c.y)||7==f(c.x+t-3,c.y)||7==f(c.x+3,c.y+5)||7==f(c.x+t-3,c.y+5))c.state=3,c.a=-1*S;648<c.y&&(c.state=3,c.a=-1.5*S);c.N&&(p(f(c.x,c.y+1))||p(f(c.x+t,c.y+1)))&&(c.state=3,c.a=-1*S);if(c.O){if(c.W[B]=!0,null===c.B)for(i in d.h)if(c.x+t>=d.h[i].x&&c.x<=d.h[i].x+31&&c.y+31>=d.h[i].y&&c.y<=d.h[i].y+31){c.B=i;d.h[i].M=c;c.J=5;break}}else d.h[c.B]&&(d.h[c.B].M=null,c.B=null,c.weight=1);null!==c.B?(d.h[c.B].x=c.x+-8*c.direction,c.J&&c.J--,d.h[c.B].y=c.o?c.y:p(f(c.x,c.y-28))||p(f(c.x+t,c.y-28))?32*~~((c.y+4)/32):c.y-32+4*c.J):c.O=0;if(2==f(c.x+t/2,c.y+16)||24==f(c.x+t/2,c.y+16)){for(j=V=0;20>j;j++)for(i=0;40>i;i++)6==d.g[j][i]&&V++;0==V&&(U=!0,c.state=0)}if(c.F)for(i=0;40>i;i++)c.F+=.001,c.i+=c.F*c.C,c.j+=c.F*c.D,p(f(c.i,c.j))?(c.F=0,4>c.i%32&&!p(f(c.i-32,c.j))&&0<c.C&&(z=3),28<c.i%32&&!p(f(c.i+32,c.j))&&0>c.C&&(z=1),4>c.j%32&&!p(f(c.i,c.j-32))&&0<c.D&&(z=0),28<c.j%32&&!p(f(c.i,c.j+32))&&0>c.D&&(z=2),8==f(c.i,c.j)&&(c.F=1,0==z||2==z?c.D=-c.D:c.C=-c.C),4!=f(c.i,c.j)||~~(c.i/32)==h.m&&~~(c.j/32)==h.v&&h.l==z||(v=~~(c.i/32),x=~~(c.j/32),r=z)):(e.fillStyle="blue",e.fillRect(c.i,c.j+40,6,6));if(c.G)for(i=0;40>i;i++)c.G+=.001,c.i+=c.G*c.C,c.j+=c.G*c.D,p(f(c.i,c.j))?(c.G=0,4>c.i%32&&!p(f(c.i-32,c.j))&&0<c.C&&(z=3),28<c.i%32&&!p(f(c.i+32,c.j))&&0>c.C&&(z=1),4>c.j%32&&!p(f(c.i,c.j-32))&&0<c.D&&(z=0),28<c.j%32&&!p(f(c.i,c.j+32))&&0>c.D&&(z=2),8==f(c.i,c.j)&&(c.G=1,0==z||2==z?c.D=-c.D:c.C=-c.C),4!=f(c.i,c.j)||~~(c.i/32)==v&&~~(c.j/32)==x&&r==z||(h.m=~~(c.i/32),h.v=~~(c.j/32),h.l=z)):(e.fillStyle="orange",e.fillRect(c.i,c.j+40,6,6));4!=f(c.x+1,c.y+1)&&4!=f(c.x+t-1,c.y+1)&&4!=f(c.x+1,c.y+31)&&4!=f(c.x+ +t-1,c.y+31)&&(c.o=!1);c.w&&c.w--}3==c.state&&(c.a+=Z,c.a>O&&(c.a=O),c.y+=c.a);for(i in d.h)4!=f(d.h[i].x+1,d.h[i].y+1)&&4!=f(d.h[i].x+32-1,d.h[i].y+1)&&4!=f(d.h[i].x+1,d.h[i].y+31)&&4!=f(d.h[i].x+32-1,d.h[i].y+31)&&(d.h[i].o=!1),d.h[i].w&&d.h[i].w--,null===d.h[i].M&&(d.h[i].c=0,da(d.h[i],32,1));for(i in d.h)e.drawImage(tileset,192,0,16,16,d.h[i].x,40+d.h[i].y,32,32);1==c.direction?e.drawImage(tileset,16*[26,[27,28,29][~~(B/2)%3],30,31][c.state],0,16,16,c.x-4,40+c.y,32,32):(e.save(),e.translate(c.x+t+4,c.y),e.scale(-1,1),e.drawImage(tileset,16*[26,[27,28,29][~~(B/2)%3],30,31][c.state],0,16,16,0,40,32,32),e.restore());l(4,v,x);l(4,h.m,h.v);e.fillStyle="blue";0==r&&e.fillRect(32*v,32*x+40-8,32,8);1==r&&e.fillRect(32*v+28,32*x+40,8,32);2==r&&e.fillRect(32*v,32*x+68,32,8);3==r&&e.fillRect(32*v-4,32*x+40,8,32);e.fillStyle="orange";0==h.l&&e.fillRect(32*h.m,32*h.v+40-8,32,8);1==h.l&&e.fillRect(32*h.m+28,32*h.v+40,8,32);2==h.l&&e.fillRect(32*h.m,32*h.v+68,32,8);3==h.l&&e.fillRect(32*h.m-4,32*h.v+40,8,32);if(Q!=ba)for(j=0;20>j;j++)for(i=0;40>i;i++)9==d.g[j][i]?d.g[j][i]=10:10==d.g[j][i]&&(d.g[j][i]=9);ba=Q;for(i in d.f)!(m[i].H>m[i].I)||p(f(32*d.f[i][0]-32,m[i].s+20))||p(f(32*d.f[i][0],m[i].s+20))||p(f(32*d.f[i][0]+32,m[i].s+20))||p(f(32*d.f[i][2]-32,m[i].u-4))||p(f(32*d.f[i][2]-32,m[i].u-4))||p(f(32*d.f[i][2]-32,m[i].u-4))?!(m[i].I>m[i].H)||p(f(32*d.f[i][2]-32,m[i].u+20))||p(f(32*d.f[i][2],m[i].u+20))||p(f(32*d.f[i][2]+32,m[i].u+20))||p(f(32*d.f[i][0]-32,m[i].s-4))||p(f(32*d.f[i][0]-32,m[i].s-4))||p(f(32*d.f[i][0]-32,m[i].s-4))||(m[i].s-=4,m[i].u+=4):(m[i].s+=4,m[i].u-=4),G(15,32*d.f[i][0]-32,m[i].s+40),G(15,32*d.f[i][0],m[i].s+40),G(15,32*d.f[i][0]+32,m[i].s+40),G(15,32*d.f[i][2]-32,m[i].u+40),G(15,32*d.f[i][2],m[i].u+40),G(15,32*d.f[i][2]+32,m[i].u+40);B++;document.title=c.x+" "+c.y;U&&(ca++,e.font="bold 100px arial",e.fillStyle="#000",e.textAlign="center",e.fillText("CLEARED!",640,350));30<=ca&&(a.width^=0,clearInterval(T),u=K,d.P=!0,a.width^=0,C())}function ea(){d={g:[],b:[],f:[],h:[],P:!1};for(j=0;20>j;j++)d.g[j]=[];A=I=N=D=E=0}function fa(){U=!1;B=ca=V=0;c={x:0,y:0,c:0,a:0,A:0,X:[],V:[],U:[],W:[],direction:1,state:0,B:null,L:!0,T:null,Y:null,J:0};ga=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];d.h=[];ba=!1;q=[];m=[];x=v=-1;r=void 0;h={m:-2,v:-2}}function F(b,c){return d.g[c]?!d.g[c][b]||14>d.g[c][b]||24<d.g[c][b]:0}function p(b){return ga[b]||0}function P(b,c,e){d.g[~~(c/32)]&&(d.g[~~(c/32)][~~(b/32)]=e)}function f(b,c){return d.g[~~(c/32)]?d.g[~~(c/32)][~~(b/32)]||0:0}function G(b,c,d){e.drawImage(tileset,16*b,0,16,16,c,d,32,32)}function l(b,c,d){e.drawImage(tileset,16*b,0,16,16,32*c,40+32*d,32,32)}var v,x,r,e=a.getContext("2d");localStorage.scpm_level=3;var u=1,K=0,W=!1,X=!1,t=24,Z=2,O=20,S=20,aa=6,g=tile_y=0,w=y=0,R=0,d={},E,D,N,I,A,ha,Y,L,M,J,H,U,ca,V,T,B,c,ga,Q,ba,q,m,h,z,ia=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600<0<0<0000000G0000050505000000000000000005050500400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330000000044400044400007000000000400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{b:[[17,16,6,15,16]],f:[[31,8,35,17]],hash:"00000000000000000000000000000000000000000000000000000000000000000000000<000<00000000000000000000000000000000000900090000000000<00000000000000000000000000000000000000000000000000000000000000000000000000000099990000000033333333333000000000000000000009000000000000030000000000000000000000:::9000004006000030000000000000000200000000900000440000003000000000000000000000099990000000060000300000000000000000000000009000000000600030000000000000000000000:::900000000000003000000000000000000000000090000000006000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000000000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"},{hash:"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000344444444444444444400000000000000000400030000000000000000000000000000000000040003000000000000000000000000000000000004000300000000000000000000000008000000000400030000<00077777770000000000800000000040003444444448888888444400000080000000004000300000000000000000000000008000;000004000306660000000000000000000008003333993300030000000000000000000000000000300000030003000004448888888444000000000030200003000300000400000000000000000000003000000300030F000400000000000000000000003000000300030G000400000000000000000000003000000300034444440000000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],e=a.getContext("2d");localStorage.scpm_level=3;var u=1,K=0,X=W=!1,t=24,Z=2,S=O=20,aa=6,R=w=y=g=tile_y=0,d={},ia=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600<0<0<0000000G0000050505000000000000000005050500400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330000000044400044400007000000000400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{b:[[17,16,6,15,16]],f:[[31,8,35,17]],hash:"00000000000000000000000000000000000000000000000000000000000000000000000<000<00000000000000000000000000000000000900090000000000<00000000000000000000000000000000000000000000000000000000000000000000000000000099990000000033333333333000000000000000000009000000000000030000000000000000000000:::9000004006000030000000000000000200000000900000440000003000000000000000000000099990000000060000300000000000000000000000009000000000600030000000000000000000000:::900000000000003000000000000000000000000090000000006000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000000000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"},{hash:"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000344444444444444444400000000000000000400030000000000000000000000000000000000040003000000000000000000000000000000000004000300000000000000000000000008000000000400030000<00077777770000000000800000000040003444444448888888444400000080000000004000300000000000000000000000008000;000004000306660000000000000000000008003333993300030000000000000000000000000000300000030003000004448888888444000000000030200003000300000400000000000000000000003000000300030F000400000000000000000000003000000300030G000400000000000000000000003000000300034444440000000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],C=onload=onhashchange=function(){a.width^=0;e.font="bold 30px arial";e.textAlign="center";e.mozImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;0==u&&(e.drawImage(tileset,512,0,70,16,120,150,280,64),e.drawImage(tileset,583,0,270,16,120,250,1080,64),e.fillStyle="#000",e.beginPath(),e.fillRect(500,400,100,80),e.fillRect(650,400,100,80),e.fillStyle="#fff",e.fillText("MAKE",700,450),e.fillText("PLAY",550,450),e.stroke(),e.closePath());if(1==u){e.beginPath();e.fillStyle="#000";e.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)J=10*j+i+1,e.fillStyle="#000",e.fillRect(120*i+50,100*j+120,100,80),e.fillStyle="#fff",e.fillText(+localStorage.scpm_level>=J?J:"?",120*i+100,100*j+170);e.fillText("LEVELS",640,70);e.fillText("MORE LEVELS ONLINE",640,470);e.fillText("GO",640,570);e.fillText("\u25c0",40,70);e.stroke();e.closePath()}2==u&&(T&&clearInterval(T),fa(),T=setInterval(ja,33));if(3==u){e.strokeStyle="#777";e.lineWidth=1;e.fillStyle="#fff";e.fillRect(0,0,1280,648);e.fillStyle="#5C94FC";e.fillRect(0,40,1280,640);e.beginPath();for(i=0;16>i;i++)e.fillRect(8+35*i,3,32,32),e.rect(8+35*i,3,32,32),G(i,8+35*i,3);for(j=0;j<d.g.length;j++)for(i=0;i<d.g[j].length;i++)if(H=d.g[j][i],l(H,i,j),2==H&&(M=!1,20>j))for(k=j+1;20>k;k++)d.g[k][i]||M?M=!0:l(24,i,k);for(i in d.b){Y=d.b[i][1];if(d.b[i][2])for(ha=d.b[i][1]<d.b[i][2]?d.b[i][1]:d.b[i][2],Y=d.b[i][1]<d.b[i][2]?d.b[i][2]:d.b[i][1],k=ha+1;k<Y;k++)l(18,d.b[i][0],k),l(19,d.b[i][0]+1,k),d.g[k][d.b[i][0]]=18,d.g[k][d.b[i][0]+1]=19;if(d.b[i][1])for(L=!1,k=Y+1;21>k;k++)20>k&&!d.g[k][d.b[i][0]]&&!d.g[k][d.b[i][0]+1]&&!L?(l(18,d.b[i][0],k),l(19,d.b[i][0]+1,k)):L=!0;d.b[i][1]&&(l(16,d.b[i][0],d.b[i][1]),l(17,d.b[i][0]+1,d.b[i][1]));d.b[i][2]&&(l(16,d.b[i][0],d.b[i][2]),l(17,d.b[i][0]+1,d.b[i][2]));d.b[i][4]&&l(20,d.b[i][3],d.b[i][4])}for(i in d.f)d.f[i][3]&&(l(15,d.f[i][0]-1,d.f[i][1]),l(15,d.f[i][0],d.f[i][1]),l(15,d.f[i][0]+1,d.f[i][1]),d.g[d.f[i][1]][d.f[i][0]-1]=15,d.g[d.f[i][1]][d.f[i][0]]=15,d.g[d.f[i][1]][d.f[i][0]+1]=15,l(15,d.f[i][2]-1,d.f[i][3]),l(15,d.f[i][2],d.f[i][3]),l(15,d.f[i][2]+1,d.f[i][3]),d.g[d.f[i][3]][d.f[i][2]-1]=15,d.g[d.f[i][3]][d.f[i][2]]=15,d.g[d.f[i][3]][d.f[i][2]+1]=15);0<=tile_y&&!X&&(1==A?0<tile_y&&(l(22,g,tile_y-1),l(23,g,tile_y)):14==A?(0==E&&(l(16,g,tile_y),l(17,g+1,tile_y)),1==E&&(l(16,d.b[D][0],tile_y),l(17,d.b[D][0]+1,tile_y)),2==E&&l(20,g,tile_y)):15==A?(l(15,g-1,tile_y),l(15,g,tile_y),l(15,g+1,tile_y)):l(A,g,tile_y));for(i=0;40>i;i++)e.moveTo(32*i,40),e.lineTo(32*i,648);for(j=0;20>j;j++)e.moveTo(0,40+32*j),e.lineTo(1280,40+32*j);e.fillStyle="#000";e.fillRect(750,4,100,32);e.fillRect(875,4,100,32);e.fillRect(1E3,4,100,32);e.fillRect(1125,4,100,32);e.fillStyle="#fff";e.font="bold 20px arial";e.fillText("TEST",800,28);e.fillText("SHARE",925,28);e.fillText("CLEAR",1050,28);e.fillText("EXIT",1175,28);e.stroke();e.closePath();e.beginPath();i=A;e.strokeStyle="red";e.lineWidth=3;e.rect(8+35*i,3.5,32,32);e.stroke();e.closePath()}};a.onclick=a.oncontextmenu=function(b){w=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==u&&(e.beginPath(),e.rect(500,400,100,80),e.isPointInPath(w,y)&&(u=1,C()),e.closePath(),e.beginPath(),e.rect(650,400,100,80),e.isPointInPath(w,y)&&(u=3,ea(),C()),e.closePath());if(1==u)for(e.beginPath(),e.rect(30,30,50,50),e.isPointInPath(w,y)&&(u=0,C()),e.closePath(),e.beginPath(),e.rect(590,520,100,80),e.isPointInPath(w,y)&&(location="todo"),e.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)J=10*j+i+1,+localStorage.scpm_level>=J&&(e.beginPath(),e.rect(120*i+50,100*j+120,100,80),e.isPointInPath(w,y)&&(K=1,u=2,R=J,d=ia[J],C()),e.closePath());2==u&&0<B&&(c.o||(c.F=0,c.G=0,1==b.which&&(c.F=1),3==b.which&&(c.G=1),b=Math.atan2(w-(c.x+t/2),y-(c.y+40+16)),c.i=c.x+t/2,c.j=c.y+16,c.C=Math.sin(b),c.D=Math.cos(b)),e.beginPath(),e.rect(1240,0,32,32),e.isPointInPath(w,y)&&(clearInterval(T),u=K,C()),e.closePath());if(3==u){e.beginPath();e.rect(750,4,100,32);if(e.isPointInPath(w,y)){d.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=d.g[j][i]||0,tile=16>tile||21<tile?tile:0,d.hash+=String.fromCharCode(tile+48);K=3;u=2;C()}e.closePath();e.beginPath();e.rect(875,4,100,32);if(e.isPointInPath(w,y)){d.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=d.g[j][i]||0,tile=16>tile||21<tile?tile:0,d.hash+=String.fromCharCode(tile+48);location.hash="";0==d.P&&alert("You need to test and win your level first.");prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,b:d.b,f:d.f})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:d.hash,b:d.b,f:d.f}))}e.closePath();e.beginPath();e.rect(1E3,4,100,32);e.isPointInPath(w,y)&&(ea(),C());e.closePath();e.beginPath();e.rect(1125,4,100,32);e.isPointInPath(w,y)&&(u=0,C());e.closePath();for(i=0;16>i;i++)e.beginPath(),e.rect(8.5+35*i,3.5,32,32),e.isPointInPath(w,y)&&0==E&&0==N&&(A=i,14==A&&(d.b[D]=[]),15==A&&(d.f[I]=[]),C()),e.closePath();e.beginPath();e.rect(8.5,40.5,1264,592);if(e.isPointInPath(w,y)){d.P=!1;g=Math.floor(w/32);tile_y=Math.floor((y-40)/32);if(1==X)F(g,tile_y)&&(d.g[tile_y][g]=0);else if(1==A){if(0<tile_y&&F(g,tile_y)&&F(g,tile_y-1)){for(j in d.g)for(i in d.g[j])if(22==d.g[j][i]||23==d.g[j][i])d.g[j][i]=0;d.g[tile_y-1][g]=22;d.g[tile_y][g]=23}}else if(2==A){if(F(g,tile_y)){for(j in d.g)for(i in d.g[j])2==d.g[j][i]&&(d.g[j][i]=0);d.g[tile_y][g]=2}}else 14==A?F(g,tile_y)&&F(g+1,tile_y)&&(0==E?(d.b[D]=[],d.b[D][0]=g,d.b[D][1]=tile_y,d.g[tile_y][g]=16,d.g[tile_y][g+1]=17,E++):1==E?(d.b[D][2]=tile_y,d.g[tile_y][d.b[D][0]]=16,d.g[tile_y][d.b[D][0]+1]=17,E++):2==E&&(d.b[D][3]=g,d.b[D][4]=tile_y,d.g[tile_y][g]=20,D++,E=0)):15==A?F(g-1,tile_y)&&F(g,tile_y)&&F(g+1,tile_y)&&(0==N?(d.f[I]=[],d.f[I][0]=g,d.f[I][1]=tile_y,N++):1==N&&(d.f[I][2]=g,d.f[I][3]=tile_y,I++,N=0),d.g[tile_y][g-1]=15,d.g[tile_y][g]=15,d.g[tile_y][g+1]=15):F(g,tile_y)&&(d.g[tile_y][g]=A);C()}e.closePath()}return!1};onmousedown=function(b){W=!0;X=3==b.which?!0:!1};onmouseup=function(){W=!1};onmousemove=function(b){3==u&&(W&&14!=A&&15!=A&&onclick(b),w=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,g=Math.floor(w/32),tile_y=Math.floor((y-40)/32),C())};onkeydown=onkeypress=function(b){if(2==u){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.R=!0;if(39==b.keyCode||68==b.keyCode)c.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!0}};onkeyup=function(b){if(2==u){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.R=!1,c.L=!0;if(39==b.keyCode||68==b.keyCode)c.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!1;82==b.keyCode&&fa();32==b.keyCode&&(c.O^=1)}};onhashchange=function(){location.hash&&(console.log(decodeURIComponent(location.hash.slice(1))),d=JSON.parse(decodeURIComponent(location.hash.slice(1))),u=2,C())};onhashchange()</script>