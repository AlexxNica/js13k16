<meta charset=utf-8><body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:pointer"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function T(c,d,e){"undefined"!=typeof c.i&&null!==c.i&&(c.weight=1+b.g[c.i].weight);if(0<c.h){if(x[n(c.x+d+c.h,c.y)]||x[n(c.x+d+c.h,c.y+31)])c.x=32*~~((c.x+c.h)/32)+32-d-1,c.h=0;c.x>1280-d&&(c.x=1280-d,c.h=0);for(var f in b.a)c.x+d+c.h>=32*b.a[f][0]&&c.x+d+c.h<=32*b.a[f][0]+16&&c.y+31>=m[f].y&&c.y<=m[f].F&&(c.x=32*b.a[f][0]-d-1,c.h=0)}if(0>c.h){if(x[n(c.x+c.h,c.y)]||x[n(c.x+c.h,c.y+31)])c.x=32*~~((c.x+c.h)/32)+32,c.h=0;0>c.x&&(c.x=0,c.h=0);for(f in b.a)c.x+c.h>=32*b.a[f][0]+64-16&&c.x+c.h<=32*b.a[f][0]+64&&c.y+31>=m[f].y&&c.y<=m[f].F&&(c.x=32*b.a[f][0]+64,c.h=0)}c.x+=c.h;c.j=!1;c.f+=2;20<c.f&&(c.f=20);x[n(c.x+d/2,c.y+24)]&&(c.y=32*~~(c.y/32)+32);if(0<c.f){if(x[n(c.x,c.y+32+c.f)]||x[n(c.x+d,c.y+32+c.f)]||1==e&&7==n(c.x,c.y+32+c.f)||1==e&&7==n(c.x+d,c.y+32+c.f))c.y=32*~~((c.y+c.f)/32),c.f=0,c.j=!0;for(g in b.g)c.x+d>b.g[g].x&&c.x<b.g[g].x+32&&c.y+31+c.f>b.g[g].y-8&&c.y+31+c.f<b.g[g].y+20&&(c.y=b.g[g].y-32,c.f=0,c.j=!0,c.G=g,c.L=c.x-b.g[g].x,b.g[g].weight+=c.weight);for(f in b.a)c.x+d>=32*b.a[f][0]&&c.x<32*b.a[f][0]+64&&c.y+31+c.f>=m[f].y&&c.y+31+c.f<=m[f].y+32&&(c.y=m[f].y-32,c.f=0,c.j=!0);for(f in b.c)c.x+d>=32*b.c[f][0]-32&&c.x<32*b.c[f][0]+64&&c.y+31+c.f>=l[f].l-8&&c.y+31+c.f<=l[f].l+32&&(c.y=l[f].l-32,c.f=0,c.j=!0,l[f].o+=c.weight);for(f in b.c)c.x+d>=32*b.c[f][2]-32&&c.x<32*b.c[f][2]+64&&c.y+31+c.f>=l[f].m-8&&c.y+31+c.f<=l[f].m+32&&(c.y=l[f].m-32,c.f=0,c.j=!0,l[f].s+=c.weight)}0==e&&0>c.f&&(x[n(c.x,c.y)]||x[n(c.x+d,c.y)])&&(5==n(c.x,c.y)&&H(c.x,c.y,0),5==n(c.x+24,c.y)&&H(c.x+24,c.y,0),c.y=32*~~(c.y/32)+32,c.f=0);c.y+=c.f;11==n(c.x,c.y+20)?(H(c.x,c.y+20,25),I=!0):11==n(c.x+d,c.y+20)&&(H(c.x+d,c.y+20,25),I=!0);for(var g in b.a)c.x+d>=32*b.a[g][3]&&c.x<=32*b.a[g][3]+32&&c.y+32>=32*b.a[g][4]&&c.y+20<=32*b.a[g][4]+32&&(m[g].v=!0)}function X(){a.width^=0;d.font="bold 30px arial";d.fillStyle="#000";d.fillText("\u00d7",1255,25);1==J&&(1==L&&(d.font="bold 30px arial",d.fillStyle="black",d.textAlign="center",d.fillText("Move with arrow keys or WASD or ZQSD.",640,80),d.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),d.fillText("Collect all coins and reach the flag.",640,160)),2==L&&(d.font="bold 30px arial",d.fillStyle="black",d.textAlign="center",d.fillText("You shall use these mechanisms...",640,80)),3==L&&(d.font="bold 30px arial",d.fillStyle="black",d.textAlign="center",d.fillText("And now, you're thinking with portals!",640,80),d.fillText("Use mouse to aim and [left click] / [right click] to shoot.",640,120)));d.N=!1;d.M=!1;if(0==v){b.b=[];for(var c=0;20>c;c++){b.b[c]=[];for(var f=0;40>f;f++)b.b[c][f]=b.hash.charCodeAt(40*c+f)-48,15==b.b[c][f]&&(b.b[c][f]=0)}for(f in b.a)m[f]={v:!1,y:32*b.a[f][1]};for(f in b.c)l[f]={l:32*b.c[f][1],m:32*b.c[f][3],o:0,s:0}}for(var h in b.a){m[h].v?(m[h].y>32*b.a[h][2]&&(m[h].y=Math.max(m[h].y-4,32*b.a[h][2])),m[h].y<32*b.a[h][2]&&(m[h].y=Math.min(m[h].y+4,32*b.a[h][2]))):(m[h].y>32*b.a[h][1]&&(m[h].y=Math.max(m[h].y-4,32*b.a[h][1])),m[h].y<32*b.a[h][1]&&(m[h].y=Math.min(m[h].y+4,32*b.a[h][1])));E=!1;for(c=~~(m[h].y/32)+1;21>c;c++)if(20>c&&!b.b[c][b.a[h][0]]&&!b.b[c][b.a[h][0]+1]&&!E)g(18,b.a[h][0],c),g(19,b.a[h][0]+1,c);else{E=!0;m[h].F=32*c;break}A(16,32*b.a[h][0],m[h].y+40);A(17,32*b.a[h][0]+32,m[h].y+40);b.a[h][4]&&(m[h].v?g(21,b.a[h][3],b.a[h][4]):g(20,b.a[h][3],b.a[h][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){B=b.b[j][i];12==B&&(B=0,0==v&&b.g.push({x:32*i,y:32*j,f:0,A:null}));g(B,i,j);if(2==B&&0==v&&(F=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||F?F=!0:(g(24,i,k),b.b[k][i]=24);23==B&&0==v&&(b.start=[i,j],e.x=32*b.start[0],e.y=32*b.start[1])}I=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==b.b[j][i]&&(b.b[j][i]=11);for(i in b.a)m[i].v=!1;e.weight=1;for(i in b.g)b.g[i].weight=1;for(i in b.c)l[i].o=0,l[i].s=0;if(3!=e.state&&!M){e.state=0;e.h=0;e.right&&(e.I[v]=!0,e.h=6,e.direction=1,e.j&&(e.state=1));e.left&&(e.H[v]=!0,e.h=-6,e.direction=0,e.j&&(e.state=1));e.D&&e.j&&e.w&&(e.K[v]=!0,e.f-=20,e.j=!1,e.w=!1);0>e.f&&!e.j&&(e.state=2);T(e,24,0);6==n(e.x+12,e.y+16)&&H(e.x+12,e.y+16,0);if(7==n(e.x+3,e.y)||7==n(e.x+24-3,e.y)||7==n(e.x+3,e.y+5)||7==n(e.x+24-3,e.y+5))e.state=3,e.f=-30;648<e.y&&(e.state=3,e.f=-30);if(e.B){if(e.J[v]=!0,null===e.i)for(i in b.g)if(e.x+24>=b.g[i].x&&e.x<=b.g[i].x+31&&e.y+31>=b.g[i].y&&e.y<=b.g[i].y+31){e.i=i;b.g[i].A=e;e.u=5;break}}else b.g[e.i]&&(b.g[e.i].A=null,e.i=null,e.weight=1);null!==e.i?(b.g[e.i].x=e.x+-8*e.direction,e.u&&e.u--,b.g[e.i].y=e.y-32+4*e.u):e.B=0;if(2==n(e.x+12,e.y+16)||24==n(e.x+12,e.y+16)){for(j=N=0;20>j;j++)for(i=0;40>i;i++)6==b.b[j][i]&&N++;0==N&&(M=!0,e.state=0)}}3==e.state&&(e.f+=2,20<e.f&&(e.f=20),e.y+=e.f);for(i in b.g)null===b.g[i].A&&(b.g[i].h=0,T(b.g[i],32,1));for(i in b.g)d.drawImage(tileset,192,0,16,16,b.g[i].x,40+b.g[i].y,32,32);1==e.direction?d.drawImage(tileset,16*[26,[27,28,29][~~(v/2)%3],30,31][e.state],0,16,16,e.x-4,40+e.y,32,32):(d.save(),d.translate(e.x+24+4,e.y),d.scale(-1,1),d.drawImage(tileset,16*[26,[27,28,29][~~(v/2)%3],30,31][e.state],0,16,16,0,40,32,32),d.restore());if(I!=P)for(j=0;20>j;j++)for(i=0;40>i;i++)9==b.b[j][i]?b.b[j][i]=10:10==b.b[j][i]&&(b.b[j][i]=9);P=I;for(i in b.c)l[i].o>l[i].s?(l[i].l+=4,l[i].m-=4):l[i].s>l[i].o&&(l[i].l-=4,l[i].m+=4),A(15,32*b.c[i][0]-32,l[i].l+40),A(15,32*b.c[i][0],l[i].l+40),A(15,32*b.c[i][0]+32,l[i].l+40),A(15,32*b.c[i][2]-32,l[i].m+40),A(15,32*b.c[i][2],l[i].m+40),A(15,32*b.c[i][2]+32,l[i].m+40);v++;M&&(Q++,d.font="bold 100px arial",d.fillStyle="#000",d.textAlign="center",d.fillText("CLEARED!",640,350));30<=Q&&(a.width^=0,clearInterval(K),p=J,b.C=!0,a.width^=0,t())}function U(){b={b:[],a:[],c:[],g:[],C:!1};for(j=0;20>j;j++)b.b[j]=[];q=C=G=u=w=0}function V(){M=!1;v=Q=N=0;e={x:0,y:0,h:0,f:0,j:0,K:[],I:[],H:[],J:[],direction:1,state:0,i:null,w:!0,G:null,L:null,u:0};x=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];b.g=[];P=!1;m=[];l=[]}function z(c,d){return b.b[d]?!b.b[d][c]||14>b.b[d][c]||24<b.b[d][c]:0}function H(c,d,e){b.b[~~(d/32)]&&(b.b[~~(d/32)][~~(c/32)]=e)}function n(c,d){return b.b[~~(d/32)]?b.b[~~(d/32)][~~(c/32)]:0}function A(b,e,f){d.drawImage(tileset,16*b,0,16,16,e,f,32,32)}function g(b,e,f){d.drawImage(tileset,16*b,0,16,16,32*e,40+32*f,32,32)}var d=a.getContext("2d");localStorage.scpm_level=3;var p=1,J=0,R=!1,S=!1,f=tile_y=0,r=y=0,L=0,b={},w,u,G,C,q,W,O,E,F,D,B,M,Q,N,K,v,e,x,I,P,m,l,Y=[{},{hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600000000000000G0000050505000000000000000000000000400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330<0000004440004440000700<0<0<00400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{a:[[17,16,4,15,16]],c:[[31,8,35,17]],hash:"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<00000000000000000000000000000000000000000000000000000333333330000000000000000099990000000000000300000000000000000000000009000000000000030000000000000000000000:::9000000000000030000000000000000200000000900000000000003000000000000000000000099990000000000000300000000000000000000000009000000000000030000000000000000000000:::900000000000003000000000000000000000000090000000000000300000000000000000000009999000000000000030000000000000000300000000900000000000<03000000000000000030F000000900000000000003000000000000000030G0;000090000000000000300000000000000003333333333333333333333330000000000000000333333333333333333333333000000000000000030000000000000000000000000000000000000000"},{hash:"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040003444444444444444444400000000000000004000300000000000000000000000000000000000400030000<0000000000000000000000000000004000300000000000000000000000008000000000400030000000777700000000000000800000000040003444444444444444444400000080000000004000300000000000000000000000008000;000004000300000000000000000000000008003333993300030000000000000000000000000800300000030003000004444444444444400000080030200003000300000400000000000000000008003000000300030F000400000000000000000000003000000300030G000400000000000000000000003000000300034444440000000000000000000000333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000"}],t=onload=onhashchange=function(){a.width^=0;d.font="bold 30px arial";d.textAlign="center";d.mozImageSmoothingEnabled=!1;d.imageSmoothingEnabled=!1;0==p&&(d.drawImage(tileset,512,0,70,16,120,150,280,64),d.drawImage(tileset,583,0,270,16,120,250,1080,64),d.fillStyle="#000",d.beginPath(),d.fillRect(500,400,100,80),d.fillRect(650,400,100,80),d.fillStyle="#fff",d.fillText("MAKE",700,450),d.fillText("PLAY",550,450),d.stroke(),d.closePath());if(1==p){d.beginPath();d.fillStyle="#000";d.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)D=10*j+i+1,d.fillStyle="#000",d.fillRect(120*i+50,100*j+120,100,80),d.fillStyle="#fff",d.fillText(+localStorage.scpm_level>=D?D:"?",120*i+100,100*j+170);d.fillText("LEVELS",640,70);d.fillText("MORE LEVELS ONLINE",640,470);d.fillText("GO",640,570);d.fillText("\u25c0",40,70);d.stroke();d.closePath()}2==p&&(K&&clearInterval(K),V(),K=setInterval(X,33));if(3==p){d.strokeStyle="#777";d.lineWidth=1;d.fillStyle="#fff";d.fillRect(0,0,1280,648);d.fillStyle="#5C94FC";d.fillRect(0,40,1280,640);d.beginPath();for(i=0;16>i;i++)d.fillRect(8+35*i,3,32,32),d.rect(8+35*i,3,32,32),A(i,8+35*i,3);for(j=0;j<b.b.length;j++)for(i=0;i<b.b[j].length;i++)if(B=b.b[j][i],g(B,i,j),2==B&&(F=!1,20>j))for(k=j+1;20>k;k++)b.b[k][i]||F?F=!0:g(24,i,k);for(i in b.a){O=b.a[i][1];if(b.a[i][2])for(W=b.a[i][1]<b.a[i][2]?b.a[i][1]:b.a[i][2],O=b.a[i][1]<b.a[i][2]?b.a[i][2]:b.a[i][1],k=W+1;k<O;k++)g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k),b.b[k][b.a[i][0]]=18,b.b[k][b.a[i][0]+1]=19;if(b.a[i][1])for(E=!1,k=O+1;21>k;k++)20>k&&!b.b[k][b.a[i][0]]&&!b.b[k][b.a[i][0]+1]&&!E?(g(18,b.a[i][0],k),g(19,b.a[i][0]+1,k)):E=!0;b.a[i][1]&&(g(16,b.a[i][0],b.a[i][1]),g(17,b.a[i][0]+1,b.a[i][1]));b.a[i][2]&&(g(16,b.a[i][0],b.a[i][2]),g(17,b.a[i][0]+1,b.a[i][2]));b.a[i][4]&&g(20,b.a[i][3],b.a[i][4])}for(i in b.c)b.c[i][3]&&(g(15,b.c[i][0]-1,b.c[i][1]),g(15,b.c[i][0],b.c[i][1]),g(15,b.c[i][0]+1,b.c[i][1]),b.b[b.c[i][1]][b.c[i][0]-1]=15,b.b[b.c[i][1]][b.c[i][0]]=15,b.b[b.c[i][1]][b.c[i][0]+1]=15,g(15,b.c[i][2]-1,b.c[i][3]),g(15,b.c[i][2],b.c[i][3]),g(15,b.c[i][2]+1,b.c[i][3]),b.b[b.c[i][3]][b.c[i][2]-1]=15,b.b[b.c[i][3]][b.c[i][2]]=15,b.b[b.c[i][3]][b.c[i][2]+1]=15);0<=tile_y&&!S&&(1==q?0<tile_y&&(g(22,f,tile_y-1),g(23,f,tile_y)):14==q?(0==w&&(g(16,f,tile_y),g(17,f+1,tile_y)),1==w&&(g(16,b.a[u][0],tile_y),g(17,b.a[u][0]+1,tile_y)),2==w&&g(20,f,tile_y)):15==q?(g(15,f-1,tile_y),g(15,f,tile_y),g(15,f+1,tile_y)):g(q,f,tile_y));for(i=0;40>i;i++)d.moveTo(32*i,40),d.lineTo(32*i,648);for(j=0;20>j;j++)d.moveTo(0,40+32*j),d.lineTo(1280,40+32*j);d.fillStyle="#000";d.fillRect(750,4,100,32);d.fillRect(875,4,100,32);d.fillRect(1E3,4,100,32);d.fillRect(1125,4,100,32);d.fillStyle="#fff";d.font="bold 20px arial";d.fillText("TEST",800,28);d.fillText("SHARE",925,28);d.fillText("CLEAR",1050,28);d.fillText("EXIT",1175,28);d.stroke();d.closePath();d.beginPath();i=q;d.strokeStyle="red";d.lineWidth=3;d.rect(8+35*i,3.5,32,32);d.stroke();d.closePath()}};onclick=function(c){r=c.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=c.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==p&&(d.beginPath(),d.rect(500,400,100,80),d.isPointInPath(r,y)&&(p=1,t()),d.closePath(),d.beginPath(),d.rect(650,400,100,80),d.isPointInPath(r,y)&&(p=3,U(),t()),d.closePath());if(1==p)for(d.beginPath(),d.rect(30,30,50,50),d.isPointInPath(r,y)&&(p=0,t()),d.closePath(),d.beginPath(),d.rect(590,520,100,80),d.isPointInPath(r,y)&&(location="todo"),d.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)D=10*j+i+1,+localStorage.scpm_level>=D&&(d.beginPath(),d.rect(120*i+50,100*j+120,100,80),d.isPointInPath(r,y)&&(J=1,p=2,L=D,b=Y[D],t()),d.closePath());2==p&&(d.rect(1240,0,32,32),d.isPointInPath(r,y)&&(clearInterval(K),p=J,t()),d.closePath());if(3==p){d.beginPath();d.rect(750,4,100,32);if(d.isPointInPath(r,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);J=3;p=2;t()}d.closePath();d.beginPath();d.rect(875,4,100,32);if(d.isPointInPath(r,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.b[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);location.hash="";0==b.C&&alert("You need to test and win your level first.");prompt("Here's your level URL:",encodeURI(location.origin+location.pathname+"#"+JSON.stringify({hash:b.hash,a:b.a,c:b.c})));prompt("Here's your level URL:",location.origin+location.pathname+"#"+JSON.stringify({hash:b.hash,a:b.a,c:b.c}))}d.closePath();d.beginPath();d.rect(1E3,4,100,32);d.isPointInPath(r,y)&&(U(),t());d.closePath();d.beginPath();d.rect(1125,4,100,32);d.isPointInPath(r,y)&&(p=0,t());d.closePath();for(i=0;16>i;i++)d.beginPath(),d.rect(8.5+35*i,3.5,32,32),d.isPointInPath(r,y)&&0==w&&0==G&&(q=i,14==q&&(b.a[u]=[]),15==q&&(b.c[C]=[]),t()),d.closePath();d.beginPath();d.rect(8.5,40.5,1264,592);if(d.isPointInPath(r,y)){b.C=!1;f=Math.floor(r/32);tile_y=Math.floor((y-40)/32);if(1==S)z(f,tile_y)&&(b.b[tile_y][f]=0);else if(1==q){if(0<tile_y&&z(f,tile_y)&&z(f,tile_y-1)){for(j in b.b)for(i in b.b[j])if(22==b.b[j][i]||23==b.b[j][i])b.b[j][i]=0;b.b[tile_y-1][f]=22;b.b[tile_y][f]=23}}else if(2==q){if(z(f,tile_y)){for(j in b.b)for(i in b.b[j])2==b.b[j][i]&&(b.b[j][i]=0);b.b[tile_y][f]=2}}else 14==q?z(f,tile_y)&&z(f+1,tile_y)&&(0==w?(b.a[u]=[],b.a[u][0]=f,b.a[u][1]=tile_y,b.b[tile_y][f]=16,b.b[tile_y][f+1]=17,w++):1==w?(b.a[u][2]=tile_y,b.b[tile_y][b.a[u][0]]=16,b.b[tile_y][b.a[u][0]+1]=17,w++):2==w&&(b.a[u][3]=f,b.a[u][4]=tile_y,b.b[tile_y][f]=20,u++,w=0)):15==q?z(f-1,tile_y)&&z(f,tile_y)&&z(f+1,tile_y)&&(0==G?(b.c[C]=[],b.c[C][0]=f,b.c[C][1]=tile_y,G++):1==G&&(b.c[C][2]=f,b.c[C][3]=tile_y,C++,G=0),b.b[tile_y][f-1]=15,b.b[tile_y][f]=15,b.b[tile_y][f+1]=15):z(f,tile_y)&&(b.b[tile_y][f]=q);t()}d.closePath()}};onmousedown=function(b){R=!0;S=3==b.which?!0:!1};onmouseup=function(){R=!1};onmousemove=function(b){3==p&&(R&&14!=q&&15!=q&&onclick(b),r=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,f=Math.floor(r/32),tile_y=Math.floor((y-40)/32),t())};onkeydown=onkeypress=function(b){if(2==p){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)e.D=!0;if(39==b.keyCode||68==b.keyCode)e.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)e.left=!0}};onkeyup=function(b){if(2==p){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)e.D=!1,e.w=!0;if(39==b.keyCode||68==b.keyCode)e.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)e.left=!1;82==b.keyCode&&V();32==b.keyCode&&(e.B^=1)}};onhashchange=function(){location.hash&&(console.log(decodeURIComponent(location.hash.slice(1))),b=JSON.parse(decodeURIComponent(location.hash.slice(1))),p=2,t())};onhashchange()</script>